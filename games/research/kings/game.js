!function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function t(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var e,i,n,o,s,w=function(){return(w=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function a(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,i,s):n(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s}function f(o,s,a,h){return new(a=a||Promise)(function(t,e){function i(t){try{n(h.next(t))}catch(t){e(t)}}function r(t){try{n(h.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((h=h.apply(o,s||[])).next())})}function T(i,r){var n,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(i,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function E(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function d(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)s.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}function z(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(d(arguments[e]));return t}function h(i,t){var e=Object.keys(t).reduce(function(t,e){return t[e]=i.name+":"+e,t},{});return i.prototype.EVENT=e}(i=e=e||{})[i.type=0]="type",i[i.instance=1]="instance",o=n=n||{},s=new Array,o.registerType=function(t,e,i){"function"==typeof e&&(i=e,e=void 0),s.push({kind:0,key:t,named:e,value:i})},o.registerInstance=function(t,e,i){"object"==typeof e&&(i=e,e=void 0),s.push({kind:1,key:t,named:e,value:i})},o.getRegistrations=function(){return s};var c,u,l,p,y=n;function v(e){return function(t){if(t.prototype.constructor!==t)throw new Error("You should register a Class");y.registerInstance("$Class",e||t.name,t)}}function g(a,h){void 0===a&&(a=0);function r(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var o="_"+e;function s(t){a&&(this._dirty=(this._dirty||0)|a),this.onPropertyChanged&&this.onPropertyChanged(e,t),h&&vn.instance.bus.trigger(this,h)}return{configurable:!1,enumerable:!0,get:function(){return this[o]},set:function(t){var e=this[o];(e&&e.equals?e.equals(t):t===e)||(e&&0<r.length&&g.uninstall(e),this[o]=t,0<r.length&&g.install(this,t,s,r),s.call(this,e))}}}return r.on=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return function(t,e){return r.apply(void 0,z([t,e,void 0],i))}},r}function _(r,n){return function(t,i,e){if(!e||!e.value||"function"!=typeof e.value)return{get:function(){var t=this.children.getByName(r);return t&&t[n||i]},set:function(t){var e=this.children.getByName(r);e&&(e[n||i]=t)}};e.value=function(){var t=this.children.getByName(r),e=t&&t[n||i];return e&&e.apply(t,arguments)}}}function m(r,n){return function(t,i){return{get:function(){var t=this[r];return t&&t[n||i]},set:function(t){var e=this[r];e&&(e[n||i]=t)}}}}function b(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.warn.apply(console,z([t],e))}function x(t){var e=P(t);if(!e.$descriptor)return e.$descriptor={};var i=Object.getPrototypeOf(e);return i&&i.$descriptor&&e.$descriptor===i.$descriptor&&(e.$descriptor=w(w({},i.$descriptor),{properties:w({},i.$descriptor.properties&&Object.fromEntries(Object.entries(i.$descriptor.properties).map(function(t){var e=d(t,2),i=e[0],r=e[1];return[i,w({},r)]})))})),e.$descriptor}function P(t){return"function"==typeof t?t:t.constructor}g.install=function(t,e,i,r){var n,o;try{for(var s=E(r),a=s.next();!a.done;a=s.next()){var h=a.value;vn.instance.bus.addListener(e,h,i).withContext(t).withOwner(t)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},g.uninstall=function(t){vn.instance.bus.removeSource(t)},(u=c=c||{}).getInjects=function(t){var e,i="function"==typeof(e=t)?e:e.constructor;return i&&i.$injects||[]},u.addInject=function(t,e,i){var r=function t(e){if("object"==typeof e)return t(e.constructor);if(!e.$injects)return e.$injects=[];var i=Object.getPrototypeOf(e);return i&&i.$injects&&e.$injects===i.$injects&&(e.$injects=i.$injects.slice()),e.$injects}(t);if("number"==typeof e){var n=r.findIndex(function(t){return"constructor"===t.kind&&t.target===e}),o=w(w({},i),{kind:"constructor",target:e});n<0?r.push(o):(b("Dependency %s overwritten for %s",i.key,t.name||t.constructor.name),r[n]=o)}else r.push(w(w({},i),{kind:"property",target:e}))},(p=l=l||{}).getDescriptor=function(t){var e=P(t);if(e&&e.$descriptor){var i=e.$descriptor;if(i.provider)return i.provider(e);var r=new A(e,i);for(var n in i.properties)r.addProperty(i.properties[n]);return r}},p.createDescriptor=x,p.setProperty=function(t,e,i){var r=x(t);r.properties||(r.properties={}),r.properties[e]=w(w(w({},r.properties[e]),i),{name:e})};var A=(S.prototype.getChildren=function(t){var e=this.metadata.children;return e?e(t):t.children.all},S.prototype.getProperty=function(e){return this._properties.find(function(t){return t.name===e})},S.prototype.getProperties=function(){return this._properties},S.prototype.addProperty=function(t){this._properties.push(t)},S);function S(t,e){this.typeConstructor=t,this.metadata=e,this._properties=new Array,this.displayName=e.displayName||t.name,this.icon=e.icon,this.builder=e.builder}var I,D,O,C,j,k,N=w(w({},c),l);function L(i){return void 0===i&&(i=!0),function(t,e){N.setProperty(t,e,{serializable:i})}}(D=I=I||{}).name=function(e){return function(t){N.createDescriptor(t).displayName=e}},D.icon=function(e){return function(t){N.createDescriptor(t).icon=e}},D.builder=function(e){return function(t){N.createDescriptor(t).builder=e}},(C=O=O||{}).number=function(r,n,o){return function(t,e,i){N.setProperty(t,e,{type:"number",displayName:r,parameters:void 0!==n||void 0!==o?{min:n,max:o}:void 0})}},C.string=function(i){return function(t,e){N.setProperty(t,e,{type:"string",displayName:i})}},C.editor=function(i){return function(t,e){N.setProperty(t,e,{editor:i})}},(k=j=j||{}).subClassOf=function(e){return function(t){N.createDescriptor(t).children=function(t){return z(t.children.ofType(e()))}}},k.exclude=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){N.createDescriptor(t).children=function(t){return z(t.children).filter(function(t){return!t.name||e.indexOf(t.name)<0})}}};var R=(V.prototype.clone=function(){return new B(this.width,this.height)},V.prototype.equals=function(t){return t&&t.width===this.width&&t.height===this.height||!1},V.Zero=new V,V);function V(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e}var M,F,B=(t(H,M=R),(F=H).prototype.set=function(t,e){return"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height),this},H.prototype.delta=function(t,e){return this.width+=t,this.height+=e,this},H.EVENT=h(F,{changed:""}),a([L(),g(!1,F.EVENT.changed)],H.prototype,"width",void 0),a([L(),g(!1,F.EVENT.changed)],H.prototype,"height",void 0),H=F=a([v()],H));function H(){return null!==M&&M.apply(this,arguments)||this}var $=(W.prototype.initialize=function(){var t=window.innerWidth,e=window.innerHeight,i=window.devicePixelRatio,r=this.canvas=document.createElement("canvas");r.style.width=t+"px",r.style.height=e+"px",r.width=t*i,r.height=e*i,document.body.appendChild(r),this.context=r.getContext("2d",{}),this.size.set(r.width,r.height)},W);function W(){this.canvas=void 0,this.context=void 0,this.size=new B(0,0)}var U=(Object.defineProperty(G.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),Object.defineProperty(G.prototype,"timeDelta",{get:function(){return this._timeDelta},enumerable:!0,configurable:!0}),G.prototype.start=function(){this._isRunning=!0,this._time=Date.now(),this._loop()},G.prototype.pause=function(){this._isRunning=!1},G.prototype.step=function(t){this._timeDelta=t,this._callback(t)},G);function G(t){this._callback=t,this._isRunning=!1,this._intervalId=0,this._time=0,this._timeDelta=0,this._loop=function(){if(this._isRunning){var t=Date.now(),e=this._timeDelta=(t-this._time)/1e3;this._time=t;performance.now();this.step(e);performance.now();this._intervalId=window.requestAnimationFrame(this._loop)}}.bind(this)}var q=(Y.prototype.once=function(){return this.entry.once=!0,this},Y.prototype.withContext=function(t){return this.entry.context=t,this},Y.prototype.withOwner=function(t){return this.entry.owner=t,this},Y.prototype.withTag=function(t){return this.entry.tag=t,this},Y.prototype.createDisposer=function(){var t=this;return function(){t.manager.removeListener(t.entry.id)}},Y);function Y(t,e){this.manager=t,this.entry=e}var X=(K.prototype.addListener=function(t,e,i){var r={id:++K._currentID,source:t,event:e,callback:i,owner:void 0,context:void 0,once:!1,registered:!0,tag:void 0,relayEvent:void 0};return this._addListenerEntry(r),new q(this,r)},K.prototype.addRelay=function(t,e,i,r){void 0===r&&(r=e);var n={id:++K._currentID,source:t,event:e,callback:void 0,owner:void 0,context:i,once:!1,registered:!0,tag:void 0,relayEvent:r};this._addListenerEntry(n)},K.prototype._addListenerEntry=function(t){this._list.set(t.id,t);var e=this._tree.get(t.source);e||(e=new Map,this._tree.set(t.source,e));var i=e.get(t.event);i||(i=[],e.set(t.event,i)),i.unshift(t)},K.prototype.removeListener=function(e){var t=this._list.get(e);if(t){this._list.delete(e);var i=this._tree.get(t.source),r=i&&i.get(t.event);if(r)if(this._triggering)(this._toRemove=this._toRemove||[]).push(t);else{var n=r.findIndex(function(t){return t.id===e});0<=n&&r.splice(n,1)}}},K.prototype.removeListenerByTag=function(t,e){var i,r;try{for(var n=E(this._list.values()),o=n.next();!o.done;o=n.next()){var s=o.value;s.owner===t&&s.tag===e&&this.removeListener(s.id)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},K.prototype.removeSource=function(t){var e,i,r,n,o=this._tree.get(t);if(o&&0<o.size)try{for(var s=E(o.values()),a=s.next();!a.done;a=s.next()){var h=a.value;try{for(var c=(r=void 0,E(h)),u=c.next();!u.done;u=c.next()){var l=u.value;this.removeListener(l.id)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}},K.prototype.removeOwner=function(t){var e,i;try{for(var r=E(this._list.values()),n=r.next();!n.done;n=r.next()){var o=n.value;o.owner===t&&this.removeListener(o.id)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},K.prototype.trigger=function(t,e,i){var r,n,o=this._tree.get(t),s=o&&o.get(e);if(s){for(var a=s.length-1;0<=a;a--){var h=s[a];h&&h.registered&&(h.relayEvent?this.trigger(h.context,h.relayEvent,i):h.callback.call(h.context,t,h.event,i)),h&&h.once&&this.removeListener(h.id)}if(this._toRemove&&0<this._toRemove.length){try{for(var c=E(this._toRemove),u=c.next();!u.done;u=c.next()){var l=u.value;this.removeListener(l.id)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}this._toRemove.length=0}}},K._currentID=0,K);function K(){this._tree=new Map,this._list=new Map,this._triggering=!1,this._toRemove=void 0}function Z(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return t}function Q(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!0!==t)throw new Error(Z(e,i))}function J(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(t)throw new Error(Z(e,i))}function tt(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(null==t)throw new Error(Z(e,i))}function et(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];if(0<=e.indexOf(t))throw new Error(Z(i,r))}function it(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];if(t!==e)throw new Error(Z(i,r))}function rt(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];if(t!==e&&t&&e)throw new Error(Z(i,r))}var nt=(ot.prototype.registerLoader=function(t,e){e&&(t.alias=e),this._loaders.push(t)},ot.prototype.unregisterLoader=function(e){if("string"==typeof e){var t=this._loaders.find(function(t){return t.alias===e});return t&&this.unregisterLoader(t)||!1}var i=this._loaders.indexOf(e);return!(i<0||(this._loaders.splice(i,1),0))},ot.prototype.registerProcessor=function(t,e){e&&(t.alias=e),this._processors.push(t)},ot.prototype.loadMulti=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return f(this,void 0,void 0,function(){return T(this,function(t){return[2,[]]})})},ot.prototype.load=function(i,r){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:"string"==typeof r&&(r={dataType:r}),e=new ht(i,r&&r.dataType,r),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._loadResource(e)];case 2:return t.sent(),[3,4];case 3:throw t.sent();case 4:return[2,e.data]}})})},ot.prototype._loadResource=function(y){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u,l,p,d,f;return T(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=E(this._processors),i=e.next(),t.label=1;case 1:return i.done?[3,4]:(c=i.value).preProcess?[4,c.preProcess(this,y)]:[3,3];case 2:t.sent(),t.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return r=t.sent(),l={error:r},[3,7];case 6:try{i&&!i.done&&(p=e.return)&&p.call(e)}finally{if(l)throw l.error}return[7];case 7:return tt(n=y.loader?this._loaders.find(function(t){return t.alias===y.loader}):this._loaders.find(function(t){return t.canLoad(y.url)})),o=w({timeout:this.defaultTimeout},y.loaderOptions),s=y,[4,n.load(y.url,o)];case 8:s.data=t.sent(),t.label=9;case 9:t.trys.push([9,14,15,16]),a=E(this._processors),h=a.next(),t.label=10;case 10:return h.done?[3,13]:(c=h.value).postProcess?[4,c.postProcess(this,y)]:[3,12];case 11:t.sent(),t.label=12;case 12:return h=a.next(),[3,10];case 13:return[3,16];case 14:return u=t.sent(),d={error:u},[3,16];case 15:try{h&&!h.done&&(f=a.return)&&f.call(a)}finally{if(d)throw d.error}return[7];case 16:return[2]}})})},ot);function ot(){this._loaders=[],this._processors=[],this.defaultTimeout=0}var st,at,ht=function(t,e,i){this.loader=void 0,this.loaderOptions=void 0,this.processingOptions=void 0,this.data=void 0,this.dataType=void 0,this.url=t,this.dataType=e,this.processingOptions=i};function ct(i,t){return void 0===i&&(i=0),!i||i<0?t:Promise.race([t,new Promise(function(t,e){setTimeout(function(){e(new Error("timeout"))},1e3*i)})])}function ut(t,e){var i=0<=t.indexOf("?");return t+(i?"&":"?")+e}function lt(t){var e=t.indexOf("?");return 0<=e&&t.substring(e+1)||void 0}function pt(t){var e=t.indexOf("?");return 0<=e?t.substring(0,e):t}(at=st=st||{}).getFileExtension=function(t){var e=pt(t).split("/").pop(),i=e&&e.lastIndexOf(".")||-1;if(0<i)return e.substring(i+1).toLowerCase()},at.addQuery=ut,at.getQuery=lt,at.removeQuery=pt,at.changeFile=function(t,e,i){var r=lt(t),n=pt(t),o=lt(e),s=pt(e),a=n.split("/");a[a.length-1]=s;var h=a.join("/");return i&&r&&(h=ut(h,r)),o&&(h=ut(h,o)),h};var dt=st,ft=(yt.prototype.canLoad=function(t){var e=dt.getFileExtension(t);return e&&0<=yt.SUPPORTED.indexOf(e)||!1},yt.prototype.load=function(t,e){return ct(e&&e.timeout,new Promise(function(e,i){var r=function(t){o.removeEventListener("error",r),o.removeEventListener("load",n),i(t)},n=function(t){o.removeEventListener("error",r),o.removeEventListener("load",n),e(o)},o=new Image;o.crossOrigin=null,o.addEventListener("error",r),o.addEventListener("load",n),o.src=t}))},yt.SUPPORTED=["bmp","jpg","jpeg","png","webp","gif","tif","tiff","tga","svg"],yt);function yt(){this.alias="image"}var vt=(gt.getMedium=function(t){var e=dt.getFileExtension(t);if(e){var i=gt.MEDIUM_MAP.find(function(t){return t[0]===e});return i&&i[1]}},gt.prototype.canLoad=function(t){var e=dt.getFileExtension(t);return e&&0<=gt.SUPPORTED.indexOf(e)||!1},gt.prototype.load=function(o,s){var t=this;return ct(s&&s.timeout,f(t,void 0,void 0,function(){var e,i,r,n;return T(this,function(t){switch(t.label){case 0:return[4,fetch(o,{mode:void 0})];case 1:switch(e=t.sent(),i=s&&s.medium||gt.getMedium(o)){case"json":return[3,2];case"text":return[3,4];case"document":return[3,6];case"blob":return[3,8]}return[3,10];case 2:return[4,e.json()];case 3:return[2,t.sent()];case 4:return[4,e.text()];case 5:return[2,t.sent()];case 6:return n=(r=new DOMParser).parseFromString,[4,e.text()];case 7:return[2,n.apply(r,[t.sent(),"text/xml"])];case 8:return[4,e.blob()];case 9:return[2,t.sent()];case 10:throw new Error("Unsupported type '"+i+"'")}})}))},gt.SUPPORTED=(gt.MEDIUM_MAP=[["xml","document"],["xhtml","document"],["tsx","document"],["html","document"],["htm","document"],["tmx","document"],["text","text"],["txt","text"],["json","json"]]).map(function(t){return t[0]}),gt);function gt(){this.alias="fetch"}function _t(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),"number"==typeof t?{x:t,y:e}:{x:t.x,y:t.y}}function mt(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),"number"==typeof t?{width:t,height:e}:{width:t.width,height:t.height}}function bt(t,e,i,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),"number"==typeof t?{x:t,y:e,width:i,height:r}:"number"!=typeof e?bt(t.x,t.y,e.width,e.height):bt(t.x,t.y,t.width,t.height)}var wt=function(t,e,i,r){void 0===e&&(e=bt(_t(0,0),t.size)),void 0===i&&(i=mt(e)),void 0===r&&(r=_t()),this.texture=t,this.textureCoord=e,this.size=i,this.offset=r},xt=(Object.defineProperty(Pt.prototype,"count",{get:function(){return this._frames.size},enumerable:!0,configurable:!0}),Pt.prototype.add=function(t,e,i,r){var n,o;e instanceof wt?(n=this._frames,o=t,n.has(o)&&b("%s is already present",o),this._frames.set(t,e)):this.add(t,new wt(this.texture,e,i,r))},Pt.prototype.get=function(t){return this._frames.get(t)},Pt.prototype.has=function(t){return this._frames.has(t)},Pt);function Pt(t){this.texture=t,this._frames=new Map,this[Symbol.iterator]=this._frames[Symbol.iterator].bind(this._frames)}var Tt="spriteAtlas",Et=(zt.prototype.postProcess=function(y,v){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u,l,p,d,f;return T(this,function(t){switch(t.label){case 0:if(v.dataType!==Tt)return[2];if(!v.data)return[2];if("object"!=typeof v.data)return[2];if(!Array.isArray(v.data.frames))throw new Error("invalid");return e=v.data,i=e.meta.image,r=dt.changeFile(v.url,i),[4,y.load(r)];case 1:n=t.sent(),o=new xt(n);try{for(s=E(e.frames),a=s.next();!a.done;a=s.next())h=a.value,c=bt(h.frame.x,h.frame.y,h.frame.w,h.frame.h),u=mt(h.sourceSize.w,h.sourceSize.h),l=_t(h.spriteSourceSize.x,h.spriteSourceSize.y),o.add(h.filename,new wt(n,c,u,l))}catch(t){p={error:t}}finally{try{a&&!a.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return v.data=o,vn.instance.cache.set(v.url,o),(f=vn.instance.spriteFrames).addEntries.apply(f,z(o)),[2]}})})},zt.DATA_TYPE=Tt,zt);function zt(){this.alias=Tt}var At=(Object.defineProperty(St.prototype,"source",{get:function(){return tt(this._source),this._source},enumerable:!0,configurable:!0}),Object.defineProperty(St.prototype,"isDestroyed",{get:function(){return!this._source},enumerable:!0,configurable:!0}),St);function St(t,e){this._source=void 0,this._source=t,e=e||(t instanceof SVGImageElement?mt(t.width.baseVal.value,t.height.baseVal.value):mt(t)),this.size=e}var It=(Dt.prototype.postProcess=function(t,i){return f(this,void 0,void 0,function(){var e;return T(this,function(t){return i.dataType&&"texture"!==i.dataType||i.data instanceof Image&&(e=new At(i.data),i.data=e,i.dataType="texture",vn.instance.cache.set(i.url,e)),[2]})})},Dt.DATA_TYPE="texture",Dt);function Dt(){this.alias="texture"}var Ot=(Ct.prototype.clone=function(){return new Nt(this.x,this.y)},Ct.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},Ct.prototype.angle=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.atan2(i,e)},Ct.prototype.equals=function(t){return t&&t.x===this.x&&t.y===this.y||!1},Ct);function Ct(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}var jt,kt,Nt=(t(Lt,jt=Ot),(kt=Lt).distance=function(t,e){return Ot.prototype.distance.call(t,e)},Lt.angle=function(t,e){return Ot.prototype.angle.call(t,e)},Lt.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e||0),this},Lt.prototype.delta=function(t,e){return"object"==typeof t?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e||0),this},Lt.Zero=new Ot,Lt.EVENT=h(kt,{changed:""}),a([L(),g(!1,kt.EVENT.changed)],Lt.prototype,"x",void 0),a([L(),g(!1,kt.EVENT.changed)],Lt.prototype,"y",void 0),Lt=kt=a([v()],Lt));function Lt(){return null!==jt&&jt.apply(this,arguments)||this}var Rt=(Vt.IdentityNew=function(){return this.Identity.clone()},Object.defineProperty(Vt.prototype,"rotation",{get:function(){return Math.atan2(this.b,this.a)},enumerable:!0,configurable:!0}),Vt.prototype.clone=function(){return new Ht(this.a,this.b,this.c,this.d,this.e,this.f)},Vt.prototype.toWorld=function(t,e){return void 0===e&&(e=t),Vt.toWorld(this,t,e)},Vt.prototype.toWorldBox=function(t,e){return void 0===e&&(e=t),Vt.toWorldBox(this,t,e)},Vt.prototype.toLocal=function(t,e){return void 0===e&&(e=t),Vt.toLocal(this,t,e)},Vt.toWorld=function(t,e,i){void 0===i&&(i=e);var r=t.a,n=t.b,o=t.c,s=t.d,a=t.e,h=t.f,c=e.x,u=e.y;return i.x=r*c+o*u+a,i.y=n*c+s*u+h,i},Vt.toWorldBox=function(t,e,i){void 0===i&&(i=e);var r=t.a,n=t.b,o=t.c,s=t.d,a=t.e,h=t.f,c=e.left,u=e.right,l=e.top,p=e.bottom;return i.left=r*c+o*p+a,i.bottom=n*c+s*p+h,i.right=r*u+o*l+a,i.top=n*u+s*l+h,i},Vt.toLocal=function(t,e,i){void 0===i&&(i=e);var r=t.a,n=t.b,o=t.c,s=t.d,a=t.e,h=t.f,c=e.x,u=e.y,l=r*s-n*o;return i.x=(s*(c-a)+o*(h-u))/l,i.y=(r*(u-h)+n*(a-c))/l,i},Vt.Identity=new Vt(1,0,0,1,0,0),Vt);function Vt(t,e,i,r,n,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=i,this.d=r,this.e=n,this.f=o}var Mt,Ft,Bt,Ht=(t($t,Mt=Rt),Object.defineProperty($t.prototype,"rotation",{get:function(){return Math.atan2(this.b,this.a)},set:function(t){var e=Math.cos(t),i=Math.sin(t);this.a=e,this.b=-i,this.c=i,this.d=e},enumerable:!0,configurable:!0}),$t.prototype.set=function(t,e,i,r,n,o){return"number"==typeof t?(this.a=t,this.b=e,this.c=i,this.d=r,this.e=n,this.f=o):this.set(t.a,t.b,t.c,t.d,t.e,t.f),this},$t.prototype.translate=function(t,e){return this.e+=t,this.f+=e,this},$t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},$t.prototype.multiply=function(t){var e=this,i=e.a,r=e.b,n=e.c,o=e.d,s=e.e,a=e.f;return e.a=i*t.a+r*t.c,e.b=i*t.b+r*t.d,e.c=n*t.a+o*t.c,e.d=n*t.b+o*t.d,e.e=s*t.a+a*t.c+t.e,e.f=s*t.b+a*t.d+t.f,e},$t.prototype.rotate=function(t,e){var i=this,r=i.a,n=i.b,o=i.c,s=i.d,a=i.e,h=i.f,c=Math.cos(t),u=Math.sin(t);return i.a=r*c-n*u,i.b=r*u+n*c,i.c=o*c-s*u,i.d=o*u+s*c,e?(i.e=e.x,i.f=e.y):(i.e=a*c-h*u,i.f=a*u+h*c),this},a([L()],$t.prototype,"a",void 0),a([L()],$t.prototype,"b",void 0),a([L()],$t.prototype,"c",void 0),a([L()],$t.prototype,"d",void 0),a([L()],$t.prototype,"e",void 0),a([L()],$t.prototype,"f",void 0),$t);function $t(){return null!==Mt&&Mt.apply(this,arguments)||this}(Bt=Ft=Ft||{})[Bt.bottomLeft=0]="bottomLeft",Bt[Bt.bottomRight=1]="bottomRight",Bt[Bt.topLeft=2]="topLeft",Bt[Bt.topRight=3]="topRight",Bt[Bt.center=4]="center",Bt[Bt.centerLeft=5]="centerLeft",Bt[Bt.centerTop=6]="centerTop",Bt[Bt.centerRight=7]="centerRight",Bt[Bt.centerBottom=8]="centerBottom";var Wt=(Ut.prototype.clone=function(){return new qt(this.left,this.top,this.right,this.bottom)},Ut.prototype.intersects=function(t){return this.right>=t.left&&this.bottom<=t.top&&this.left<=t.right&&this.top>=t.bottom},Ut.prototype.overlaps=function(t){var e=this;return e.right>t.left&&e.bottom<t.top&&e.left<t.right&&e.top>t.bottom&&!(e.left>=t.left&&e.top<=t.top&&e.right<=t.right&&e.bottom>=t.bottom)&&!(t.left>=e.left&&t.top<=e.top&&t.right<=e.right&&t.bottom>=e.bottom)},Ut.prototype.contains=function(t,e){return"object"==typeof t&&(e=t.y,t=t.x),this.left<=t&&t<=this.right&&this.bottom<=e&&e<=this.top},Object.defineProperty(Ut.prototype,"height",{get:function(){return this.top-this.bottom},enumerable:!0,configurable:!0}),Object.defineProperty(Ut.prototype,"width",{get:function(){return this.bottom-this.left},enumerable:!0,configurable:!0}),Ut.prototype.toArray=function(){return[this.left,this.top,this.right,this.bottom]},Ut.prototype.getPoint=function(t,e){switch(void 0===e&&(e=new Nt),t){case 0:return e.set(this.left,this.bottom);case 1:return e.set(this.right,this.bottom);case 2:return e.set(this.left,this.top);case 3:return e.set(this.right,this.top);case 4:return e.set(this.left+this.width/2,this.bottom+this.height/2);case 5:return e.set(this.left,this.bottom+this.height/2);case 6:return e.set(this.left+this.width/2,this.top);case 7:return e.set(this.right,this.bottom+this.height/2);case 8:return e.set(this.left+this.width/2,this.bottom)}},Ut);function Ut(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.left=t,this.top=e,this.right=i,this.bottom=r}var Gt,qt=(t(Yt,Gt=Wt),Yt.prototype.set=function(t,e,i,r){return"object"==typeof t?this.set(t.left,t.top,t.right,t.bottom):(this.left=t,this.top=e,this.right=i,this.bottom=r,this)},Object.defineProperty(Yt.prototype,"width",{get:function(){return this.right-this.left},set:function(t){this.right=this.left+t},enumerable:!0,configurable:!0}),Object.defineProperty(Yt.prototype,"height",{get:function(){return this.top-this.bottom},set:function(t){this.top=this.bottom+t},enumerable:!0,configurable:!0}),Yt.Zero=new Yt,Yt.EVENT=h(Yt,{changed:""}),a([L(),g(1,Yt.EVENT.changed)],Yt.prototype,"left",void 0),a([L(),g(1,Yt.EVENT.changed)],Yt.prototype,"top",void 0),a([L(),g(1,Yt.EVENT.changed)],Yt.prototype,"right",void 0),a([L(),g(1,Yt.EVENT.changed)],Yt.prototype,"bottom",void 0),Yt);function Yt(){return null!==Gt&&Gt.apply(this,arguments)||this}var Xt=(Kt.prototype.clone=function(){return new Jt(this.x,this.y,this.width,this.height)},Kt.prototype.equals=function(t){return t&&t.x===this.x&&t.y===this.y&&t.width==this.width&&t.height===this.height||!1},Kt.Zero=new Kt,Kt);function Kt(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r}var Zt,Qt,Jt=(t(te,Zt=Xt),(Qt=te).prototype.set=function(t,e,i,r){"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t,this.y=e||0,this.width=i||0,this.height=r||0)},te.EVENT=h(Qt,{changed:""}),a([L(),g(!1,Qt.EVENT.changed)],te.prototype,"x",void 0),a([L(),g(!1,Qt.EVENT.changed)],te.prototype,"y",void 0),a([L(),g(!1,Qt.EVENT.changed)],te.prototype,"width",void 0),a([L(),g(!1,Qt.EVENT.changed)],te.prototype,"height",void 0),te=Qt=a([v()],te));function te(){return null!==Zt&&Zt.apply(this,arguments)||this}var ee,ie=(ee=re,Object.defineProperty(re.prototype,"localTransform",{get:function(){return this._dirty&&this.update(),this._transformLocal},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"worldTransform",{get:function(){return this._dirty&&this.update(),this._transformWorld},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"box",{get:function(){return this._dirty&&this.update(),this._box},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"rect",{get:function(){return this._dirty&&this.update(),this._rect},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"left",{get:function(){return this.position.x-this.anchor.x*this.size.width*this.scale.x},set:function(t){this.position.set(t+this.anchor.x*this.size.width*this.scale.x,this.position.y)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"top",{get:function(){return this.position.y+(1-this.anchor.y)*this.size.height*this.scale.y},set:function(t){this.position.set(this.position.x,t-(1-this.anchor.y)*this.size.height*this.scale.y)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"right",{get:function(){return this.position.x+(1-this.anchor.x)*this.size.width*this.scale.x},set:function(t){this.position.set(t-(1-this.anchor.x)*this.size.width*this.scale.x,this.position.y)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"bottom",{get:function(){return this.position.y-this.anchor.y*this.size.height*this.scale.y},set:function(t){this.position.set(this.position.x,t+this.anchor.y*this.size.height*this.scale.y)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"outerCenterX",{get:function(){return this.position.x+this.size.width*this.scale.x*(.5-this.anchor.x)},set:function(t){this.position.set(t-this.size.width*this.scale.x*(.5-this.anchor.x),this.position.y)},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"outerCenterY",{get:function(){return this.position.y+this.size.height*this.scale.y*(.5-this.anchor.y)},set:function(t){this.position.set(this.position.x,t-this.size.height*this.scale.y*(.5-this.anchor.y))},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"outerWidth",{get:function(){return this.size.width*this.scale.x},enumerable:!0,configurable:!0}),Object.defineProperty(re.prototype,"outerHeight",{get:function(){return this.size.height*this.scale.y},enumerable:!0,configurable:!0}),re.prototype.getWorldPosition=function(t){return void 0===t&&(t=new Nt),this._dirty&&this.update(),this._transformWorld.toWorld(this.position,t)},re.prototype.getWorldBox=function(t){return void 0===t&&(t=new qt),this._dirty&&this.update(),this._transformWorld.toWorldBox(this._box,t)},re.prototype.convertToLocalPosition=function(t,e){return void 0===e&&(e=new Nt),t instanceof ee?t.getWorldPosition(e):e.set(t),this.worldTransform.toLocal(e)},re.prototype.centerTo=function(t){this.outerCenterX=t.x,this.outerCenterY=t.y},re.prototype.update=function(t){void 0===t&&(t=this.parentTransform);var e=this,i=e.position,r=e.anchor,n=e.rotation,o=e.size,s=e.scale,a=this._transformLocal,h=Math.PI/180,c=i.x,u=i.y,l=1,p=0,d=0,f=1;n&&(l=f=Math.cos(n*h),p=-(d=Math.sin(n*h))),l*=s.x,f*=s.y,d*=s.x,p*=s.y,(r.x||r.y)&&(c-=l*r.x*o.width+d*r.y*o.height,u-=p*r.x*o.width+f*r.y*o.height),a.set(l,p,d,f,c,u),this._transformWorld.set(a),t&&this._transformWorld.multiply(t),this._box.set(this.left,this.top,this.right,this.bottom),this._rect.set(0,0,o.width,o.height),this._dirty=0},re.EVENT=h(ee,{changed:""}),a([L(),g(1,ee.EVENT.changed).on(Nt.EVENT.changed)],re.prototype,"anchor",void 0),a([L(),g(1,ee.EVENT.changed).on(Nt.EVENT.changed)],re.prototype,"position",void 0),a([L(),g(1,ee.EVENT.changed).on(Nt.EVENT.changed)],re.prototype,"scale",void 0),a([L(),g(1,ee.EVENT.changed).on(B.EVENT.changed)],re.prototype,"size",void 0),a([L(),g(1,ee.EVENT.changed)],re.prototype,"rotation",void 0),a([g(1,ee.EVENT.changed)],re.prototype,"parentTransform",void 0),re=ee=a([v()],re));function re(){this.anchor=new Nt,this.position=new Nt,this.scale=new Nt(1,1),this.size=new B,this.rotation=0,this.parentTransform=void 0,this._transformLocal=Ht.IdentityNew(),this._transformWorld=Ht.IdentityNew(),this._dirty=0,this._box=new qt,this._rect=new Jt}var ne,oe,se=(Object.defineProperty(ae.prototype,"count",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(ae.prototype,"all",{get:function(){return this._items},enumerable:!0,configurable:!0}),Object.defineProperty(ae.prototype,"first",{get:function(){return this._items[0]},enumerable:!0,configurable:!0}),Object.defineProperty(ae.prototype,"last",{get:function(){return this._items[this._items.length-1]},enumerable:!0,configurable:!0}),ae.prototype[Symbol.iterator]=function(){var e,i,r,n,o,s;return T(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=E(this._items),i=e.next(),t.label=1;case 1:return i.done?[3,4]:0!==(r=i.value).nodeType?[3,3]:[4,r];case 2:t.sent(),t.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return n=t.sent(),o={error:n},[3,7];case 6:try{i&&!i.done&&(s=e.return)&&s.call(e)}finally{if(o)throw o.error}return[7];case 7:return[2]}})},ae.prototype.ofType=function(e){var i,r,n,o,s,a;return T(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),i=E(this._items),r=i.next(),t.label=1;case 1:return r.done?[3,4]:(n=r.value)instanceof e?[4,n]:[3,3];case 2:t.sent(),t.label=3;case 3:return r=i.next(),[3,1];case 4:return[3,7];case 5:return o=t.sent(),s={error:o},[3,7];case 6:try{r&&!r.done&&(a=i.return)&&a.call(i)}finally{if(s)throw s.error}return[7];case 7:return[2]}})},ae.prototype.getAt=function(t){return this._items[t]},ae.prototype.getByName=function(t,e){var i,r;try{for(var n=E(this._items),o=n.next();!o.done;o=n.next()){var s=o.value;if(s.name===t)return s;if(e){var a=s.children.getByName(t,!0);if(a)return a}}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},ae.prototype.add=function(t,e,i){t.parent!==this.owner&&(J(t.parent,ae.ERROR.parentNotNull),et(t,this._items,ae.ERROR.alreadyPresent));var r=0<=this._items.indexOf(t);return r?((i||t.name)&&rt(t,this.getByName(i||t.name)),i&&(t.name=i)):((i||t.name)&&J(this.getByName(i||t.name)),this._items.push(t),i&&(t.name=i),this.markDirty()),t.parent!==this.owner&&t.attach(this.owner),"number"==typeof e&&(t.zLayer=e,this.markDirty()),r||vn.instance.bus.trigger(this,this.EVENT.childAdded,t),t},ae.prototype.insertAt=function(t,e,i){if(e.parent!==this.owner&&(J(e.parent,ae.ERROR.parentNotNull),et(e,this._items,ae.ERROR.alreadyPresent)),0<=this._items.indexOf(e)){if(e.childIndex===t)return e;e.detach()}return this._items.splice(Math.min(t,this._items.length),0,e),this.markDirty(),e.attach(this.owner),i&&(e.name=i),vn.instance.bus.trigger(this,this.EVENT.childAdded,e),e},ae.prototype.remove=function(t,e){void 0===e&&(e=!1);var i=this._items;if("string"==typeof t&&(t=this.getByName(t)),t&&0!==i.length){var r=i.indexOf(t);r<0||(i.splice(r,1),this.markDirty(),e?t.detach():t.destroy(),vn.instance.bus.trigger(this,this.EVENT.childRemoved,t))}},ae.prototype.clear=function(t,e){var i,r;void 0===t&&(t=!1),void 0===e&&(e=!1);var n=this._items;if(0!==n.length){var o=n.slice(),s=!t&&n.filter(function(t){return 0!==t.nodeType});n.length=0,s&&n.push.apply(n,z(s)),this.markDirty();try{for(var a=E(o),h=a.next();!h.done;h=a.next()){var c=h.value;!t&&0!==c.nodeType||(e?c.detach():c.destroy(),vn.instance.bus.trigger(this,this.EVENT.childRemoved,c))}}catch(t){i={error:t}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}},ae.prototype.indexOf=function(t){return this._items.indexOf(t)},ae.prototype.contains=function(t){return"string"==typeof t?!!this.getByName(t):0<=this._items.indexOf(t)},ae.prototype.markDirty=function(){this._dirty=1},ae.prototype.resolveDirty=function(){this._dirty&&(1<this._items.length&&this._items.sort(function(t,e){return t.zLayer-e.zLayer}),this._dirty=0)},ae.prototype.serialize=function(t){return t.serialize(this._items)},ae.prototype.deserialize=function(t,e){var i,r;try{for(var n=E(t.map(function(t){return e.deserialize(t)})),o=n.next();!o.done;o=n.next()){var s=o.value;this.add(s)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},ae.EVENT=h(ae,{childAdded:"",childRemoved:""}),ae.ERROR=(ne=ae,oe={parentNotNull:"",alreadyPresent:""},Object.keys(oe).reduce(function(t,e){return t[e]=ne.name+":"+e,t},{})),ae);function ae(t){this.owner=t,this._items=new Array,this._dirty=0}var he=(Object.defineProperty(ce.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),ce.prototype.resolve=function(t){this._isCompleted||(this._isCompleted=!0,this._resolve&&this._resolve(t))},ce.prototype.reject=function(t){this._isCompleted||(this.alwaysResolve?this.resolve():(this._isCompleted=!0,this._reject&&this._reject(t)))},ce);function ce(){var i=this;this._resolve=void 0,this._reject=void 0,this._isCompleted=!1,this.alwaysResolve=!0,this.promise=new Promise(function(t,e){i._resolve=t,i._reject=e})}var ue=(le.prototype.withName=function(t){return this.name=t,this},le.prototype.withTarget=function(t){return this._target=t,this},Object.defineProperty(le.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),Object.defineProperty(le.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),le.prototype.async=function(t){return this._controller||(this._controller=new he),this._controller.alwaysResolve=!t,this._controller.promise},le.prototype.start=function(t){this._isNew&&(this._target||(this._target=t),this.reset(!0)),this._isRunning=!0,this._isNew=!1},le.prototype.pause=function(){this._isRunning=!1},le.prototype.reset=function(t){this._isCompleted=!1,this._isNew=!0,this._isRunning=!1,t||(this._controller&&!this._controller.isCompleted&&this._controller.reject(),this._controller=void 0)},le.prototype.destroy=function(){this._controller&&!this._controller.isCompleted&&this._controller.reject()},le.prototype.complete=function(){this._isCompleted=!0,this._controller&&this._controller.resolve()},le);function le(){this._isCompleted=!1,this._isNew=!0,this._isRunning=!1,this._controller=void 0,this._target=void 0,this.keepAlive=!1,this.name=void 0}var pe,de=(t(fe,pe=ue),fe.prototype.repeat=function(t){return this.repetitions=t,this},fe.prototype.repeatForever=function(){return this.repetitions=-1,this._repetitions=-1,this},fe.prototype.start=function(t){pe.prototype.start.call(this,t),this._startChild(),this._currentChild>=this._children.length&&this.complete()},fe.prototype.reset=function(){var e,t;pe.prototype.reset.call(this),this._currentChild=0,this._repetitions=-1===this.repetitions?-1:0;try{for(var i=E(this._children),r=i.next();!r.done;r=i.next())r.value.reset()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},fe.prototype.update=function(t){var e,i,r=this._children[this._currentChild];if(r.isRunning&&r.update(t),r.isCompleted&&(this._currentChild++,this._startChild(),this._currentChild>=this._children.length)){if(0===this._repetitions)return void this.complete();this._repetitions--,this._currentChild=0;try{for(var n=E(this._children),o=n.next();!o.done;o=n.next())o.value.reset()}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}this._startChild()}},fe.prototype.destroy=function(){var e,t;try{for(var i=E(this._children),r=i.next();!r.done;r=i.next())r.value.destroy()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},fe.prototype._startChild=function(){for(var t=this._children,e=t.length;this._currentChild<e;this._currentChild++){var i=t[this._currentChild];if(i.start(this._target),!i.isCompleted)break}},fe);function fe(t){var e=pe.call(this)||this;return e._children=t,e._currentChild=0,e._repetitions=0,e.repetitions=0,e}var ye,ve=(t(ge,ye=ue),ge.prototype.repeat=function(t){return this.repetitions=t,this},ge.prototype.repeatForever=function(){return this.repetitions=-1,this._repetitions=-1,this},ge.prototype.start=function(t){var e,i;ye.prototype.start.call(this,t);var r=!0;try{for(var n=E(this._children),o=n.next();!o.done;o=n.next()){var s=o.value;s.start(t),r=r&&s.isCompleted}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}r&&this.complete()},ge.prototype.reset=function(){var e,t;ye.prototype.reset.call(this),this._repetitions=-1===this.repetitions?-1:0;try{for(var i=E(this._children),r=i.next();!r.done;r=i.next())r.value.reset()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},ge.prototype.update=function(t){var e,i,r,n,o=!0;try{for(var s=E(this._children),a=s.next();!a.done;a=s.next()){var h=a.value;!h.isCompleted&&h.isRunning&&h.update(t),o=o&&h.isCompleted}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}if(o){if(0===this._repetitions)return void this.complete();this._repetitions--;try{for(var c=E(this._children),u=c.next();!u.done;u=c.next()){var l=u.value;l.reset(),l.start(this._target)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}},ge.prototype.destroy=function(){var e,t;try{for(var i=E(this._children),r=i.next();!r.done;r=i.next())r.value.destroy()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},ge);function ge(t){var e=ye.call(this)||this;return e._children=t,e._repetitions=0,e._target=void 0,e.repetitions=0,e}var _e,me=function(t){return t},be=function(t){return t*t*t},we=function(t){return--t*t*t+1},xe=function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2},Pe=(t(Te,_e=ue),Object.defineProperty(Te.prototype,"elapsed",{get:function(){return this._elapsed},enumerable:!0,configurable:!0}),Te.prototype.withEasing=function(t){return this.easing=t,this},Te.prototype.start=function(t){_e.prototype.start.call(this,t),this._elapsed>=this.duration&&this.complete()},Te.prototype.reset=function(){_e.prototype.reset.call(this),this._elapsed=0},Te.prototype.update=function(t){var e=Math.min(this.duration,this._elapsed+=t),i=Math.min(1,e/this.duration);this._step(this.easing(i)),e>=this.duration&&this.complete()},Te);function Te(t){var e=_e.call(this)||this;return e.duration=t,e._elapsed=0,e.easing=me,e}var Ee,ze=(t(Ae,Ee=Pe),Ae.prototype.update=function(t){Math.min(this.duration,this._elapsed+=t)>=this.duration&&this.complete()},Ae.prototype._step=function(){},Ae);function Ae(){return null!==Ee&&Ee.apply(this,arguments)||this}var Se,Ie={wait:function(t){return new ze(t)}},De=(t(Oe,Se=ue),Oe.Noop=function(){},Oe.Show=function(){this.visible=!0},Oe.Hide=function(){this.visible=!1},Oe.prototype.withDeltaTime=function(t){return void 0===t&&(t=0),this.useTime=!0,this.interval=t,this},Oe.prototype.withDelay=function(t){return this.delay=t,this},Oe.prototype.repeat=function(t){return this.repetitions=t,this},Oe.prototype.repeatForever=function(){return this.repetitions=-1,this},Oe.prototype.start=function(t){Se.prototype.start.call(this,t),this.useTime||0<this._pauseTime||0!==this._repetition||(this.func.apply(this._target,this.args),this.complete())},Oe.prototype.reset=function(){Se.prototype.reset.call(this),this._pauseTime=this.delay,this._repetition=this.repetitions,this._waitForPromise=!1,this.useTime?this._args=z([0],this.args||[]):this.args&&(this._args=z(this.args))},Oe.prototype.update=function(t){var e=this;if(!this._waitForPromise)if(0<this._pauseTime)this._pauseTime-=t;else{this.interval&&(this._pauseTime=this.interval),this.useTime&&(this._args[0]=t);var i=this.func.apply(this._target,this._args)||!1;if(this._isPromise(i))return this._waitForPromise=!0,void i.then(function(t){t||0===e._repetition?e.complete():(e._repetition--,e._waitForPromise=!1)});0===this._repetition&&(i=!0),this._repetition--,i&&this.complete()}},Oe.prototype._isPromise=function(t){return"object"==typeof t&&t&&"function"==typeof t.then},Oe);function Oe(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=Se.call(this)||this;return r.func=t,r._waitForPromise=!1,r._pauseTime=0,r._repetition=0,r._args=void 0,r.args=void 0,r.useTime=!1,r.repetitions=0,r.delay=0,r.interval=0,r.args=e,r}var Ce,je={call:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return new(De.bind.apply(De,z([void 0,t],e)))},callNext:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return(new(De.bind.apply(De,z([void 0,t],e)))).withDeltaTime()},callOn:function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return(new(De.bind.apply(De,z([void 0,e],i)))).withTarget(t)},after:function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return(new(De.bind.apply(De,z([void 0,e],i)))).withDelay(t)},loop:function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return(new(De.bind.apply(De,z([void 0,t],e)))).withDeltaTime().repeatForever()},each:function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return(new(De.bind.apply(De,z([void 0,e],i)))).withDeltaTime(t).repeatForever()},show:function(){return new De(De.Show)},hide:function(){return new De(De.Hide)},destroy:function(){return new De(this.node.destroy)}},ke=(t(Ne,Ce=Pe),Ne.prototype._step=function(t){this.callback.call(this._target,t)},Ne);function Ne(t,e){var i=Ce.call(this,t)||this;return i.callback=e,i}var Le,Re,Ve={ease:function(t,e){return new ke(t,e)}};(Re=Le=Le||{})[Re.none=0]="none",Re[Re.tree=1]="tree",Re[Re.transform=4]="transform";var Me=(Fe.prototype.chain=function(){var t=this._chainStarted;return this._chainStarted=!0,t},Fe.prototype.chainEnd=function(){this._chainStarted=!1},Fe.wrap=function(e){return Object.fromEntries(Object.getOwnPropertyNames(e).map(function(t){return[t,(i=e[t],function(){var t=this.chain(),e=i.apply(this,arguments);return t||(this.chainEnd(),this.scheduler.start(this.node,e)),e})];var i}))},Fe.addHelper=function(t,e){return Object.assign(e.prototype,Fe.wrap(t)),e},Fe);function Fe(t,e){this.node=t,this.scheduler=e,this._chainStarted=!1}var Be,He=(t($e,Be=Me),$e.prototype.action=function(t){return this.scheduler.start(this.node,t)},$e.prototype.async=function(t){return this.scheduler.runAsync(this.node,t)},$e.prototype.sequence=function(t){var e=this.chain(),i=new de(t(this));return e||(this.scheduler.start(this.node,i),this.chainEnd()),i},$e.prototype.parallel=function(t){var e=this.chain(),i=new ve(t(this));return e||(this.scheduler.start(this.node,i),this.chainEnd()),i},$e.prototype.update=function(){this.scheduler.runUpdate(this.node)},$e.prototype.stopUpdate=function(){this.scheduler.stopUpdate(this.node)},$e.prototype.stop=function(t){this.scheduler.stop(this.node,t)},$e.prototype.stopAll=function(){this.scheduler.stopAll(this.node)},$e.prototype.start=function(t,e){this.scheduler.start(this.node,t,e)},$e.prototype.pause=function(t){this.scheduler.pause(this.node,t)},$e.prototype.isDefined=function(t){return this.scheduler.isDefined(this.node,t)},$e.prototype.isRunning=function(t){return this.scheduler.isRunning(this.node,t)},$e.prototype.register=function(t,e,i){var r=this.isDefined(t);Q(!r||!!i,"Already defined %s",t),r&&this.stop(t),this.chain();var n=this.scheduler.addAction(this.node,e(this).withName(t));n.keepAlive=!0,n.pause(),this.chainEnd()},$e.prototype.get=function(t){return this.scheduler.get(this.node,t)},$e);function $e(){return null!==Be&&Be.apply(this,arguments)||this}var We,Ue=Me.addHelper(Ie,Me.addHelper(je,Me.addHelper(Ve,He))),Ge=(We=qe,Object.defineProperty(qe.prototype,"name",{get:function(){return this._name},set:function(t){this._name!==t&&(this._parent&&t&&rt(this,this._parent.children.getByName(t)),this._name=t)},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"isDirty",{get:function(){return 0!==this._dirty},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"isOnTree",{get:function(){return this._parent&&this._parent.isOnTree||!1},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"worldTransform",{get:function(){return this._parent?this._parent.worldTransform:Ht.Identity},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"childIndex",{get:function(){return this._parent?(this._parent.children.resolveDirty(),this._parent.children.indexOf(this)):-1},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"deepHash",{get:function(){var t=this._parent&&this._parent.deepHash;if(t){var e=(0<=this._zLayer?32:0)+this.childIndex+1;return t.substring(0,t.length-1)+String.fromCharCode(e)+String.fromCharCode(32)}},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"deepHashDebug",{get:function(){var i=this.deepHash;if(i)return i=i.replace("root-",""),z(Array(i.length)).map(function(t,e){return i.charCodeAt(e)}).join("-")},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"zLayer",{get:function(){return this._zLayer},set:function(t){this._zLayer!==t&&(this._zLayer=t,this._parent&&this._parent.children.markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(qe.prototype,"run",{get:function(){return this._helperScheduler||(this._helperScheduler=new Ue(this,vn.instance.scheduler))},enumerable:!0,configurable:!0}),qe.prototype.getAncestor=function(t){var e=this;if("string"==typeof t)for(;(e=e.parent)&&e&&e.name!==t;);else for(;(e=e.parent)&&e&&!(e instanceof t););return e},qe.prototype.isDescendantOf=function(t){for(var e=this;(e=e.parent)&&e&&e!==t;);return!!e},qe.prototype.initialize=function(){return this},qe.prototype.update=function(t){},qe.prototype.queue=function(t){var e,i;if(0<this.children.count){this.children.resolveDirty();try{for(var r=E(this.children.all),n=r.next();!n.done;n=r.next())n.value.queue(t)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}},qe.prototype.attach=function(t){return t===this._parent||(J(this._parent),(this._parent=t).children.add(this),this._dirty|=1,t.isOnTree&&this.onTreeReady()),this},qe.prototype.onTreeReady=function(){var e,t;try{for(var i=E(this.children.all),r=i.next();!r.done;r=i.next())r.value.onTreeReady()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},qe.prototype.detach=function(){var t=this._parent;t&&(this._parent=void 0,t.children.remove(this,!0),this._dirty|=1)},qe.prototype.destroy=function(){this.detach(),vn.instance.bus.removeSource(this),vn.instance.bus.removeOwner(this),this.children.clear(!0),this.run.stopAll()},Object.defineProperty(qe.prototype,"isPaused",{get:function(){return this._isPaused},enumerable:!0,configurable:!0}),qe.prototype.pause=function(t){var e,i;if(this._isPaused=!0,t)try{for(var r=E(this.children.all),n=r.next();!n.done;n=r.next())n.value.pause(t)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},qe.prototype.resume=function(t){var e,i;if(this._isPaused=!1,t)try{for(var r=E(this.children.all),n=r.next();!n.done;n=r.next())n.value.resume(t)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},qe.prototype.trigger=function(t,e){vn.instance.bus.trigger(this,t,e)},qe.prototype.subscribe=function(t,e,i){return vn.instance.bus.addListener(t,e,i).withContext(this).withOwner(this)},qe.prototype.unsubscribe=function(t){vn.instance.bus.removeListenerByTag(this,t)},qe.prototype.resolveDirty=function(){0!=(1&this._dirty)&&this._resolveDirtyTree(),0!=(4&this._dirty)&&this._resolveDirtyTransform()},qe.prototype._resolveDirtyTree=function(){this._dirty&=-2},qe.prototype._resolveDirtyTransform=function(){var e,t;this._dirty&=-5;try{for(var i=E(this.children.all),r=i.next();!r.done;r=i.next())r.value._dirty|=4}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},qe.InstanceIDTrack=0,qe.Comparer={deepHashLowToHigh:function(t,e){var i=t.deepHash||"",r=e.deepHash||"";return i<r?-1:r<i?1:0},deepHashHighToLow:function(t,e){var i=t.deepHash||"",r=e.deepHash||"";return i<r?1:r<i?-1:0}},a([L()],qe.prototype,"name",null),a([L(),g(1).on(se.EVENT.childAdded,se.EVENT.childRemoved)],qe.prototype,"children",void 0),a([L()],qe.prototype,"zLayer",null),qe=We=a([v()],qe));function qe(){this._parent=void 0,this._dirty=4,this._zLayer=0,this._name=void 0,this._isPaused=!1,this.tag=void 0,this.children=new se(this),this.instanceId=++We.InstanceIDTrack}Ge.prototype.nodeType=0;var Ye,Xe=(t(Ke,Ye=Pe),Ke.prototype.start=function(t){Ye.prototype.start.call(this,t),this._target.opacity===this.opacity&&this.complete()},Ke.prototype.reset=function(){Ye.prototype.reset.call(this),this._initialValue=this._target&&this._target.opacity||0},Ke.prototype.complete=function(){this._target.opacity=this.opacity,Ye.prototype.complete.call(this)},Ke.prototype._step=function(t){var e=this.opacity-this._initialValue;this._target.opacity=this._initialValue+e*t},Ke);function Ke(t,e){void 0===e&&(e=0);var i=Ye.call(this,t)||this;return i._initialValue=0,i.opacity=e,i}var Ze,Qe={fadeIn:function(t){return new Xe(t,1)},fadeOut:function(t){return new Xe(t,0)},fadeTo:function(t,e){return new Xe(t,e)}},Je=(t(ti,Ze=Pe),ti.prototype.start=function(t){t instanceof ji&&(t=t.position),Ze.prototype.start.call(this,t),this._target.equals(this._endValue)&&this.complete()},ti.prototype.reset=function(){Ze.prototype.reset.call(this),this._target&&this._startValue.set(this._target),this._endValue.set("function"==typeof this.destination?this.destination():this.destination),this._deltaX=this._endValue.x-this._startValue.x,this._deltaY=this._endValue.y-this._startValue.y},ti.prototype._step=function(t){this._target.set(this._startValue.x+this._deltaX*t,this._startValue.y+this._deltaY*t)},ti.prototype.complete=function(){this._target.set(this._endValue),Ze.prototype.complete.call(this)},ti);function ti(t,e){var i=Ze.call(this,t)||this;return i.duration=t,i.destination=e,i._startValue=new Nt,i._endValue=new Nt,i._deltaX=0,i._deltaY=0,i._target=void 0,i}var ei,ii={moveTo:function(t,e){return new Je(t,e)}},ri=(t(ni,ei=Pe),ni.prototype.start=function(t){t instanceof ji&&(t=t.size),ei.prototype.start.call(this,t),this._target&&!this._target.equals(this._endValue)||this.complete()},ni.prototype.reset=function(){ei.prototype.reset.call(this),this._target&&this._startValue.set(this._target),this._endValue.set("function"==typeof this.destination?this.destination():this.destination),this._deltaX=this._endValue.width-this._startValue.width,this._deltaY=this._endValue.height-this._startValue.height},ni.prototype._step=function(t){this._target.set(this._startValue.width+this._deltaX*t,this._startValue.height+this._deltaY*t)},ni.prototype.complete=function(){this._target&&this._target.set(this._endValue),ei.prototype.complete.call(this)},ni);function ni(t,e){var i=ei.call(this,t)||this;return i.destination=e,i._startValue=new B,i._deltaX=0,i._deltaY=0,i._endValue=new B,i}var oi,si={resizeTo:function(t,e){return new ri(t,e)}},ai=(t(hi,oi=Pe),hi.prototype.start=function(t){oi.prototype.start.call(this,t),this.toValue===this._target.rotation&&this.complete()},hi.prototype.reset=function(){oi.prototype.reset.call(this),this._target&&(this._startValue=this._target.rotation),this._delta=this.toValue-this._startValue},hi.prototype._step=function(t){this._target.rotation=this._startValue+this._delta*t},hi.prototype.complete=function(){this._target.rotation=this.toValue,oi.prototype.complete.call(this)},hi);function hi(t,e){var i=oi.call(this,t)||this;return i.duration=t,i.toValue=e,i._startValue=0,i._delta=0,i}var ci,ui={rotateTo:function(t,e){return new ai(t,e)}},li=(t(pi,ci=Pe),pi.prototype.start=function(t){t instanceof ji&&(t=t.transform.scale),ci.prototype.start.call(this,t),this._target&&!this._target.equals(this._endValue)||this.complete()},pi.prototype.reset=function(){ci.prototype.reset.call(this),this._target&&this._startValue.set(this._target),this._endValue.set("function"==typeof this.value?this.value():this.value),this._deltaX=this._endValue.x-this._startValue.x,this._deltaY=this._endValue.y-this._startValue.y},pi.prototype._step=function(t){this._target.set(this._startValue.x+this._deltaX*t,this._startValue.y+this._deltaY*t)},pi.prototype.complete=function(){this._target&&this._target.set(this._endValue),ci.prototype.complete.call(this)},pi);function pi(t,e){var i=ci.call(this,t)||this;return i.value=e,i._startValue=new Nt,i._deltaX=0,i._deltaY=0,i._endValue=new Nt,i}var di,fi,yi={scaleTo:function(t,e){return new li(t,e)}},vi=(Object.defineProperty(gi.prototype,"isUndefined",{get:function(){return!this.preferred&&!this.min&&!this.max},enumerable:!0,configurable:!0}),gi.prototype.canExpand=function(t,e){void 0===e&&(e=0);var i=this.max&&gi.getAbsoluteNumber(this.max,e)>t||!1;return this.preferred===gi.FILL&&!this.max||i},gi.prototype.canShrink=function(t,e){void 0===e&&(e=0);var i=this.min&&gi.getAbsoluteNumber(this.min,e)<t||!1;return this.preferred===gi.FILL&&!this.min||i},gi.prototype.canAdapt=function(){return this.preferred===gi.ADAPT},gi.prototype.canFill=function(){return this.preferred===gi.FILL},gi.prototype.setAbsolute=function(t,e,i){t?this.preferred={kind:"absolute",value:t}:null===t&&(this.preferred=void 0),e?this.min={kind:"absolute",value:e}:null===e&&(this.min=void 0),i?this.max={kind:"absolute",value:i}:null===i&&(this.max=void 0)},gi.prototype.setAsFill=function(t,e){this.preferred=gi.FILL,this.setAbsolute(void 0,t,e)},gi.prototype.setAsAdapt=function(){this.preferred=gi.ADAPT,this.setAbsolute(null,null,null)},gi.prototype.getValue=function(t,e,i){var r=this.getValueMin(t),n=this.getValueMax(e),o=this.preferred;if(void 0===o)return i?r:n;if(o!==gi.TRANSFORM){if(o===gi.FILL)return i?void 0!==r?r:t:void 0!==n?Math.min(n,e):e;if(o!==gi.ADAPT)return"relative"===o.kind?e*o.value:o.value}},gi.prototype.getValueMin=function(t){return void 0===t&&(t=0),this.min&&gi.getAbsoluteNumber(this.min,t)},gi.prototype.getValueMax=function(t){return void 0===t&&(t=0),this.max?gi.getAbsoluteNumber(this.max,t):this.preferred===gi.FILL?t:void 0},gi.prototype.clear=function(){this.preferred=void 0,this.max=void 0,this.min=void 0},gi.getAbsoluteNumber=function(t,e){return"absolute"===t.kind?t.value:t.value*e},gi.TRANSFORM=1,gi.FILL=2,gi.ADAPT=3,gi);function gi(t){this.max=void 0,this.min=void 0,this.preferred=t}(fi=di=di||{})[fi.none=0]="none",fi[fi.left=1]="left",fi[fi.top=2]="top",fi[fi.right=4]="right",fi[fi.bottom=8]="bottom",fi[fi.horizontal=5]="horizontal",fi[fi.vertical=10]="vertical",fi[fi.all=15]="all";var _i,mi,bi,wi,xi=(t(Pi,_i=Ge),Object.defineProperty(Pi.prototype,"name",{get:function(){return this._name},set:function(t){b("Layout can't change name")},enumerable:!0,configurable:!0}),Object.defineProperty(Pi.prototype,"contentRect",{get:function(){return this._contentRect},enumerable:!0,configurable:!0}),Pi.prototype.isUndefined=function(){return!this.left&&!this.right&&!this.top&&!this.bottom&&(!this.width||this.width.isUndefined)&&(!this.height||this.height.isUndefined)},Pi.prototype.isFloat=function(){return 3===this.role},Pi.prototype.isDocked=function(t){return 0===t?!(this.left||this.right||this.top||this.bottom):t?!(0!=(1&t)&&!this.left||0!=(2&t)&&!this.top||0!=(4&t)&&!this.right||0!=(8&t)&&!this.bottom):!this.isDocked(0)},Pi.prototype.setDock=function(t,e){return void 0===e&&(e=0),0!=(1&t)&&(this.left=this._getNumberValue(e)),0!=(2&t)&&(this.top=this._getNumberValue(e)),0!=(4&t)&&(this.right=this._getNumberValue(e)),0!=(8&t)&&(this.bottom=this._getNumberValue(e)),this},Pi.prototype._getNumberValue=function(t){return null===t?void 0:{kind:Math.abs(t)<1?"relative":"absolute",value:t}},Pi.prototype.canAdapt=function(){return this.width&&this.width.canAdapt()||this.height&&this.height.canAdapt()},Pi.prototype.canFill=function(){return this.width&&this.width.canFill()||this.height&&this.height.canFill()},Pi.prototype.setAsFill=function(){return this.clear(),(this.width||(this.width=new vi)).setAsFill(),(this.height||(this.height=new vi)).setAsFill(),this},Pi.prototype.useNodeSize=function(){this.width=new vi(vi.TRANSFORM),this.height=new vi(vi.TRANSFORM)},Pi.prototype.clear=function(){return this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.width&&this.width.clear(),this.height&&this.height.clear(),this},Pi.prototype.attach=function(t){var r=this;return Q(t instanceof ji),_i.prototype.attach.call(this,t),this.subscribe(t.children,t.children.EVENT.childAdded,function(t,e,i){i instanceof ji&&r.onChildAdded(i)}),this.subscribe(t.children,t.children.EVENT.childRemoved,function(t,e,i){i instanceof ji&&r.onChildRemoved(i)}),this},Pi.prototype.onTreeReady=function(){_i.prototype.onTreeReady.call(this);var t=this.parent.parent;t instanceof ji&&this.subscribe(t.size,t.size.EVENT.changed,this.onParentSizeChanged),this.layout()},Pi.prototype.onChildAdded=function(t){this.layout()},Pi.prototype.onChildRemoved=function(t){this.layout()},Pi.prototype.onParentSizeChanged=function(){(this.canFill()||this.isDocked())&&this.layout()},Pi.prototype.layout=function(t){if(this.parent&&(t||!this._isProcessing&&!this._isParentLayoutProcessing())){var e=this._getLayoutRect();e&&(this._isProcessing=!0,this._measureSelf(e),this._arrangeSelf(e),this._isProcessing=!1)}},Pi.prototype._measureSelf=function(t){var e=this._desiredSize;if(e.width=void 0,e.height=void 0,this.isUndefined())return e.width=this.parent.size.width,e.height=this.parent.size.height,void this._measureChildren();var i=this.left&&vi.getAbsoluteNumber(this.left,t.width||0),r=this.right&&vi.getAbsoluteNumber(this.right,t.width||0),n=this.top&&vi.getAbsoluteNumber(this.top,t.height||0),o=this.bottom&&vi.getAbsoluteNumber(this.bottom,t.height||0);this.width&&!this.width.isUndefined&&(this.width.canAdapt()||this.width.canFill()?e.width=void 0:this.width.preferred===vi.TRANSFORM?e.width=this.parent.size.width:e.width=this.width.getValue(0,(t.width||0)-(i||0)-(r||0),!0)),this.height&&!this.height.isUndefined&&(this.height.canAdapt()||this.height.canFill()?e.height=void 0:this.height.preferred===vi.TRANSFORM?e.height=this.parent.size.height:e.height=this.height.getValue(0,(t.height||0)-(o||0)-(n||0),!0)),this._measureChildren()},Pi.prototype._measureChildren=function(){var e,t,i=this.parent,r=this.padding,n=0,o=0;try{for(var s=E(i.children.ofType(ji)),a=s.next();!a.done;a=s.next()){var h=a.value;if(h.visible){var c=h.getLayout();if(c)c.isContent()&&(c._measureSelf(this._getChildLayoutMeasures(c)),n=Math.max(n,this._getDesiredHorizontalSpace(c)),o=Math.max(o,this._getDesiredVerticalSpace(c)));else{var u=h.transform;n=Math.max(n,u.right+r.right+u.left===0?r.left:0),o=Math.max(o,u.top+r.top+u.bottom===0?r.bottom:0)}}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}this._childrenSize.width=n,this._childrenSize.height=o,this.width&&this.width.canAdapt()&&(this._desiredSize.width=n||void 0),this.height&&this.height.canAdapt()&&(this._desiredSize.height=o||void 0)},Pi.prototype._arrangeSelf=function(t){var e=this.parent,i=e.size,r=i.width,n=i.height,o=e.transform,s=this._desiredSize,a=this.left&&vi.getAbsoluteNumber(this.left,t.width||0),h=this.right&&vi.getAbsoluteNumber(this.right,t.width||0),c=this.top&&vi.getAbsoluteNumber(this.top,t.height||0),u=this.bottom&&vi.getAbsoluteNumber(this.bottom,t.height||0);if(this.width&&!this.width.isUndefined?this.width.canFill()&&(s.width=this.width.getValue(0,t.width-(a||0)-(h||0))):void 0!==a&&void 0!==h?s.width=t.width-h-a:void 0===s.width&&(s.width=o.size.width),this.height&&!this.height.isUndefined?this.height.canFill()&&(s.height=this.height.getValue(0,t.height-(c||0)-(u||0))):void 0!==u&&void 0!==c?s.height=t.height-c-u:void 0===s.height&&(s.height=o.size.height),3!==this.role){var l=(s.width||0)-r,p=(s.height||0)-n;void 0!==a&&void 0!==h?o.outerCenterX=t.x+a+(t.width-h-a)/2+l*(.5-o.anchor.x):void 0!==a?o.left=a+t.x+l*o.anchor.x:void 0!==h?o.right=t.x+t.width-h+l*(1-o.anchor.x):o.left=t.x,void 0!==u&&void 0!==c?o.outerCenterY=t.y+u+(t.height-c-u)/2+p*(.5-o.anchor.y):void 0!==u?o.bottom=u+t.y+p*o.anchor.y:void 0!==c?o.top=t.y+t.height-c+p*(1-o.anchor.y):o.bottom=t.y}var d=this._contentRect,f=this.padding;d.set(s.width?f.left:0,s.height?f.bottom:0,s.width?s.width-f.left-f.right:0,s.height?s.height-f.bottom-f.top:0),o.size.set(s.width||0,s.height||0),this._arrangeChildren()},Pi.prototype._arrangeChildren=function(){var e,t,i=this.parent;try{for(var r=E(i.children.ofType(ji)),n=r.next();!n.done;n=r.next()){var o=n.value.getLayout();o&&o._arrangeSelf(0===o.boxReference?this.contentRect:i.transform.rect)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},Pi.prototype.isContent=function(){return 1===this.role||0===this.role&&!this.isDocked()},Pi.prototype._getDesiredHorizontalSpace=function(t,e){void 0===e&&(e=!1);var i=t._desiredSize.width;return i&&(i+=(t.left&&vi.getAbsoluteNumber(t.left,0)||0)+(0!==t.boxReference||e?0:this.padding.left+this.padding.right)),Math.max(0,i||0)},Pi.prototype._getDesiredVerticalSpace=function(t,e){void 0===e&&(e=!1);var i=t._desiredSize.height;return i&&(i+=(t.bottom&&vi.getAbsoluteNumber(t.bottom,0)||0)+(0!==t.boxReference||e?0:this.padding.bottom+this.padding.top)),Math.max(0,i||0)},Pi.prototype._getChildLayoutMeasures=function(t){var e=this._desiredSize,i={width:e.width,height:e.height},r=this.padding;return 0===t.boxReference&&(void 0!==i.width&&(i.width=Math.max(0,i.width-r.left-r.right)),void 0!==i.height&&(i.height=Math.max(0,i.height-r.top-r.bottom))),i},Pi.prototype._getLayoutRect=function(){var t=this.parent.getAncestor(ji);if(t){var e=t.getLayout();return e&&0===this.boxReference?e.contentRect:t.transform.rect}},Pi.prototype._isParentLayoutProcessing=function(){var t=this.parent.getAncestor(ji),e=t&&t.getLayout();return e&&e._isProcessing||!1},Pi.NAME="$layout",Pi);function Pi(){var t=null!==_i&&_i.apply(this,arguments)||this;return t._name=Pi.NAME,t.zLayer=Number.MAX_SAFE_INTEGER,t.left=void 0,t.right=void 0,t.top=void 0,t.bottom=void 0,t.width=void 0,t.height=void 0,t.boxReference=0,t.role=1,t._isProcessing=!1,t._childrenSize=mt(),t._desiredSize={width:void 0,height:void 0},t.padding=new qt,t._contentRect=new Jt,t}xi.prototype.nodeType=1,(mi=xi=xi||{}).ADAPT=vi.ADAPT,mi.FILL=vi.FILL,(bi=mi.BoxReference||(mi.BoxReference={}))[bi.content=0]="content",bi[bi.border=1]="border",(wi=mi.Role||(mi.Role={}))[wi.default=0]="default",wi[wi.content=1]="content",wi[wi.decorator=2]="decorator",wi[wi.float=3]="float";var Ti,Ei,zi=xi;(Ei=Ti=Ti||{})[Ei.local=0]="local",Ei[Ei.world=1]="world";var Ai,Si=(t(Ii,Ai=Ue),Ii);function Ii(t,e){var i=Ai.call(this,t,e)||this;return i.node=t,i}var Di,Oi,Ci=Me.addHelper(Qe,Me.addHelper(ii,Me.addHelper(si,Me.addHelper(ui,Me.addHelper(yi,Si))))),ji=(t(ki,Di=Ge),Oi=ki,Object.defineProperty(ki.prototype,"run",{get:function(){return this._helperScheduler||(this._helperScheduler=new Ci(this,vn.instance.scheduler))},enumerable:!0,configurable:!0}),Object.defineProperty(ki.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!0,configurable:!0}),Object.defineProperty(ki.prototype,"opacityGlobal",{get:function(){var t=this.getAncestor(Oi);return t?t.opacityGlobal*this.opacity:this.opacity},enumerable:!0,configurable:!0}),Object.defineProperty(ki.prototype,"isScreenVisible",{get:function(){if(!this.visible)return!1;for(var t=this.parent;t;t=t.parent)if(t instanceof Oi&&!t.visible)return!1;return!0},enumerable:!0,configurable:!0}),ki.prototype.attach=function(t){return Di.prototype.attach.call(this,t),this.transform.parentTransform=t.worldTransform,this},ki.prototype.detach=function(){Di.prototype.detach.call(this),this.transform.parentTransform=void 0},ki.prototype.queue=function(t){if(this.visible){this.children.resolveDirty();for(var e=this.children.all,i=0,r=e.length;i<r&&!(0<=(o=e[i]).zLayer);i++)o.queue(t);var n=this.getRenderer()||this.draw&&this;for(n&&t.push(n);i<r;i++){var o;(o=e[i]).queue(t)}}},ki.prototype.getLayout=function(t,e){var i=this.children.getByName(zi.NAME);return!i||!e||i instanceof e||(i.destroy(),i=void 0),i||t&&this.children.add((new(e||zi)).initialize())},ki.prototype.containsPoint=function(t,e){if(e)return this.containsPoint(this.worldTransform.toLocal(_t(t)));var i=t.x,r=t.y,n=this.transform.size;return 0<=i&&0<=r&&i<=n.width&&r<=n.height},ki.prototype.getRenderer=function(){},ki.prototype._resolveDirtyTransform=function(){this.transform.update(),Di.prototype._resolveDirtyTransform.call(this)},a([L(),g(4).on(ie.EVENT.changed)],ki.prototype,"transform",void 0),a([m("transform")],ki.prototype,"position",void 0),a([m("transform")],ki.prototype,"size",void 0),a([L()],ki.prototype,"opacity",void 0),ki=Oi=a([v()],ki));function ki(){var t=null!==Di&&Di.apply(this,arguments)||this;return t.transform=new ie,t.opacity=1,t.visible=!0,t}var Ni,Li=(t(Ri,Ni=ji),Object.defineProperty(Ri.prototype,"isOnTree",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(Ri.prototype,"deepHash",{get:function(){return"root-"+String.fromCharCode(32)},enumerable:!0,configurable:!0}),Ri.prototype.initialize=function(){return Ni.prototype.initialize.call(this),this.size.set(this.view.size),this.transform.position.y-=this.view.size.height,this},Ri.prototype.queue=function(t){t.push(this),Ni.prototype.queue.call(this,t)},Ri.prototype.draw=function(t){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.view.size.width,this.view.size.height)},Ri.CoordinateSystem={bottomLeft:0,topLeft:1},Ri);function Ri(t){var e=Ni.call(this)||this;return e.view=t,e}var Vi=(Mi.prototype.addInput=function(t){0<=this._providers.indexOf(t)?b("already present"):(function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!t||!t.trim())throw new Error(Z(e,i))}(t.inputType),et(t.inputType,this._providers.map(function(t){return t.inputType})),this._providers.push(t))},Mi.prototype.register=function(){var e,t;try{for(var i=E(this._providers),r=i.next();!r.done;r=i.next())r.value.register()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},Mi.prototype.unregister=function(){var e,t;try{for(var i=E(this._providers),r=i.next();!r.done;r=i.next())r.value.unregister()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},Mi.prototype.addTarget=function(t){this._targets.indexOf(t)<0&&(this._targets.push(t),this._dirty=!0)},Mi.prototype.removeTarget=function(t){var e=this._targets.indexOf(t);0<=e&&this._targets.splice(e,1)},Mi.prototype.update=function(){var e,t,i;this._resolveDirty();try{for(var r=E(this._providers),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.isRegistered)for(;i=o.consume();)this.dispatch(i)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},Mi.prototype.dispatch=function(t){var e,i;try{for(var r=E(this._targets),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.isPaused||o.handle(t),t.isStopped)return}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},Mi.prototype._resolveDirty=function(){this._dirty&&(this._targets.sort(Ge.Comparer.deepHashHighToLow),this._dirty=!1)},Mi);function Mi(){this._providers=new Array,this._targets=new Array,this._dirty=!1}var Fi=(Object.defineProperty(Bi.prototype,"isStopped",{get:function(){return this._isStopped},enumerable:!0,configurable:!0}),Bi.prototype.stop=function(){this._isStopped=!0},Bi);function Bi(t){this.inputType=t,this._isStopped=!1}function Hi(t,e){var i=N.getInjects(t);return e&&(i=i.filter(function(t){return t.kind===e})),i}function $i(t,e){return t.multiple?e.getAll(t.key,!!t.named):t.optional?e.getOptional(t.key):e.getRequired(t.key)}function Wi(t){return"function"==typeof t?t.name:t.constructor?t.constructor.name:"unknown"}var Ui=(Object.defineProperty(Gi.prototype,"name",{get:function(){return Wi(this.typeConstructor)},enumerable:!0,configurable:!0}),Object.defineProperty(Gi.prototype,"dependencies",{get:function(){return this.typeConstructor.$injects&&Hi(this.typeConstructor).map(Zi.encodeKey)},enumerable:!0,configurable:!0}),Gi.prototype.get=function(e){var t;if(!this.instance){var i=[];this.typeConstructor.$injects&&i.push.apply(i,z(function(t,e){for(var i=Hi(e,"constructor"),r=i.reduce(function(t,e){return Math.max(t,e.target)},-1)+1,n=new Array(r),o=0;o<r;o++)n[i[o].target]=$i(i[o],t);return n}(e,this.typeConstructor))),this.parameters&&i.push.apply(i,z(this.parameters));var r=this.instance=new((t=this.typeConstructor).bind.apply(t,z([void 0],i)));Hi(this.typeConstructor,"property").forEach(function(t){r[t.target]=$i(t,e)})}return this.instance},Gi);function Gi(t,e){this.typeConstructor=t,this.parameters=e,this.instance=void 0}var qi=(Object.defineProperty(Yi.prototype,"name",{get:function(){return Wi(this.instance)},enumerable:!0,configurable:!0}),Object.defineProperty(Yi.prototype,"dependencies",{get:function(){var t=this._getPropertyDependency();return t&&t.map(Zi.encodeKey)},enumerable:!0,configurable:!0}),Yi.prototype.get=function(e){var i=this;return this._resolved||(this._getPropertyDependency().forEach(function(t){i.instance[t.target]=$i(t,e)}),this._resolved=!0),this.instance},Yi.prototype._getPropertyDependency=function(){var t=this.instance&&this.instance.constructor;return t&&Hi(t,"property")},Yi);function Yi(t){this.instance=t,this._resolved=!1}var Xi=(Object.defineProperty(Ki.prototype,"isInitialized",{get:function(){return!0===this._initializer},enumerable:!0,configurable:!0}),Ki.prototype.withName=function(t){return this.named=t,this},Ki.prototype.addDependency=function(){for(var t,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(t=this._dependencies||(this._dependencies=[])).push.apply(t,z(e)),this},Ki.prototype.addOnPreInitialize=function(t,e){return this.addHook("pre",t,e)},Ki.prototype.addOnPostInitialize=function(t,e){return this.addHook("post",t,e)},Ki.prototype.exportAsGlobal=function(t,e){return this._exportGlobalKey=t,e&&(this._exportGlobalObject=e),this},Ki.prototype.initialize=function(){return f(this,void 0,void 0,function(){var e=this;return T(this,function(t){switch(t.label){case 0:return!0===this._initializer?[2]:(this._initializer||(this._logger=this.container.getOptional("ContainerLogger"),this._initializer=new Ji(this.key+"+"+this.resolver.name,function(){return f(e,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._initializeDependencies(this._dependencies)];case 1:return t.sent(),this._instance=this.resolver.get(this.container),tt(this._instance),[4,this._runHooks("pre")];case 2:return t.sent(),[4,this._initializeInstance()];case 3:return t.sent(),[4,this._runHooks("post")];case 4:return t.sent(),this._export(),[2]}})})},this._logger)),[4,this._initializer.initialize()]);case 1:return t.sent(),[2]}})})},Ki.prototype.addHook=function(t,e,i){return(this._hooks||(this._hooks=[])).push({kind:t,dependencies:i&&(Array.isArray(i)?i:[i])||void 0,callback:e}),this},Ki.prototype._export=function(){this._exportGlobalKey&&((this._exportGlobalObject||window)[this._exportGlobalKey]=this._instance,this._log("Exported as global '%s'",this._exportGlobalKey))},Ki.prototype._initializeInstance=function(){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return(e=this._instance).initialize?(this._log("Service initializing"),(i=e.initialize())?[4,i]:[3,2]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ki.prototype._initializeDependencies=function(r){return f(this,void 0,void 0,function(){var e,i=this;return T(this,function(t){switch(t.label){case 0:return r?r.length<1?[2]:(this._log("Initializing dependencies",r),e=r.flatMap(function(t){return i.container.getRegistration(t)}).filter(function(t){return!!t}).map(function(t){return t.initialize()}),[4,Promise.all(e)]):[2];case 1:return t.sent(),[2]}})})},Ki.prototype._runHooks=function(u){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c=this;return T(this,function(t){switch(t.label){case 0:if(!(e=this._hooks&&this._hooks.filter(function(t){return t.kind===u}))||e.length<1)return[2];this._log("Hooks %s started",u),i=this._instance,t.label=1;case 1:t.trys.push([1,9,10,11]),r=E(e),n=r.next(),t.label=2;case 2:return n.done?[3,8]:(o=n.value).dependencies?[4,this._initializeDependencies(o.dependencies)]:[3,5];case 3:return t.sent(),[4,o.callback.apply(o,z([i],o.dependencies.map(function(t){return c.container.get(t)})))];case 4:return t.sent(),[3,7];case 5:return[4,o.callback(i)];case 6:t.sent(),t.label=7;case 7:return n=r.next(),[3,2];case 8:return[3,11];case 9:return s=t.sent(),a={error:s},[3,11];case 10:try{n&&!n.done&&(h=r.return)&&h.call(r)}finally{if(a)throw a.error}return[7];case 11:return this._log("Hooks %s completed",u),[2]}})})},Ki.prototype._log=function(t){for(var e,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];this._logger&&(e=this._logger).info.apply(e,z(["%s > "+t,this.key],i))},Ki);function Ki(t,e,i){this.key=t,this.container=e,this.resolver=i,this._hooks=void 0,this._initializer=void 0,this._dependencies=void 0,this.named=void 0;var r=i.dependencies;r&&(this._dependencies=r.slice())}var Zi=(Qi.encodeKey=function(t){var e=t.key,i=e[e.length-1];return"?"!==i&&t.optional&&!t.multiple?e+"?":"+"!==i&&!t.optional&&t.multiple?e+"+":"*"!==i&&t.optional&&t.multiple?e+"*":e},Qi.decodeKey=function(t){var e=!1,i=!1,r=t[t.length-1];return"?"===r?i=!(e=!0):"+"===r?i=!(e=!1):"*"===r?e=i=!0:r="",r&&(t=t.substring(0,t.length-r.length)),{key:t,optional:e,multiple:i}},Qi.prototype.register=function(t,e){var i=e,r=this._entries.get(t);return r?Array.isArray(r)?r.push(i):this._entries.set(t,[r,i]):this._entries.set(t,i),e},Qi.prototype.registerInstance=function(t,e){return this.register(t,new Xi(t,this,new qi(e)))},Qi.prototype.registerType=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return this.register(t,new Xi(t,this,new Ui(e,i)))},Qi.prototype.unregister=function(t){this._entries.delete(t)},Qi.prototype.getRegistration=function(t,e,i,r){if("boolean"==typeof e&&(r=i,i=e,e=void 0),"string"==typeof t){var n=Qi.decodeKey(t),o=n.key!==t;void 0===r&&(r=o&&n.multiple),void 0===i&&(i=!o||!n.optional),t=n.key}var s=this._entries.get(t);if(e&&s&&(Array.isArray(s)?1===(s=s.filter(function(t){return t.named===e})).length&&(s=s[0]):s.named!==e&&(s=void 0)),!s&&i)throw new Error("[Container] Registration "+t+" not found");if(Array.isArray(s)&&!1===r)throw new Error("[Container] Registration "+t+" has multiple entries");return r&&!Array.isArray(s)?[s]:s},Qi.prototype.get=function(t,e){var i=this.getRegistration(t,e);if(i)return Array.isArray(i)?i.map(function(t){return t.resolver.get(this)},this):i.resolver.get(this)},Qi.prototype.getRequired=function(t,e){return this.getRegistration(t,e,!0,!1).resolver.get(this)},Qi.prototype.getOptional=function(t,e){var i=this.getRegistration(t,e,!1,!1);return i&&i.resolver.get(this)},Qi.prototype.getAll=function(t,e){var i=this,r=!1;"boolean"==typeof e&&(r=!0===e,e=void 0);var n=this.getRegistration(t,e,!1,!0);return n?r?n.map(function(t){return[t.named,t.resolver.get(i)]}):n.map(function(t){return t.resolver.get(i)}):[]},Qi.prototype.create=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return new Ui(t,e).get(this)},Qi.prototype.initialize=function(){return f(this,void 0,void 0,function(){var n,e=this;return T(this,function(t){switch(t.label){case 0:return this._initializer||(this._logger,n={progress:0},this._initializer=new Ji("Container",function(){return f(e,void 0,void 0,function(){var e,i,r=this;return T(this,function(t){switch(t.label){case 0:return e=z(this._entries.values()).flat(),this._logger&&this._logger.info("Initializing: %s registrations",e.length),i=e.map(function(e){return f(r,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,e.initialize()];case 1:return t.sent(),n.progress++,[2]}})})}),[4,Promise.all(i)];case 1:return t.sent(),[2]}})})},this._logger)),[4,this._initializer.initialize()];case 1:return t.sent(),[2]}})})},Qi);function Qi(){this._entries=new Map,this._logger=void 0,this._initializer=void 0}var Ji=(Object.defineProperty(tr.prototype,"isSuccess",{get:function(){return!0===this._initializer},enumerable:!0,configurable:!0}),tr.prototype.initialize=function(){return f(this,void 0,void 0,function(){var e,i=this;return T(this,function(t){switch(t.label){case 0:return!0!==this._initializer?[3,1]:[2];case 1:return this._initializer?[4,this._initializer]:[3,3];case 2:return[2,t.sent()];case 3:return t.trys.push([3,5,,6]),[4,this._initializer=new Promise(function(t){i.logger&&i.logger.info("%s > Initializing",i.key),t(i._execution())})];case 4:return t.sent(),this.markAsInitialized(!0),[3,6];case 5:return e=t.sent(),this.markAsInitialized(!1,e),[3,6];case 6:return[2]}})})},tr.prototype.markAsInitialized=function(t,e){this._execution=void 0,t&&(this._initializer=!0),this.logger&&(t?this.logger.info("%s > Initialized",this.key):this.logger.error("%s > Failed Initialize",this.key,e))},tr);function tr(t,e,i){this.key=t,this.logger=i,this._initializer=void 0,this._execution=void 0,this._execution=e}var er=(ir.prototype.set=function(t,e,i){this._cache.set(t,e)},ir.prototype.getCache=function(t){return this._cache.createOrGetChild(t)},ir);function ir(){this._cache=new rr}var rr=(nr.prototype.createOrGetChild=function(t){void 0===t&&(t=Math.random().toString());var e=this._items.get(t);if(e)return e;e=new nr(t);var i="$child-"+t;return this.set(i,e),e},nr.prototype.set=function(t,e){this._items.set(t,e)},nr.prototype.get=function(t,e){var i=this._items.get(t);return void 0===i&&!e&&this._parent&&(i=this._parent.get(t)),i},nr.prototype.has=function(t,e){var i=this._items.has(t);return i||e||!this._parent||(i=this._parent.has(t)),i},nr.prototype.destroy=function(){var e,t;try{for(var i=E(this._items),r=i.next();!r.done;r=i.next()){var n=d(r.value,2)[1];n.destroy&&n.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this._items.clear()},nr);function nr(t,e){this.alias=t,this._items=new Map,this._parent=void 0,this._parent=e}var or,sr=(t(ar,or=ji),ar.prototype.attach=function(t){return or.prototype.attach.call(this,t),this.transform.size.set(t.size),this},ar.prototype.enter=function(t,e){},ar.prototype.leave=function(t){},ar);function ar(){return null!==or&&or.apply(this,arguments)||this}var hr={transient:!0},cr=(Object.defineProperty(ur.prototype,"currentScene",{get:function(){return this._sceneStack[this._sceneStack.length-1]||this.EMPTY_SCENE},enumerable:!0,configurable:!0}),Object.defineProperty(ur.prototype,"currentSceneName",{get:function(){return this.currentScene.name},enumerable:!0,configurable:!0}),ur.prototype.registerScene=function(t){"function"==typeof t&&(t=w(w(w(w({},hr),{screenName:Wi(t)}),t),{screenType:t})),this._entries.set(t.screenName,t)},ur.prototype.navigate=function(r,n){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return e=this.currentScene,i="string"==typeof r?this._getScreenInstance(r):r,[4,this._enterScene(i,e,n)];case 1:return t.sent(),this._sceneStack[this._sceneStack.length-1]=i,[4,this._leaveScene(e,i)];case 2:return t.sent(),[2]}})})},ur.prototype._enterScene=function(e,i,r){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return e.attach(this.root),[4,e.enter(i,r)];case 1:return t.sent(),[2]}})})},ur.prototype._leaveScene=function(i,r){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:return i&&i.name?(e=this._entries.get(i.name),[4,i.leave(r)]):[2];case 1:return t.sent(),e&&e.transient&&(e.instance=void 0,i.destroy()),[2]}})})},ur.prototype._getScreenInstance=function(t){var e=this._entries.get(t);return tt(e),e.instance||(e.instance=this._createScreenInstance(t)),e.instance},ur.prototype._createScreenInstance=function(t){var e=this._entries.get(t);return tt(e),e.instance=this.container?this.container.create(e.screenType):new e.screenType},ur);function ur(t,e,i){this.root=t,this.container=e,this.logger=i,this.EMPTY_SCENE=new sr,this._sceneStack=new Array(this.EMPTY_SCENE),this._entries=new Map}var lr=(Object.defineProperty(pr.prototype,"faceName",{get:function(){return this.info.face},enumerable:!0,configurable:!0}),Object.defineProperty(pr.prototype,"fontSize",{get:function(){return this.info.size},enumerable:!0,configurable:!0}),Object.defineProperty(pr.prototype,"lineHeight",{get:function(){return this.common.lineHeight},enumerable:!0,configurable:!0}),pr.prototype.addChar=function(t){this._chars.set(t.id,t)},pr.prototype.getChar=function(t){return this._chars.get(t)},pr.prototype.getCharFrame=function(t){var e=this._frames.get(t);if(e)return e;var i=this.getChar(t);if(i){var r=bt(i.x,i.y,i.width,i.height),n=new wt(this.texture,r);return this._frames.set(t,n),n}},pr.prototype.addKerning=function(t,e,i){var r=this._kernings.get(t);r?r.set(e,i):this._kernings.set(t,new Map([[e,i]]))},pr.prototype.getKerning=function(t,e){var i=this._kernings.get(t);return i&&i.get(e)||0},pr);function pr(t,e,i){this.info=t,this.common=e,this.texture=i,this._chars=new Map,this._kernings=new Map,this._frames=new Map}var dr="fontDefinition",fr=(yr.prototype.preProcess=function(t,i){return f(this,void 0,void 0,function(){var e;return T(this,function(t){return i.dataType!==dr&&(i.dataType||"fnt"!==dt.getFileExtension(i.url))||(e=w({timeout:0,format:"xml"},"object"==typeof i.processingOptions?i.processingOptions:{}),i.dataType=dr,i.loader="fetch",i.loaderOptions={timeout:e.timeout,medium:"text"===e.format?"text":"document"}),[2]})})},yr.prototype.postProcess=function(m,b){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u,l,p,d,f,y,v,g,_;return T(this,function(t){switch(t.label){case 0:return b.dataType!==dr?[2]:b.data&&b.data instanceof XMLDocument?(it((e=b.data).documentElement.nodeName,"font"),i=function n(o){if(o.nodeType===o.ELEMENT_NODE)return w({$attributes:o.getAttributeNames().reduce(function(t,e){return t[e]=o.getAttribute(e),t},{})},Array.from(o.children).reduce(function(t,e){if(e.nodeType===o.ELEMENT_NODE){var i=n(e),r=t[e.nodeName];t[e.nodeName]=r?Array.isArray(r)?(r.push(i),r):[r,i]:i}return t},{}))}(e.documentElement),r=i.info,n=i.common,o=i.pages.page,s=i.chars.char,a=i.kernings.kerning,function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!1!==t)throw new Error(Z(e,i))}(Array.isArray(o)),[4,m.load(dt.changeFile(b.url,o.$attributes.file))]):[2];case 1:h=t.sent(),c=new lr({face:r.$attributes.face,size:parseInt(r.$attributes.size,10),bold:parseInt(r.$attributes.bold,10),italic:parseInt(r.$attributes.italic,10),charset:r.$attributes.charset,unicode:parseInt(r.$attributes.unicode,10),stretchH:parseInt(r.$attributes.stretchH,10),smooth:parseInt(r.$attributes.smooth,10),aa:parseInt(r.$attributes.aa,10),padding:r.$attributes.padding.split(",").map(function(t){return parseInt(t,10)}),spacing:r.$attributes.spacing.split(",").map(function(t){return parseInt(t,10)}),outline:parseInt(r.$attributes.outline,10)},{lineHeight:parseInt(n.$attributes.lineHeight,10),base:parseInt(n.$attributes.base,10),scaleW:parseInt(n.$attributes.scaleW,10),scaleH:parseInt(n.$attributes.scaleH,10),pages:parseInt(n.$attributes.pages,10),packed:parseInt(n.$attributes.packed,10),alphaChnl:parseInt(n.$attributes.alphaChnl,10),redChnl:parseInt(n.$attributes.redChnl,10),greenChnl:parseInt(n.$attributes.greenChnl,10),blueChnl:parseInt(n.$attributes.blueChnl,10)},h);try{for(u=E(s),l=u.next();!l.done;l=u.next())f=l.value,c.addChar({id:parseInt(f.$attributes.id,10),x:parseInt(f.$attributes.x,10),y:parseInt(f.$attributes.y,10),width:parseInt(f.$attributes.width,10),height:parseInt(f.$attributes.height,10),xoffset:parseInt(f.$attributes.xoffset,10),yoffset:parseInt(f.$attributes.yoffset,10),xadvance:parseInt(f.$attributes.xadvance,10),page:parseInt(f.$attributes.page,10),chnl:parseInt(f.$attributes.chnl,10)})}catch(t){y={error:t}}finally{try{l&&!l.done&&(v=u.return)&&v.call(u)}finally{if(y)throw y.error}}try{for(p=E(a),d=p.next();!d.done;d=p.next())f=d.value,c.addKerning(parseInt(f.$attributes.first,10),parseInt(f.$attributes.second,10),parseInt(f.$attributes.amount,10))}catch(t){g={error:t}}finally{try{d&&!d.done&&(_=p.return)&&_.call(p)}finally{if(g)throw g.error}}return b.data=c,vn.instance.cache.set(b.url,c),vn.instance.fonts.set(c.faceName,c),[2]}})})},yr.DATA_TYPE=dr,yr);function yr(){this.alias=dr}var vr,gr,_r="pointer",mr=(Object.defineProperty(br.prototype,"isRegistered",{get:function(){return this._isRegistered},enumerable:!0,configurable:!0}),Object.defineProperty(br.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),br.prototype.register=function(){this._isRegistered||(this._target=window.document,this.target&&(this._addPointerEventListener("pointerdown",0),this._addPointerEventListener("pointerup",2),this._addPointerEventListener("pointerleave",5),this._addPointerEventListener("pointermove",1),this._addPointerEventListener("pointerover",4),this._addPointerEventListener("pointercancel",3),this._addListener("contextmenu",this.onContextMenu),this._addListener("wheel",this.onWheel),this._isRegistered=!0))},br.prototype.unregister=function(){var e,t;if(this._isRegistered){var i=this.target;if(i){try{for(var r=E(this._listeners),n=r.next();!n.done;n=r.next()){var o=d(n.value,2),s=o[0],a=o[1];i.removeEventListener(s,a)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this._isRegistered=!1}}},br.prototype.consume=function(){return this._queue.shift()},br.prototype._addListener=function(t,e){tt(this.target);var i=this.target,r=this._listeners.get(t);r||(r=e.bind(this),this._listeners.set(t,r)),i.addEventListener(t,r,!0)},br.prototype._addPointerEventListener=function(t,e){var i=this;tt(this.target);var r=this.target,n=this._listeners.get(t);n||(n=function(t){t.preventDefault(),t.stopImmediatePropagation(),i._enqueue(t,e)},this._listeners.set(t,n)),r.addEventListener(t,n,!0)},br.prototype.onContextMenu=function(t){t.preventDefault(),t.stopPropagation()},br.prototype.onWheel=function(t){t.stopPropagation(),this._queue.push(new xr(6,t.button,0,"",_t(t.deltaX/window.devicePixelRatio,t.deltaY/window.devicePixelRatio)))},br.prototype._enqueue=function(t,e){this._queue.push(new xr(e,t.button,t.pointerId,t.pointerType,_t(t.clientX*window.devicePixelRatio,-t.clientY*window.devicePixelRatio)))},br);function br(){this._listeners=new Map,this._target=void 0,this._queue=new Array,this._isRegistered=!1,this.inputType=_r}(gr=vr=vr||{})[gr.down=0]="down",gr[gr.move=1]="move",gr[gr.up=2]="up",gr[gr.cancel=3]="cancel",gr[gr.enter=4]="enter",gr[gr.leave=5]="leave",gr[gr.wheel=6]="wheel";var wr,xr=(t(Pr,wr=Fi),Pr);function Pr(t,e,i,r,n){var o=wr.call(this,_r)||this;return o.eventType=t,o.button=e,o.pointerId=i,o.pointerType=r,o.position=n,o}var Tr=(Er.prototype.get=function(t,e){var i=this._entries.get(t);if(i&&i.actions&&!(i.actions.length<1))for(var r=0,n=i.actions,o=n.length;r<o;r++)if(n[r].name===e)return n[r]},Er.prototype.addAction=function(t,e){var i=this._entries.get(t);if(i){var r=i.actions||(i.actions=[]);r.indexOf(e)<0&&r.push(e)}else i={owner:t,actions:[e],runUpdate:!1},this._entries.set(t,i);return e},Er.prototype.runAsync=function(t,e){return this.addAction(t,e).async()},Er.prototype.runUpdate=function(t){var e=this._entries.get(t);e?e.runUpdate=!0:(e={owner:t,actions:void 0,runUpdate:!0},this._entries.set(t,e))},Er.prototype.stopUpdate=function(t){var e=this._entries.get(t);e&&(e.runUpdate=!1)},Er.prototype.start=function(t,e,i){return"string"==typeof e?e=this.get(t,e):this.addAction(t,e),e&&(i&&e.reset(),e.start(t)),e},Er.prototype.pause=function(t,e){var i=this.get(t,e);return!!i&&(i.pause(),!0)},Er.prototype.isRunning=function(t,e){var i=this.get(t,e);return i&&i.isRunning||!1},Er.prototype.isDefined=function(t,e){return!!this.get(t,e)},Er.prototype.stop=function(t,e){var i=this._entries.get(t);if(i&&i.actions&&!(i.actions.length<1))for(var r=0,n=i.actions,o=n.length;r<o;r++){var s=n[r];if(s.name===e)return void(s.keepAlive?s.pause():(n[r].destroy(),n.splice(r,1)))}},Er.prototype.stopAll=function(t){var e,i,r=this._entries.get(t);if(r&&r.actions){try{for(var n=E(r.actions),o=n.next();!o.done;o=n.next())o.value.destroy()}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}this._entries.delete(t)}},Er.prototype.update=function(t){var e,i;try{for(var r=E(this._entries),n=r.next();!n.done;n=r.next()){var o=d(n.value,2)[1],s=o.owner,a=o.actions,h=o.runUpdate;if(s.isPaused)return;if(a&&a.length)for(var c=a.length;0<=--c;){var u=a[c];!u.isCompleted||u.keepAlive?u.isRunning&&!u.isCompleted&&u.update(t):(u.destroy(),a.splice(c,1))}h&&s.update(t)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},Er);function Er(){this._entries=new Map}var zr=(Ar.prototype.add=function(t,e){return this._items.set(t,e),this},Ar.prototype.addEntries=function(){for(var e,t,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];try{for(var n=E(i),o=n.next();!o.done;o=n.next()){var s=d(o.value,2),a=s[0],h=s[1];this._items.set(a,h)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return this},Ar.prototype.get=function(t){return this._items.get(t)},Ar.prototype.set=function(t,e){return this._items.set(t,e),this},Ar.prototype.destroy=function(){var e,t;if(0<this._items.size)try{for(var i=E(this._items.values()),r=i.next();!r.done;r=i.next()){var n=r.value;"object"==typeof n&&"function"==typeof n.destroy&&n.destroy()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this._items.clear()},Ar);function Ar(){this._items=new Map,this[Symbol.iterator]=this._items[Symbol.iterator].bind(this._items)}var Sr=(Object.defineProperty(Ir.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(Ir.prototype,"entries",{get:function(){return this._entries},enumerable:!0,configurable:!0}),Object.defineProperty(Ir.prototype,"frameCount",{get:function(){return this._entries.length},enumerable:!0,configurable:!0}),Ir.prototype.getAt=function(t){return function(t,e,i){if(t<0||t>e.length-1)throw new Error(Z(i))}(t,this._entries),this._entries[t]},Ir.prototype.addFrame=function(t,e){var i=this._entries[this._entries.length-1];return this._entries.push({frame:t,time:i?i.time+i.duration:0,duration:e}),this._duration+=e,this},Ir);function Ir(t,e){var i,r;if(this._duration=0,this._entries=new Array,this.loops=!0,t)try{for(var n=E(t),o=n.next();!o.done;o=n.next()){var s=o.value;this.addFrame(s,e||.1)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}}var Dr="spriteDefinition",Or=(Cr.prototype.postProcess=function(l,p){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u;return T(this,function(t){switch(t.label){case 0:if(p.dataType!==Dr)return[2];if(!p.data)return[2];if("object"!=typeof p.data)return[2];e=p.data,i=function(e,i){var r,n,o,s,a,h,c;return T(this,function(t){switch(t.label){case 0:return r=dt.changeFile(p.url,i.source),[4,l.load(r)];case 1:switch(n=t.sent(),i.type){case"static":vn.instance.spriteFrames.add(e,new wt(n));break;case"animation":o=Math.floor(n.size.width/i.tileWidth),s=Math.floor(n.size.height/i.tileHeight),a=z(Array(o*s)).map(function(t,e){return new wt(n,bt(e%o*i.tileWidth,Math.floor(e/o)*i.tileHeight,i.tileWidth,i.tileHeight))}),h=i.frames?i.frames.map(function(t){return a[t]}):a,(c=new Sr(h,i.frameDuration)).loops=!!i.loops,vn.instance.animations.add(e,c)}return[2]}})},t.label=1;case 1:t.trys.push([1,6,7,8]),r=E(Object.entries(e)),n=r.next(),t.label=2;case 2:return n.done?[3,5]:(o=d(n.value,2),s=o[0],a=o[1],[5,i(s,a)]);case 3:t.sent(),t.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return h=t.sent(),c={error:h},[3,8];case 7:try{n&&!n.done&&(u=r.return)&&u.call(r)}finally{if(c)throw c.error}return[7];case 8:return[2]}})})},Cr.DATA_TYPE=Dr,Cr);function Cr(){this.alias=Dr}var jr=(Object.defineProperty(kr.prototype,"entries",{get:function(){return this._props?Object.entries(this._props):[]},enumerable:!0,configurable:!0}),Object.defineProperty(kr.prototype,"keys",{get:function(){return this._props?Object.keys(this._props):[]},enumerable:!0,configurable:!0}),kr.prototype.hasAny=function(){return!!this._props},kr.prototype.has=function(t){return void 0!==(this._props&&this._props[t])},kr.prototype.get=function(t,e){var i;return null!=(i=this._props&&this._props[t])?i:e},kr.prototype.set=function(t,e){(this._props||(this._props={}))[t]=e},kr.prototype.remove=function(t){this._props&&delete this._props[t]},kr.prototype.clear=function(){this._props=void 0},kr);function kr(t){var e,i;if(this._props=void 0,t){Array.isArray(t)||(t=Object.entries(t)),t[0]&&"object"==typeof t[0]&&(t=t.map(function(t){return[t.name,t.value]}));try{for(var r=E(t),n=r.next();!n.done;n=r.next()){var o=d(n.value,2),s=o[0],a=o[1];this.set(s,a)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}}}var Nr=(Object.defineProperty(Lr.prototype,"isExternal",{get:function(){return this._isExternal},enumerable:!0,configurable:!0}),Object.defineProperty(Lr.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!0,configurable:!0}),Lr.prototype.load=function(t){var e,i,r,n;if(this._isLoaded=!0,this.name=t.name,this.image=t.image,this.columns=t.columns,this.imageheight=t.imageheight,this.imagewidth=t.imagewidth,this.margin=t.margin,this.spacing=t.spacing,this.tilecount=t.tilecount,this.tileheight=t.tileheight,this.tilewidth=t.tilewidth,this.tiles.clear(),this.terrains.length=0,t.tiles)try{for(var o=E(t.tiles),s=o.next();!s.done;s=o.next()){var a=s.value,h=new Fr(a.id,a.properties);h.type=a.type,h.probability=null!=(n=a.probability)?n:1,a.terrain&&h.setAllTerrain(a.terrain),this.tiles.add(h)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}t.terrains&&(r=this.terrains).push.apply(r,z(t.terrains.map(function(t){var e=new Rr(t.name,t.properties);return e.tile=t.tile,e})))},Lr.prototype.embed=function(){this._isExternal=!1,this.source=void 0},Lr.prototype.getTileRect=function(t,e){return void 0===e&&(e=!1),e&&(t-=this.firstGlobalId),{x:t%this.columns*this.tilewidth,y:Math.floor(t/this.columns)*this.tileheight,width:this.tilewidth,height:this.tileheight}},Lr.parse=function(t){var e=new Lr;return e.load(t),e},Lr);function Lr(t,e){void 0===t&&(t=0),this._isExternal=!1,this._isLoaded=!1,this.firstGlobalId=0,this.source=void 0,this.name="",this.image=void 0,this.columns=0,this.imageheight=0,this.imagewidth=0,this.margin=0,this.spacing=0,this.tilecount=0,this.tileheight=0,this.tilewidth=0,this.terrains=new Array,this.tiles=new Vr,this.properties=new jr,this.firstGlobalId=t,this.source=e,this._isExternal=!!e,this._isLoaded=!this._isExternal}var Rr=function(t,e){this.name=t,this.tile=0,this.properties=new jr(e)},Vr=(Mr.prototype.add=function(t){this._items.set(t.id,t)},Mr.prototype.get=function(t){return this._items.get(t)},Mr.prototype.clear=function(){this._items.clear()},Mr);function Mr(){this._items=new Map}var Fr=(Br.prototype.getTerrain=function(t){return this._terrain?this._terrain[t]:-1},Br.prototype.setTerrain=function(t,e){(this._terrain||(this._terrain=[-1,-1,-1,-1]))[t]=e},Br.prototype.getAllTerrain=function(){return this._terrain||[-1,-1,-1,-1]},Br.prototype.setAllTerrain=function(t){this._terrain=t.slice()},Br.prototype.clearTerrain=function(){this._terrain=void 0},Br);function Br(t,e){this.id=t,this._terrain=void 0,this.type=void 0,this.probability=1,this.properties=new jr(e)}var Hr=($r.prototype.getObject=function(t){var e,i;try{for(var r=E(this.layers.getAll()),n=r.next();!n.done;n=r.next()){var o=n.value;if("objectgroup"===o.type){var s=o.getById(t);if(s)return s}}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},$r.prototype.getObjectsByType=function(e){return this.layers.getAllByType("objectgroup").flatMap(function(t){return t.getAllByType(e)})},$r.prototype.getTile=function(t){var e,i=this.tilesets.getByGlobalTileId(t);return null===(e=i)||void 0===e?void 0:e.tiles.get(t-i.firstGlobalId)},$r.parse=function(t){var e,i,r,n,o=new $r(t.width,t.height,t.properties);o.tilewidth=t.tilewidth,o.tileheight=t.tileheight,o.orientation=t.orientation,o.backgroundColor=t.backgroundcolor;try{for(var s=E(t.tilesets),a=s.next();!a.done;a=s.next()){var h=a.value;"source"in h?o.tilesets.addExternal(h.firstgid,h.source):o.tilesets.addEmbedded(h.firstgid,Nr.parse(h))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}try{for(var c=E(t.layers),u=c.next();!u.done;u=c.next()){var l=u.value,p=void 0;switch(l.type){case"tilelayer":p=$r.parseTileLayer(l);break;case"imagelayer":p=$r.parseImageLayer(l);break;case"objectgroup":p=$r.parseObjectLayer(l);break;default:continue}o.layers.add(p)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return o},$r.parseTileLayer=function(t){var e=new Yr(t.width,t.height,t.properties);e.name=t.name,e.opacity=t.opacity,e.visible=t.visible,e.x=t.x,e.y=t.y;for(var i=0,r=t.data,n=r.length;i<n;i++)e.addTile(r[i],i);return e},$r.parseImageLayer=function(t){var e=new Kr(t.properties);return e.name=t.name,e.opacity=t.opacity,e.visible=t.visible,e.image=t.image,e.x=t.offsetx,e.y=t.offsety,e.anchorY=1,e.anchorX=0,e},$r.parseObjectLayer=function(t){var e,i,r,n=new Zr(t.properties);n.name=t.name,n.opacity=t.opacity,n.visible=t.visible,n.x=t.x,n.y=t.y;try{for(var o=E(t.objects),s=o.next();!s.done;s=o.next()){var a=s.value,h=void 0;if(a.text){var c=h=new on(a.id,a.properties);c.text.text=a.text.text,c.text.font=a.text.fontfamily||"",c.text.fontSize=a.text.pixelsize,c.text.wrap=a.text.wrap,c.text.color=a.text.color,a.text.halign&&(c.text.hAlign=a.text.halign),a.text.valign&&(c.text.vAlign=a.text.valign)}else if(a.gid){var u=h=new en(a.id,a.properties);u.globalTileId=536870911&a.gid,u.flippedX=(2147483648&a.gid)>>>0==2147483648,u.flippedY=(1073741824&a.gid)>>>0==1073741824,u.flippedZ=(536870912&a.gid)>>>0==536870912}else a.polyline?(r=(h=new hn(a.id,a.properties)).points).push.apply(r,z(a.polyline.map(function(t){return{x:t.x,y:t.y}}))):h=new tn(a.id,a.properties);h.name=a.name||void 0,h.type=a.type||void 0,h.visible=a.visible,h.x=a.x,h.y=a.y,h.width=a.width,h.height=a.height,h.rotation=a.rotation,n.addObject(h)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}return n},$r);function $r(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),this.width=t,this.height=e,this.tileheight=0,this.tilewidth=0,this.orientation="orthogonal",this.backgroundColor=void 0,this.layers=new Gr,this.tilesets=new Wr,this.properties=new jr(i)}var Wr=(Ur.prototype.addExternal=function(t,e){this._items.push(new Nr(t,e))},Ur.prototype.addEmbedded=function(t,e){e.firstGlobalId=t,this._items.push(e)},Ur.prototype.getByGlobalTileId=function(t){var e,i;try{for(var r=E(this._items),n=r.next();!n.done;n=r.next()){var o=n.value;if(t>=o.firstGlobalId&&t<o.firstGlobalId+o.tilecount)return o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},Ur.prototype.getNotLoaded=function(){return this._items.filter(function(t){return!t.isLoaded})},Ur.prototype.replaceExternal=function(e,t){var i=this._items.findIndex(function(t){return t.source===e}),r=this._items[i];tt(r),t.firstGlobalId=r.firstGlobalId,t.source=r.source,this._items[i]=t},Ur.prototype.loadExternal=function(e,t){var i=this._items.find(function(t){return t.source===e});tt(i),i.load(t)},Ur);function Ur(){this._items=new Array,this[Symbol.iterator]=this._items[Symbol.iterator].bind(this._items)}var Gr=(Object.defineProperty(qr.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),qr.prototype.add=function(t,e){this._items.push(t),void 0!==e&&0<=e&&this.setIndex(t,e)},qr.prototype.get=function(t){var e,i;if("number"==typeof t)return this._items[t];try{for(var r=E(this._items),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.name===t)return o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},qr.prototype.getAll=function(){return this._items},qr.prototype.getAllByName=function(e){return this._items.filter(function(t){return t.name===e})},qr.prototype.getAllByType=function(e){return this._items.filter(function(t){return t.type===e})},qr.prototype.setIndex=function(t,e){var i=this._items.indexOf(t);return 0<=i&&e!==i&&(this._items.splice(i,1),this._items.splice(e,0,t)),i},qr);function qr(){this._items=[]}var Yr=(Xr.prototype.addTile=function(t,e){this._tiles[e%this.width][this.height-Math.floor(e/this.width)-1]=t},Xr.prototype.getTileIdAt=function(t,e){return 536870911&(this._tiles[t][e]||0)},Xr.prototype.isTileFlippedX=function(t,e){return(2147483648&this._tiles[t][e])>>>0!=0},Xr.prototype.isTileFlippedY=function(t,e){return(1073741824&this._tiles[t][e])>>>0!=0},Xr.prototype.isTileFlippedZ=function(t,e){return(536870912&this._tiles[t][e])>>>0!=0},Xr);function Xr(t,e,i){this.width=t,this.height=e,this.type="tilelayer",this.name="",this.opacity=1,this.visible=!0,this.x=0,this.y=0;for(var r=this._tiles=new Array(t),n=0;n<r.length;n++){r[n]=new Array(e);for(var o=0;o<e;o++)r[n][o]=0}this.properties=new jr(i)}var Kr=function(t){this.type="imagelayer",this.name="",this.opacity=1,this.visible=!0,this.x=0,this.y=0,this.anchorY=1,this.anchorX=0,this.image=void 0,this.properties=new jr(t)},Zr=(Object.defineProperty(Qr.prototype,"length",{get:function(){return this._objects.length},enumerable:!0,configurable:!0}),Qr.prototype.getAll=function(){return this._objects},Qr.prototype.getById=function(e){return this._objects.filter(function(t){return t.id===e})[0]},Qr.prototype.getByName=function(e){return this._objects.filter(function(t){return t.name===e})[0]},Qr.prototype.getAllByName=function(e){return this._objects.filter(function(t){return t.name===e})},Qr.prototype.getByType=function(e){return this._objects.filter(function(t){return t.type===e})[0]},Qr.prototype.getAllByType=function(e){return this._objects.filter(function(t){return t.type===e})},Qr.prototype.addObject=function(t){this._objects.push(t)},Qr);function Qr(t){this.type="objectgroup",this.name="",this.opacity=1,this.visible=!0,this.x=0,this.y=0,this._objects=[],this.properties=new jr(t)}var Jr,tn=function(t,e){this.id=t,this.name=void 0,this.type=void 0,this.visible=!0,this.x=0,this.y=0,this.width=0,this.height=0,this.rotation=0,this.properties=new jr(e)},en=(t(rn,Jr=tn),rn);function rn(){var t=null!==Jr&&Jr.apply(this,arguments)||this;return t.globalTileId=0,t.flippedX=!1,t.flippedY=!1,t.flippedZ=!1,t}var nn,on=(t(sn,nn=tn),sn);function sn(){var t=null!==nn&&nn.apply(this,arguments)||this;return t.text={font:"",fontSize:12,color:void 0,text:"",wrap:!1,hAlign:"left",vAlign:"top"},t}var an,hn=(t(cn,an=tn),cn);function cn(){var t=null!==an&&an.apply(this,arguments)||this;return t.points=[],t}var un="tiledMap",ln=(pn.prototype.postProcess=function(p,d){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u,l;return T(this,function(t){switch(t.label){case 0:if(d.dataType!==un)return[2];if(!d.data)return[2];if("object"!=typeof d.data)return[2];it((e=d.data).type,"map"),i=Hr.parse(e),t.label=1;case 1:t.trys.push([1,6,7,8]),r=E(i.tilesets.getNotLoaded()),n=r.next(),t.label=2;case 2:return n.done?[3,5]:(o=n.value).source?(a=(s=i.tilesets).replaceExternal,h=[o.source],[4,p.load(dt.changeFile(d.url,o.source),"tiledTileset")]):[3,4];case 3:a.apply(s,h.concat([t.sent()])),t.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return c=t.sent(),u={error:c},[3,8];case 7:try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(u)throw u.error}return[7];case 8:return d.data=i,vn.instance.cache.set(d.url,i),[2]}})})},pn.DATA_TYPE=un,pn);function pn(){this.alias=un}var dn="tiledTileset",fn=(yn.prototype.postProcess=function(r,n){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return n.dataType!==dn?[2]:n.data?"object"!=typeof n.data?[2]:(it((e=n.data).type,"tileset"),(i=Nr.parse(e)).image?[4,r.load(dt.changeFile(n.url,i.image))]:[3,2]):[2];case 1:t.sent(),t.label=2;case 2:return n.data=i,vn.instance.cache.set(n.url,i),[2]}})})},yn.DATA_TYPE=dn,yn);function yn(){this.alias=dn}var vn=(gn.prototype.initialize=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return this._setupComponents(),[4,this.container.initialize()];case 1:return t.sent(),this._loop=new U(this._loopCallback.bind(this)),[2]}})})},gn.prototype.run=function(){this._loop.start()},gn.prototype.pause=function(){this._loop.pause()},gn.prototype._setupComponents=function(){var e,t,i=this,r=this.view=new $;r.initialize();var n=this.root=new Li(r).initialize();this.director=new cr(n,this.container),this.input.addInput(new mr),this.input.register();var o=this.loader;o.registerLoader(new ft),o.registerLoader(new vt),o.registerProcessor(new Et),o.registerProcessor(new It),o.registerProcessor(new fr),o.registerProcessor(new Or),o.registerProcessor(new ln),o.registerProcessor(new fn),window.addEventListener("blur",function(){i.pause()}),window.addEventListener("focus",function(){i.run(),r.canvas.focus()});try{for(var s=E(y.getRegistrations()),a=s.next();!a.done;a=s.next()){var h=a.value;0===h.kind?this.container.registerType(h.key,h.value).withName(h.named):this.container.registerInstance(h.key,h.value).withName(h.named)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},gn.prototype._loopCallback=function(t){var e,i;this.input.update(),this.scheduler.update(t);var r,n=this.view.context,o=new Array;for(o.push(this.root);r=o.pop();)r.isDirty&&r.resolveDirty(),0<r.children.count&&o.push.apply(o,z(r.children.all));var s=new Array;this.root.queue(s);try{for(var a=E(s),h=a.next();!h.done;h=a.next())h.value.draw(n)}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},gn.instance=void 0,gn);function gn(){this._loop=void 0,this.view=void 0,this.scheduler=new Tr,this.bus=new X,this.container=new Zi,this.loader=new nt,this.cache=new er,this.spriteFrames=new zr,this.animations=new zr,this.fonts=new Map,this.audio={play:function(t,e){}},this.root=void 0,this.director=void 0,this.input=new Vi,gn.instance=this}var _n,mn=(t(bn,_n=ue),bn.prototype.start=function(t){!function(t,e,i){if(!(t instanceof e))throw new Error(Z(i))}(t,zn),this._isNew&&(t.frame=this._animation.getAt(0).frame),_n.prototype.start.call(this,t)},bn.prototype.update=function(t){var e=this._elapsed+=t,i=this._animation.getAt(this._currentFrameIdx);if(!(e<i.time+i.duration)){if(this._currentFrameIdx++,this._currentFrameIdx===this._animation.frameCount){if(!this._animation.loops)return void this.complete();this._currentFrameIdx=0,this._elapsed=0}this._target.frame=this._animation.getAt(this._currentFrameIdx).frame}},bn.prototype.reset=function(){_n.prototype.reset.call(this),this._elapsed=0,this._currentFrameIdx=0,this._target.setFrame(this._animation.getAt(0).frame)},bn);function bn(t){var e=_n.call(this)||this;return e._elapsed=0,e._currentFrameIdx=0,"string"==typeof t&&tt(t=vn.instance.animations.get(t)),e._animation=t,e}var wn,xn={animate:function(t){return new mn(t)}};t(Pn,wn=Ci);function Pn(){return null!==wn&&wn.apply(this,arguments)||this}var Tn,En=Me.addHelper(xn,Ci),zn=(t(An,Tn=ji),Object.defineProperty(An.prototype,"run",{get:function(){return this._helperScheduler||(this._helperScheduler=new En(this,vn.instance.scheduler))},enumerable:!0,configurable:!0}),Object.defineProperty(An.prototype,"frame",{get:function(){return this._frame},set:function(t){(this._frame=t)?this.size.set(t.size):this.size.set(0,0)},enumerable:!0,configurable:!0}),An.prototype.initialize=function(){var e=this;return Tn.prototype.initialize.call(this),this.subscribe(this.size,this.size.EVENT.changed,function(){var t=e.frame;t?e.size.set(t.size):e.size.set(0,0)}),this},An.prototype.setFrame=function(t){"string"==typeof t&&(t=vn.instance.spriteFrames.get(t)),this.frame=t},An.prototype.draw=function(t){if(this.visible){var e=this._frame;if(e){var i,r,n=this.worldTransform;t.setTransform(n.a,-n.b,-n.c,n.d,n.e,-n.f),t.globalAlpha=this.opacityGlobal;var o=e.textureCoord;t.drawImage(e.texture.source,o.x,o.y,o.width,o.height,e.offset.x,-e.offset.y,o.width,-o.height)}else e||b(r=r||"%s is null",i)}},An);function An(t){var e=Tn.call(this)||this;return e._frame=void 0,e.setFrame(t),e}function Sn(t,e,i){return t<e?e:i<t?i:t}var In=(Dn.fromRGB=function(t,e,i,r){void 0===r&&(r=255);var n=new Dn;return n.set(t,e,i,r),n},Object.defineProperty(Dn,"Black",{get:function(){return Dn.fromRGB(0,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(Dn,"White",{get:function(){return Dn.fromRGB(255,255,255)},enumerable:!0,configurable:!0}),Object.defineProperty(Dn.prototype,"r",{get:function(){return(4278190080&this._value)>>>24},set:function(t){t=Sn(t,0,255),this._value=16777215&this._value|t<<24>>>0,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Dn.prototype,"g",{get:function(){return(16711680&this._value)>>>16},set:function(t){t=Sn(t,0,255),this._value=4278255615&this._value|t<<16>>>0,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Dn.prototype,"b",{get:function(){return(65280&this._value)>>>8},set:function(t){t=Sn(t,0,255),this._value=4294902015&this._value|t<<8>>>0,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(Dn.prototype,"a",{get:function(){return(255&this._value)>>>0},set:function(t){t=Sn(t,0,255),this._value=4294967040&this._value|t,this._dirty=!0},enumerable:!0,configurable:!0}),Dn.prototype.clone=function(){var t=new Dn;return t._value=this._value,t._dirty=this._dirty,t._representation=this._representation,t},Dn.prototype.set=function(t,e,i,r){if(void 0===r&&(r=255),"number"==typeof t)this.r=t,this.g=e||0,this.b=i||0,this.a=null!=r?r:255;else if(t instanceof Dn)this._value=t._value,this._dirty=!0;else if("string"==typeof t){if(t.startsWith("#")&&(t=t.substring(1)),6===t.length||8===t.length)this.set(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16),8===t.length?parseInt(t.substring(6,8),16):255);else if(3===t.length||4===t.length){var n=void 0;this.set(16*(n=parseInt(t.substring(0,1),16))+n,16*(n=parseInt(t.substring(1,2),16))+n,16*(n=parseInt(t.substring(2,3),16))+n,4===t.length?16*(n=parseInt(t.substring(3,4),16))+n:255)}}else this.set(t.r,t.g,t.b,t.a);return this},Dn.prototype.getRepresentation=function(){return this._dirty&&(255===this.a?this._representation="rgb("+this.r+","+this.g+","+this.b+")":this._representation="rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")",this._dirty=!1),this._representation},Dn);function Dn(){this._representation="",this._dirty=!0,this._value=255}var On,Cn=(t(jn,On=ji),Object.defineProperty(jn.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(jn.prototype,"isCollidable",{get:function(){return this._isCollidable},enumerable:!0,configurable:!0}),Object.defineProperty(jn.prototype,"isDanger",{get:function(){return this._isDanger},enumerable:!0,configurable:!0}),jn.prototype.onLevelSetup=function(t){return this._id=t.id,this.position.set(t.x,this.parent.size.height-t.y),this.mapPosition.set(Math.floor(t.x/this.parent.tileSize),Math.floor((this.parent.size.height-t.y)/this.parent.tileSize)),this},jn.prototype.onLevelReady=function(){return this},jn.prototype.onLevelStart=function(){},jn.prototype.collideWith=function(t){},jn.prototype.addViewSprite=function(t,e){void 0===e&&(e="idle"),this._spriteName=t;var i=this._sprite=this.children.add((new zn).initialize(),0,"sprite");e&&(this._setState(e),this.size.set(i.size))},jn.prototype._setState=function(t,e){if(this._spriteName)return this._setView(this._spriteName+"-"+t,e)},jn.prototype._setView=function(t,e){var i=this._sprite;if(i){var r=vn.instance.spriteFrames.get(t);if(r)return i.run.stopAll(),void(i.frame=r);var n=vn.instance.animations.get(t);if(n){i.run.stopAll();var o=i.run.animate(n);if(e)return o.async()}}},jn);function jn(){var t=null!==On&&On.apply(this,arguments)||this;return t._sprite=void 0,t._spriteName=void 0,t._id=0,t._isCollidable=!1,t._isDanger=!1,t.type="dummy",t.mapPosition=new Nt,t}var kn,Nn=(t(Ln,kn=Cn),Object.defineProperty(Ln.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Ln.prototype.onLevelSetup=function(t){var e;return kn.prototype.onLevelSetup.call(this,t),this.addViewSprite("door"),null===(e=this._sprite)||void 0===e||e.position.delta((t.width-this._sprite.size.width)/2,0),this._direction=t.properties.get("direction","in"),this},Ln.prototype.onLevelStart=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return"in"!==this._direction?[3,4]:[4,this.open()];case 1:return t.sent(),[4,this.run.wait(.6).async()];case 2:return t.sent(),[4,this.close()];case 3:t.sent(),this._setState("idle"),t.label=4;case 4:return[2]}})})},Ln.prototype.collideWith=function(e){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return"hero"!==e.type||"out"!==this._direction?[3,4]:(this.parent.stopExecuting(),[4,this.run.wait(.2).async()]);case 1:return t.sent(),[4,this.open()];case 2:return t.sent(),[4,e.exit(this)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Ln.prototype.open=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("opening",!0)];case 1:return t.sent(),[2]}})})},Ln.prototype.close=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("closing",!0)];case 1:return t.sent(),[2]}})})},Ln);function Ln(){var t=null!==kn&&kn.apply(this,arguments)||this;return t._direction="in",t._isCollidable=!0,t.type="door",t}var Rn=(Object.defineProperty(Vn.prototype,"vertexes",{get:function(){return this._vertexes},enumerable:!0,configurable:!0}),Object.defineProperty(Vn.prototype,"segments",{get:function(){return this._segments},enumerable:!0,configurable:!0}),Object.defineProperty(Vn.prototype,"vertexCount",{get:function(){return this._vertexes.length},enumerable:!0,configurable:!0}),Vn.prototype.addVertex=function(){for(var e,t,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];try{for(var n=E(i),o=n.next();!o.done;o=n.next()){var s=o.value;this._vertexes.push(s),s.attach(this)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},Vn.prototype._addSegmentFromLastVertex=function(){var t=this._vertexes.length,e=this._vertexes[t-2],i=this._vertexes[t-1];if(e&&i){var r=new Fn(e,i);this._segments.push(r)}},Vn.prototype.getVertexAt=function(t){return this._vertexes[t]},Vn.prototype.getSegmentAt=function(t){return this._segments[t]},Vn.prototype.draw=function(t){var e,i;this.isSubPath||t.beginPath();try{for(var r=E(this._vertexes),n=r.next();!n.done;n=r.next())n.value.draw(t)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}this.closePath&&t.closePath()},Vn);function Vn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isSubPath=!0,this.closePath=!1,this._vertexes=new Array,this._segments=new Array,this.addVertex.apply(this,z(t))}var Mn,Fn=(t(Bn,Mn=function(t,e){this.start=t,this.end=e}),Object.defineProperty(Bn.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(Bn.prototype,"angle",{get:function(){return this._angle},enumerable:!0,configurable:!0}),Bn.prototype.getAt=function(t,e){void 0===e&&(e=_t());var i=this.start.position,r=this.end.position,n=r.x-i.x,o=r.y-i.y;return e.x=i.x+n*t,e.y=i.y+o*t,e},Bn.prototype.onChanged=function(){this._length=Nt.distance(this.start.position,this.end.position),this._angle=Nt.angle(this.start.position,this.end.position)},Bn);function Bn(t,e){var i=Mn.call(this,t,e)||this;return i._length=0,i._angle=0,i.onChanged(),i}var Hn=(Object.defineProperty($n.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty($n.prototype,"index",{get:function(){return this._path?this._path.vertexes.indexOf(this):-1},enumerable:!0,configurable:!0}),$n.prototype.attach=function(t){this._path=t},$n.prototype.detach=function(){this._path=void 0},$n);function $n(t){void 0===t&&(t=_t()),this._path=void 0,this.position=t}var Wn,Un=(t(Gn,Wn=Hn),Gn.prototype.draw=function(t){this._path&&(this._path.getVertexAt(0)===this?t.moveTo(this.position.x,-this.position.y):t.lineTo(this.position.x,-this.position.y))},Gn);function Gn(){return null!==Wn&&Wn.apply(this,arguments)||this}var qn,Yn=(t(Xn,qn=Hn),Xn.prototype.draw=function(t){if(this._path){var e=this.size;if(0!==e){var i=this._path.getVertexAt((this.index+this._path.vertexCount-1)%this._path.vertexCount),r=this._path.getVertexAt((this.index+1)%this._path.vertexCount),n=Math.atan2(this.position.y-i.position.y,this.position.x-i.position.x),o=Math.atan2(r.position.y-this.position.y,r.position.x-this.position.x);this._path.getVertexAt(0)===this?t.moveTo(this.position.x-e*Math.cos(n),-this.position.y+e*Math.sin(n)):t.lineTo(this.position.x-e*Math.cos(n),-this.position.y+e*Math.sin(n)),t.arcTo(this.position.x,-this.position.y,this.position.x+e*Math.cos(o),-this.position.y-e*Math.sin(o),e)}else this._path.getVertexAt(0)===this?t.moveTo(this.position.x,-this.position.y):t.lineTo(this.position.x,-this.position.y)}},Xn);function Xn(){var t=null!==qn&&qn.apply(this,arguments)||this;return t.size=0,t}var Kn;t(Zn,Kn=Hn),Zn.prototype.draw=function(t){t.arc(this.position.x,-this.position.y,this.radius,0,2*Math.PI)};function Zn(t,e){void 0===t&&(t=_t()),void 0===e&&(e=0);var i=Kn.call(this,t)||this;return i.radius=e,i}var Qn,Jn=(t(to,Qn=ji),to.prototype.draw=function(t){var e=this.style;if(e||this.alwaysDrawVector){var i=this.worldTransform;t.setTransform(i.a,-i.b,-i.c,i.d,i.e,-i.f),this._path.draw(t),e&&(e.apply(t),t.globalAlpha=this.opacityGlobal,e.hasFill()&&t.fill(),e.hasStroke()&&t.stroke())}},to);function to(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=Qn.call(this)||this;return i.style=void 0,i.alwaysDrawVector=!1,i.position.set(t,e),i._path=new Rn,i._path.isSubPath=!1,i}var eo,io=(t(ro,eo=Jn),ro.prototype.setCornerSize=function(t){var e,i;try{for(var r=E(this._path.vertexes),n=r.next();!n.done;n=r.next())n.value.size=t}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ro.prototype._resolveDirtyTransform=function(){if(eo.prototype._resolveDirtyTransform.call(this),this._path&&!(this._path.vertexCount<4)){var t=this._path,e=this.size,i=e.width,r=e.height,n=t.getVertexAt(1).position,o=t.getVertexAt(2).position,s=t.getVertexAt(3).position;n.x=i,o.x=i,o.y=r,s.y=r}},ro);function ro(t,e,i,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1);var o=eo.call(this,t,e)||this;return o._path.addVertex(new Yn,new Yn,new Yn,new Yn),o._path.closePath=!0,o.size.set(i,r),o.setCornerSize(n),o._dirty|=4,o}var no=(oo.prototype.clone=function(){return new oo(this.color.clone())},oo.prototype.getCanvasStyle=function(t){return this.color.getRepresentation()},oo);function oo(t){this.kind="solid",this.color=new In,t&&this.color.set(t)}var so=(ao.prototype.clone=function(){var t=new ao(this.spriteFrame,this.bgColor&&this.bgColor.clone(),this.transform&&w({},this.transform));return t.scale=this.scale,t.opacity=this.opacity,t._dirty=this._dirty,t._style=this._style,t},ao.prototype.getCanvasStyle=function(t){var e=!this._dirty&&this._style||(this._style=this.buildStyle(t));return this.transform&&e.setTransform(this.transform),e},ao.prototype.buildStyle=function(t){tt(this.spriteFrame);var e=this.scale||1,i=this._canvas||(this._canvas=document.createElement("canvas"));i.width=this.spriteFrame.size.width*e,i.height=this.spriteFrame.size.height*e;var r=i.getContext("2d");r.clearRect(0,0,i.width,i.height),this.bgColor&&(r.fillStyle=this.bgColor.getRepresentation(),r.fillRect(0,0,i.width,i.height));var n=new zn(this.spriteFrame);n.transform.scale.set(e,e),n.transform.position.set(0,-i.height),n.opacity=this.opacity,n.draw(r);var o=this._style=t.createPattern(i,"repeat");return this._dirty=!1,o},a([g(1)],ao.prototype,"bgColor",void 0),a([g(1)],ao.prototype,"spriteFrame",void 0),a([g(1)],ao.prototype,"opacity",void 0),a([g(1)],ao.prototype,"scale",void 0),ao);function ao(t,e,i){this.kind="pattern",this._dirty=!1,this._style=void 0,this._canvas=void 0,this.opacity=1,this.scale=1,this.spriteFrame=t,this.bgColor=e,this.transform=i}var ho=(co.None=function(){return new co},co.Stroke=function(t,e){var i=new co;return i.lineStyle=new no(t),i.lineSize=e,i},co.Fill=function(t){var e=new co;return e.fillStyle=new no(t),e},co.FillPattern=function(t,e,i){var r=new co;return r.fillStyle=new so(t,e,i),r},co.prototype.hasStroke=function(){return!!this.lineSize},co.prototype.hasFill=function(){return!!this.fillStyle},co.prototype.clone=function(){var t=new co;return t.lineSize=this.lineSize,t.lineStyle=this.lineStyle&&this.lineStyle.clone(),t.fillStyle=this.fillStyle&&this.fillStyle.clone(),t},co.prototype.apply=function(t){this.lineSize&&(t.lineWidth=this.lineSize,this.lineStyle&&(t.strokeStyle=this.lineStyle.getCanvasStyle(t))),this.fillStyle&&(t.fillStyle=this.fillStyle.getCanvasStyle(t))},co);function co(){this.lineSize=0,this.lineStyle=void 0,this.fillStyle=void 0}var uo=(lo.prototype.clone=function(){var n=new lo;return n.startPosition=_t(this.startPosition),n.endPosition=_t(this.endPosition),z(this.colors).forEach(function(t){var e=d(t,2),i=e[0],r=e[1];return n.colors.set(i,r.clone())}),n._dirty=this._dirty,n._style=this._style,n},lo.prototype.makeHorizontal=function(t,e){this.startPosition=_t(t,0),this.endPosition=_t(e,0)},lo.prototype.makeVertical=function(t,e){this.startPosition=_t(0,t),this.endPosition=_t(0,e)},lo.prototype.getCanvasStyle=function(t){return!this._dirty&&this._style||(this._style=this.buildStyle(t))},lo.prototype.buildStyle=function(t){var e,i,r=this._style=t.createLinearGradient(this.startPosition.x,-this.startPosition.y,this.endPosition.x,-this.endPosition.y);try{for(var n=E(this.colors),o=n.next();!o.done;o=n.next()){var s=d(o.value,2),a=s[0],h=s[1];r.addColorStop(a,h.getRepresentation())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return this._dirty=!1,r},a([g(1)],lo.prototype,"startPosition",void 0),a([g(1)],lo.prototype,"endPosition",void 0),lo);function lo(){this.kind="linearGradient",this._dirty=!1,this._style=void 0,this.colors=new Map,this.startPosition=_t(),this.endPosition=_t()}var po,fo=(t(yo,po=Jn),yo.prototype._resolveDirtyTransform=function(){if(po.prototype._resolveDirtyTransform.call(this),this._path&&!(this._path.vertexCount<4)){var t=this._path,e=this.size,i=e.width,r=e.height,n=t.getVertexAt(1).position,o=t.getVertexAt(2).position,s=t.getVertexAt(3).position;n.x=i,o.x=i,o.y=r,s.y=r}},yo);function yo(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0);var n=po.call(this,t,e)||this;return n._path.addVertex(new Un,new Un,new Un,new Un),n._path.closePath=!0,n.size.set(i,r),n._dirty|=4,n}var vo,go=(t(_o,vo=ji),_o.prototype.initialize=function(){this.visible=!1,this.opacity=0;var t=this.children.add(new io(0,0,48,8,4).initialize());t.style=ho.Fill(In.fromRGB(66,58,40)),t.style.lineSize=1.5,t.style.lineStyle=new no(In.fromRGB(0,0,0));var e=this.children.add(new io(0,0,t.size.width,t.size.height,4).initialize(),0,"fg");e.style=new ho;var i=e.style.fillStyle=new uo;i.colors.set(0,In.fromRGB(39,97,123)),i.colors.set(1,In.fromRGB(87,152,178)),i.makeVertical(0,t.size.height-2);var r=this.children.add(new fo(0,0,0,t.size.height).initialize(),0,"delta");return r.style=ho.Fill(In.fromRGB(204,227,237)),r.visible=!1,this.size.set(t.size),this},_o.prototype.delta=function(t){var e=this;if(this.value=Math.min(this.max,Math.max(0,this.value+t)),this.run.stopAll(),t<0){var i=this.children.getByName("fg");i.size.width=this.size.width*this.value/this.max;var r=this.children.getByName("delta");r.size.width+=-t/this.max*this.size.width,r.visible=!0,r.position.x=i.transform.right,r.run.stopAll(),r.run.sequence(function(t){return z([t.wait(.4),t.resizeTo(.3,mt(0,r.size.height)).withEasing(xe)],e.autoHide?[t.hide(),t.after(2,e.hide).withTarget(e)]:[])}),this.show()}},_o.prototype.show=function(){return this.visible=!0,this.run.stop("visibility"),this.run.fadeIn(.1).withName("visibility")},_o.prototype.hide=function(){return this.run.stop("visibility"),this.run.sequence(function(t){return[t.fadeOut(.2),t.hide()]}).withName("visibility")},_o);function _o(){var t=null!==vo&&vo.apply(this,arguments)||this;return t.max=10,t.value=10,t.autoHide=!1,t}var mo,bo=(t(wo,mo=Cn),Object.defineProperty(wo.prototype,"hp",{get:function(){return this._hp},enumerable:!0,configurable:!0}),Object.defineProperty(wo.prototype,"isDead",{get:function(){return this._isDead},enumerable:!0,configurable:!0}),wo.prototype.onLevelSetup=function(t){mo.prototype.onLevelSetup.call(this,t),this.addViewSprite("enemy");var e=this.children.add((new go).initialize(),0,"hpBar");return e.transform.scale.set(.33,.33),e.max=this._hp,e.value=this._hp,e.visible=!1,e.transform.anchor.set(.5,0),e.position.set(this.size.width/2,this.size.height),this._sprite.position.delta(-4,0),this},wo.prototype.executeTurn=function(){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return this._isDead?[2]:"block"===(e=this.parent.getAt(this.mapPosition.x-1,this.mapPosition.y,!0))?[2]:e instanceof Cn&&"hero"===e.type?[4,this.attack()]:[3,3];case 1:return t.sent(),[4,this.attack()];case 2:return t.sent(),[2];case 3:return e=this.parent.getAt(this.mapPosition.x-2,this.mapPosition.y,!0),i=this.parent.getAt(this.mapPosition.x-1,this.mapPosition.y-1,!0),e instanceof Cn&&"hero"===e.type&&("platform"===i||"block"===i)?[4,this.move(this.mapPosition.x-1,this.mapPosition.y)]:[3,6];case 4:return t.sent(),[4,this.attack()];case 5:t.sent(),t.label=6;case 6:return[2]}})})},wo.prototype.move=function(i,r){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:return this.mapPosition.x===i&&this.mapPosition.y===r?[2]:"block"===(e=this.parent.getAt(i,r,!0))||e instanceof Cn&&"hero"===e.type?[2]:(this._setState("run"),[4,this.run.moveTo(.8,_t(i*this.parent.tileSize,r*this.parent.tileSize)).withEasing(xe).async()]);case 1:return t.sent(),this.mapPosition.set(i,r),this._setState("idle"),[2]}})})},wo.prototype.attack=function(){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:return(e=this.parent.getAt(this.mapPosition.x-1,this.mapPosition.y,!0))instanceof Po?(this._setState("run"),[4,this.run.moveTo(.3,_t((this.mapPosition.x-.25)*this.parent.tileSize,this.mapPosition.y*this.parent.tileSize)).withEasing(be).async()]):[2];case 1:return t.sent(),e.run.after(.2,e.hit),[4,this._setState("attack",!0)];case 2:return t.sent(),this._setState("run"),[4,this.run.moveTo(.3,_t(this.mapPosition.x*this.parent.tileSize,this.mapPosition.y*this.parent.tileSize)).withEasing(we).async()];case 3:return t.sent(),this._setState("idle"),[2]}})})},wo.prototype.hit=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return this.children.getByName("hpBar").delta(-1),this._hp--,this._isDead=this._hp<=0,[4,this._setState("hit",!0)];case 1:return t.sent(),this._isDead?[4,this.die()]:[3,3];case 2:return t.sent(),[3,4];case 3:this._setState("idle"),t.label=4;case 4:return[2]}})})},wo.prototype.die=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("dead",!0)];case 1:return t.sent(),this.destroy(),[2]}})})},wo);function wo(){var t=null!==mo&&mo.apply(this,arguments)||this;return t._isCollidable=!0,t._isDanger=!0,t._hp=2,t._isDead=!1,t.type="enemy",t}var xo,Po=(t(To,xo=Cn),To.prototype.onLevelSetup=function(t){return xo.prototype.onLevelSetup.call(this,t),this.addViewSprite("king"),this._sprite.position.delta(-15,-14),this.visible=!1,this},To.prototype.onLevelStart=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this.run.wait(.4).async()];case 1:return t.sent(),this.visible=!0,[4,this.enter()];case 2:return t.sent(),this._setState("idle"),[2]}})})},To.prototype.enter=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("enter",!0)];case 1:return t.sent(),[2]}})})},To.prototype.exit=function(e){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("exit",!0)];case 1:return t.sent(),[4,e.close()];case 2:return t.sent(),this.parent.exit(e),[2]}})})},To.prototype.move=function(i,r){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:return this.mapPosition.x===i&&this.mapPosition.y===r?[2]:"block"!==(e=this.parent.getAt(i,r))?[3,1]:[2];case 1:return e instanceof Cn&&e.isDanger?[4,this._sideHit(i,r)]:[3,3];case 2:return[2,t.sent()];case 3:e instanceof Cn&&e.isCollidable&&this._collide(e,.25),t.label=4;case 4:return this._setState("run"),[4,this.run.moveTo(.8,_t(i*this.parent.tileSize,r*this.parent.tileSize)).withEasing(xe).async()];case 5:return t.sent(),[4,this._fall(i,r)];case 6:return t.sent(),[2]}})})},To.prototype.guard=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("guard",!0)];case 1:return t.sent(),[2]}})})},To.prototype.jumpUp=function(){return f(this,void 0,void 0,function(){var e,i,r,n,o;return T(this,function(t){switch(t.label){case 0:for(e=0,i=1;i<=2&&"block"!==(r=this.parent.getAt(this.mapPosition.x,this.mapPosition.y+i));i++){if(r instanceof Cn&&r.isCollidable){if(r.isDanger)return[2,this._jumpHit(e+1)];this._collide(r,.1*e)}e++}return 0===e?[2]:(this._setState("jump"),n=_t(this.mapPosition.x*this.parent.tileSize,(this.mapPosition.y+e)*this.parent.tileSize),o=.4*(1+Math.log(e-1)),[4,this.run.moveTo(o,n).withEasing(we).async()]);case 1:return t.sent(),[4,this._fall(this.mapPosition.x,this.mapPosition.y+e)];case 2:return t.sent(),[2]}})})},To.prototype.jumpForward=function(){return f(this,void 0,void 0,function(){var e,i,r,n;return T(this,function(t){switch(t.label){case 0:return e=this.mapPosition,i=e.x,r=e.y,"block"!==(n=this.parent.getAt(i,r+1))?[3,1]:[2];case 1:return n instanceof Cn&&n.isDanger?[4,this.jumpUp()]:[3,3];case 2:return[2,t.sent()];case 3:return(n=this.parent.getAt(i+1,r+2))instanceof Cn&&n.isDanger?[4,this._jumpSideHit(i+1,r+2)]:[3,5];case 4:return[2,t.sent()];case 5:return"block"!==n?[3,16]:"block"!==(n=this.parent.getAt(i+1,r+1))?[3,6]:[2];case 6:return n instanceof Cn&&n.isDanger?[4,this._jumpSideHit(i+1,r+1)]:[3,8];case 7:return[2,t.sent()];case 8:return"platform"!==(n=this.parent.getAt(i+1,r))&&"block"!==n?[3,10]:[4,this._jumpTo(i+1,r+1)];case 9:return[2,t.sent()];case 10:return n instanceof Cn&&n.isDanger?[4,this._jumpSideHit(i+1,r)]:[3,12];case 11:return[2,t.sent()];case 12:return(n=this.parent.getAt(i+2,r))&&"platform"!==n?[3,14]:[4,this._jumpTo(i+2,r)];case 13:return[2,t.sent()];case 14:return[4,this._jumpTo(i+1,r+1)];case 15:return[2,t.sent()];case 16:return(n=this.parent.getAt(i+1,r+1))instanceof Cn&&n.isDanger?[2,this._jumpSideHit(i+1,r+1)]:[3,17];case 17:return"block"!==n&&"platform"!==n?[3,19]:[4,this._jumpTo(i+1,r+2)];case 18:return[2,t.sent()];case 19:return"platform"!==(n=this.parent.getAt(i+1,r))&&"block"!==n?[3,21]:[4,this._jumpTo(i+1,r+1)];case 20:return[2,t.sent()];case 21:return(n=this.parent.getAt(i+2,r+1))instanceof Cn&&n.isDanger?[4,this._jumpSideHit(i+2,r+1)]:[3,23];case 22:return[2,t.sent()];case 23:return"block"!==(n=this.parent.getAt(i+2,r))&&"platform"!==n?[3,25]:[4,this._jumpTo(i+2,r+1)];case 24:return[2,t.sent()];case 25:return n instanceof Cn&&n.isDanger?[4,this._jumpSideHit(i+2,r,1)]:[3,27];case 26:return[2,t.sent()];case 27:return"platform"!==(n=this.parent.getAt(i+1,r))&&"block"!==n?[3,29]:[4,this._jumpTo(i+1,r+1)];case 28:return t.sent(),[3,31];case 29:return[4,this._jumpTo(i+2,r,1)];case 30:t.sent(),t.label=31;case 31:return[2]}})})},To.prototype.attack=function(){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:return(e=this.parent.getAt(this.mapPosition.x+1,this.mapPosition.y))instanceof bo&&e.run.after(.1,e.hit),[4,this._setState("attack",!0)];case 1:return t.sent(),this._setState("idle"),[2]}})})},To.prototype.hit=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this._setState("hit",!0)];case 1:return t.sent(),this._setState("idle"),[2]}})})},To.prototype.die=function(){return f(this,void 0,void 0,function(){return T(this,function(t){return[2]})})},To.prototype._fall=function(h,c){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a=this;return T(this,function(t){switch(t.label){case 0:for(i=void(e=0);e++,(r=this.parent.getAt(h,c-e))instanceof Cn&&r.isCollidable&&!r.isDanger&&((i=i||[]).push(r),r=void 0),!r&&0<=c-e;);return--e<1?(this.mapPosition.set(h,c),this.position.y===c*this.parent.tileSize?[3,2]:[4,this.run.moveTo(.1,_t(h*this.parent.tileSize,c*this.parent.tileSize)).withEasing(be).async()]):[3,3];case 1:t.sent(),t.label=2;case 2:return this._setState("idle"),[2];case 3:return this._setState("jump"),n=_t(h*this.parent.tileSize,(c-e)*this.parent.tileSize),o=.3*(1+Math.log(e)),i&&i.forEach(function(t,e){return a._collide(t,.1*(e+1))}),r instanceof Cn?(n.y-=this.parent.tileSize,[4,this.run.moveTo(o,n).withEasing(be).async()]):[3,10];case 4:return t.sent(),[4,this._setState("hit",!0)];case 5:return t.sent(),"block"===(s=this.parent.getAt(h-1,c-e-1))||s instanceof Cn&&s.isCollidable?[4,this.die()]:[3,7];case 6:return t.sent(),[2];case 7:return[4,this.run.moveTo(.2,_t((h-1)*this.parent.tileSize,this.position.y)).withEasing(we).async()];case 8:return t.sent(),[4,this._fall(h-1,c-e-1)];case 9:return[2,t.sent()];case 10:return[4,this.run.moveTo(o,n).withEasing(be).async()];case 11:t.sent(),this.mapPosition.set(h,c-e),t.label=12;case 12:return this._setState("idle"),[2]}})})},To.prototype._sideHit=function(r,n){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return e=Math.sign(this.mapPosition.x-r),i=r+.5*e,this._setState("run"),[4,this.run.moveTo(.4,_t(i*this.parent.tileSize,n*this.parent.tileSize)).withEasing(be).async()];case 1:return t.sent(),[4,this._setState("hit",!0)];case 2:return t.sent(),[4,this.run.moveTo(.2,_t((r+e)*this.parent.tileSize,n*this.parent.tileSize)).withEasing(we).async()];case 3:return t.sent(),this.mapPosition.set(r+e,n),this._setState("idle"),[2]}})})},To.prototype._jumpTo=function(r,n,o){return void 0===o&&(o=0),f(this,void 0,void 0,function(){var e,i=this;return T(this,function(t){switch(t.label){case 0:return e=this.parent.tileSize,this._setState("jump"),this._jumpCollide(r,n,o),[4,this.run.sequence(function(t){return[t.moveTo(.4+.1*o,_t((r+i.mapPosition.x)/2*e,(n+o+.15)*e)).withEasing(we),t.moveTo(.15+.05*(r-i.mapPosition.x-1)+.05*o,_t(r*e,n*e)).withEasing(be)]}).async()];case 1:return t.sent(),[4,this._fall(r,n)];case 2:return t.sent(),[2]}})})},To.prototype._jumpHit=function(s){return f(this,void 0,void 0,function(){var e,i,r,n,o;return T(this,function(t){switch(t.label){case 0:return e=this.mapPosition,i=e.x,r=e.y,r+=s-1,this._setState("jump"),n=_t(i*this.parent.tileSize,(r+.25)*this.parent.tileSize),o=.2*(1+Math.log(s)),[4,this.run.moveTo(o,n).withEasing(we).async()];case 1:return t.sent(),[4,this._setState("hit",!0)];case 2:return t.sent(),[4,this._fall(i,r)];case 3:return t.sent(),[2]}})})},To.prototype._jumpSideHit=function(n,o,s){return void 0===s&&(s=0),f(this,void 0,void 0,function(){var e,i,r=this;return T(this,function(t){switch(t.label){case 0:return e=this.parent.tileSize,i=n*e-e/2,this._setState("jump"),this._jumpCollide(n,o,s),[4,this.run.sequence(function(t){return[t.moveTo(.4+.1*s,_t((n+r.mapPosition.x)/2*e,(o+s+.15)*e)).withEasing(we),t.moveTo(.05+.05*(n-r.mapPosition.x-1)+.05*s,_t(i,o*e)).withEasing(be)]}).async()];case 1:return t.sent(),[4,this._setState("hit",!0)];case 2:return t.sent(),[4,this.run.moveTo(.2,_t((n-1)*e,o*e)).withEasing(we).async()];case 3:return t.sent(),[4,this._fall(n-1,o)];case 4:return t.sent(),[2]}})})},To.prototype._jumpCollide=function(t,e,i){var r=this.parent,n=this.mapPosition,o=n.x,s=n.y;t===o+1?(this._checkAndCollide(r.getAt(o,s+1),.15),e===s+1?this._checkAndCollide(r.getAt(o+1,s+1),.25):(this._checkAndCollide(r.getAt(o,s+2),.25),this._checkAndCollide(r.getAt(o+1,s+2),.35))):0===i&&s===e?(this._checkAndCollide(r.getAt(o+1,s),.15),this._checkAndCollide(r.getAt(o+2,s),.25)):(this._checkAndCollide(r.getAt(o,s+1),.15),this._checkAndCollide(r.getAt(o+1,s+1),.15),1===i&&this._checkAndCollide(r.getAt(o+1,s+2),.25),this._checkAndCollide(r.getAt(o+2,s+1),.35),e===s&&this._checkAndCollide(r.getAt(o+2,s),.4))},To.prototype._checkAndCollide=function(t,e){t instanceof Cn&&t.isCollidable&&!t.isDanger&&this._collide(t,e||.15)},To.prototype._collide=function(t,e){t.run.after(e,t.collideWith,this)},To);function To(){var t=null!==xo&&xo.apply(this,arguments)||this;return t.type="hero",t}var Eo,zo=(t(Ao,Eo=Cn),Ao.prototype.onLevelSetup=function(t){var e;return Eo.prototype.onLevelSetup.call(this,t),this.addViewSprite(t.properties.get("item","diamond")),null===(e=this._sprite)||void 0===e||e.position.delta((this.parent.tileSize-this._sprite.size.width)/2,0),this},Ao.prototype.collideWith=function(t){"hero"===t.type&&this.collect()},Ao.prototype.collect=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return this._isCollidable=!1,[4,this._setState("collect",!0)];case 1:return t.sent(),this.destroy(),[2]}})})},Ao);function Ao(){var t=null!==Eo&&Eo.apply(this,arguments)||this;return t._isCollidable=!0,t._isDanger=!1,t.type="pickup",t}var So,Io=(t(Do,So=ji),Object.defineProperty(Do.prototype,"hero",{get:function(){return this._hero},enumerable:!0,configurable:!0}),Object.defineProperty(Do.prototype,"tileSize",{get:function(){return this._map.tilewidth},enumerable:!0,configurable:!0}),Object.defineProperty(Do.prototype,"isExit",{get:function(){return this._isStopped},enumerable:!0,configurable:!0}),Do.prototype.getAt=function(t,e,i){var r,n;void 0===i&&(i=!1);try{for(var o=E(this.children.ofType(Cn)),s=o.next();!s.done;s=o.next()){var a=s.value;if(a.mapPosition.x===t&&a.mapPosition.y===e&&(i||!(a instanceof Po)))return a}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return this.getTerrainAt(t,e)},Do.prototype.getTerrainAt=function(t,e){var i,r;try{for(var n=E(this._map.layers.getAllByType("tilelayer")),o=n.next();!o.done;o=n.next()){var s=o.value.getTileIdAt(t,e),a=this._map.getTile(s);if(a&&"terrain"===a.type)return a.properties.get("type")}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},Do.prototype.load=function(P){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c,u,l,p,d,f,y,v,g,_,m,b,w,x;return T(this,function(t){switch(t.label){case 0:return i=this,[4,vn.instance.loader.load(P,"tiledMap")];case 1:return e=i._map=t.sent(),[4,this.loadMapResources(P,e)];case 2:r=t.sent(),this.size.set(e.width*e.tilewidth,e.height*e.tileheight),e.backgroundColor&&this.bgColor.set(e.backgroundColor),n=this.children.add((new ji).initialize());try{for(o=E(e.layers.getAllByType("tilelayer")),s=o.next();!s.done;s=o.next())for(a=s.value,h=0;h<e.width;h++)for(c=0;c<e.height;c++)(u=a.getTileIdAt(h,c))<=0||(l=e.tilesets.getByGlobalTileId(u))&&(p=l.getTileRect(u,!0),d=new wt(r.get(l.name),p),n.children.add(new zn(d).initialize()).position.set(e.tilewidth*h,e.tileheight*c))}catch(t){m={error:t}}finally{try{s&&!s.done&&(b=o.return)&&b.call(o)}finally{if(m)throw m.error}}f=e.layers.get("objects","objectgroup");try{for(y=E(f.getAll()),v=y.next();!v.done;v=y.next())switch((g=v.value)instanceof en&&this._preDefaultSetting(g),g.type){case"door":this.children.add((new Nn).initialize()).onLevelSetup(g);break;case"enemy":this.children.add((new bo).initialize()).onLevelSetup(g);break;case"item":this.children.add((new zo).initialize()).onLevelSetup(g)}}catch(t){w={error:t}}finally{try{v&&!v.done&&(x=y.return)&&x.call(y)}finally{if(w)throw w.error}}return tt(_=z(this.children.ofType(Nn)).find(function(t){return"in"===t.direction})),this._hero=this.children.add((new Po).initialize()).onLevelSetup(e.getObject(_.id)),this._centerCamera(),z(this.children.ofType(Cn)).forEach(function(t){t.onLevelReady()}),[2]}})})},Do.prototype.start=function(){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,Promise.all(z(this.children.ofType(Cn)).map(function(t){return t.onLevelStart()}))];case 1:return t.sent(),this.run.loop(this._centerCamera),[2]}})})},Do.prototype.exit=function(e){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return[4,this.run.wait(.4).async()];case 1:return t.sent(),this.trigger(this.EVENT.heroExit,e.direction),[2]}})})},Do.prototype.execute=function(i,r){return f(this,void 0,void 0,function(){var e;return T(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:return e<i.length?(r(e),[4,this._execute(i[e])]):[3,4];case 2:if(t.sent(),this._isStopped)return[3,4];t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},Do.prototype.stopExecuting=function(){this._isStopped=!0},Do.prototype.executeEnemy=function(){return f(this,void 0,void 0,function(){var e,i,r,n,o,s;return T(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=E(this.children.ofType(bo)),i=e.next(),t.label=1;case 1:return i.done?[3,4]:(r=i.value).isDead?[3,3]:[4,r.executeTurn()];case 2:t.sent(),t.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return n=t.sent(),o={error:n},[3,7];case 6:try{i&&!i.done&&(s=e.return)&&s.call(e)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},Do.prototype._execute=function(r){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:switch(e=this._hero,i=e.mapPosition,r){case"dir_forward":return[3,1];case"dir_back":return[3,3];case"dir_up":return[3,5];case"dir_upForward":return[3,7];case"action_defence":return[3,9];case"action_attack":return[3,11]}return[3,13];case 1:return[4,e.move(i.x+1,i.y)];case 2:return t.sent(),[3,13];case 3:return[4,e.move(i.x-1,i.y)];case 4:return t.sent(),[3,13];case 5:return[4,e.jumpUp()];case 6:return t.sent(),[3,13];case 7:return[4,e.jumpForward()];case 8:return t.sent(),[3,13];case 9:return[4,e.guard()];case 10:return t.sent(),[3,13];case 11:return[4,e.attack()];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Do.prototype._centerCamera=function(){if(this._hero&&this._map){var t=this.parent;this.position.x=-this._hero.position.x*this.transform.scale.x+t.size.width/2-4.5*this.tileSize}},Do.prototype.loadMapResources=function(u,l){return f(this,void 0,void 0,function(){var e,i,r,n,o,s,a,h,c;return T(this,function(t){switch(t.label){case 0:e=new Map,t.label=1;case 1:t.trys.push([1,6,7,8]),i=E(l.tilesets),r=i.next(),t.label=2;case 2:return r.done?[3,5]:(n=r.value).image?(o=u,n.source&&(o=dt.changeFile(o,n.source)),o=dt.changeFile(o,n.image),[4,vn.instance.loader.load(o)]):[3,4];case 3:s=t.sent(),e.set(n.name,s),t.label=4;case 4:return r=i.next(),[3,2];case 5:return[3,8];case 6:return a=t.sent(),h={error:a},[3,8];case 7:try{r&&!r.done&&(c=i.return)&&c.call(i)}finally{if(h)throw h.error}return[7];case 8:return[2,e]}})})},Do.prototype._preDefaultSetting=function(t){var e,i,r=this._map.tilesets.getByGlobalTileId(t.globalTileId);if(r&&"Objects"===r.name){var n=t.globalTileId-r.firstGlobalId,o=jo[n];if(o){t.type=o.type;try{for(var s=E(t.properties.entries),a=s.next();!a.done;a=s.next()){var h=d(a.value,2),c=h[0],u=h[1];t.properties.has(c)||t.properties.set(c,u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}}}},Do.EVENTS=h(Do,{heroExit:""}),Do);function Do(){var t=null!==So&&So.apply(this,arguments)||this;return t._hero=void 0,t._map=void 0,t._isStopped=!1,t.bgColor=In.Black,t}var Oo,Co,jo={20:{type:"item",item:"diamond"}};(Co=Oo=Oo||{})[Co.Default=0]="Default",Co[Co.Error=1]="Error",Co[Co.Focused=2]="Focused",Co[Co.Selected=3]="Selected",Co[Co.Active=4]="Active",Co[Co.Hover=5]="Hover",Co[Co.Pressed=6]="Pressed",Co[Co.Dragging=7]="Dragging",Co[Co.Disabled=8]="Disabled";var ko,No=(t(Lo,ko=ji),Object.defineProperty(Lo.prototype,"menu",{get:function(){return tt(this._menu),this._menu},enumerable:!0,configurable:!0}),Lo.prototype.setMenu=function(t){rt(this._menu,t),this._menu=t},Object.defineProperty(Lo.prototype,"isEnabled",{get:function(){return!this.is(8)},set:function(t){this.set(8,!t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isFocused",{get:function(){return this.is(2)},set:function(t){this.set(2,t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isPressed",{get:function(){return this.is(6)},set:function(t){this.set(6,t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isSelected",{get:function(){return this.is(3)},set:function(t){this.set(3,t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isActive",{get:function(){return this.is(4)},set:function(t){this.set(4,t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isHover",{get:function(){return this.is(5)},set:function(t){this.set(5,t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lo.prototype,"isDragging",{get:function(){return this.is(7)},set:function(t){this.set(7,t)},enumerable:!0,configurable:!0}),Lo.prototype.is=function(t){return this.state[t]||!1},Lo.prototype.set=function(t,e,i){switch(t){case 8:return this._setDisabled(e,i);case 1:return this._setError(e,i);case 2:return this._setFocused(e,i);case 6:return this._setPressed(e,i);case 3:return this._setSelected(e,i);case 4:return this._setActive(e,i);case 5:return this._setHover(e,i);case 7:return this._setDragging(e,i)}return!1},Lo.prototype._setDisabled=function(t,e){return this.is(8)!==t&&(this.state[8]=t,this.trigger(this.EVENT.enabledChanged,e),!0)},Lo.prototype._setError=function(t,e){return this.is(1)!==t&&(this.state[1]=t,!0)},Lo.prototype._setFocused=function(t,e){return!(t&&!this.canReceiveFocus||this.is(2)===t||(this.state[2]=t,this.trigger(this.EVENT.focusedChanged,e),0))},Lo.prototype._setPressed=function(t,e){return this.is(6)!==t&&(this.state[6]=t,this.trigger(this.EVENT.pressedChanged,e),!0)},Lo.prototype._setSelected=function(t,e){return this.is(3)!==t&&(this.state[3]=t,this.trigger(this.EVENT.selectedChanged,e),!0)},Lo.prototype._setActive=function(t,e){return this.is(4)!==t&&(this.state[4]=t,this.trigger(this.EVENT.activeChanged,e),!0)},Lo.prototype._setHover=function(t,e){return this.is(5)!==t&&(this.state[5]=t,this.trigger(this.EVENT.hover,e),!0)},Lo.prototype._setDragging=function(t,e){return this.is(7)!==t&&(this.state[7]=t,this.trigger(this.EVENT.dragStarted,e),!0)},Lo.prototype.canDrag=function(){return!1},Lo.prototype.canActivate=function(t){return(this.isEnabled||t)&&this.isScreenVisible},Lo.prototype.activate=function(){var t=this.isEnabled;return t&&this.trigger(this.EVENT.click),t},Lo.prototype.destroy=function(){ko.prototype.destroy.call(this),this._menu&&this._menu.items.remove(this)},Lo.EVENT=h(Lo,{click:"",enabledChanged:"",focusedChanged:"",pressedChanged:"",selectedChanged:"",activeChanged:"",hover:"",dragStarted:""}),Lo);function Lo(){var t,e=null!==ko&&ko.apply(this,arguments)||this;return e.state=((t={})[8]=!1,t[2]=!1,t[6]=!1,t[3]=!1,t[4]=!1,t[5]=!1,t[7]=!1,t),e._menu=void 0,e.pauseEvents=!1,e.canReceiveFocus=!0,e}var Ro,Vo=(t(Mo,Ro=No),Mo.prototype.initialize=function(){return Ro.prototype.initialize.call(this),this.children.add((new zn).initialize(),0,"$$sprite$$"),this},Mo.prototype.setFrame=function(t,e){return this._frames.set(t,e),0===t&&this._setFrame(e),this},Mo.prototype.set=function(t,e,i){var r=Ro.prototype.set.call(this,t,e,i);if(r){var n=this._getFrame();n&&this._setFrame(n)}return r},Mo.prototype._getFrame=function(){var e,t,i=this._frames;try{for(var r=E([8,7,6,5,4,3,2]),n=r.next();!n.done;n=r.next()){var o=n.value,s=this.is(o)&&i.get(o);if(s)return s}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return i.get(0)},Mo.prototype._setFrame=function(t){var e=this.children.getByName("$$sprite$$");e&&(e.setFrame(t),this.size.set(e.size))},Mo);function Mo(){var t=null!==Ro&&Ro.apply(this,arguments)||this;return t._frames=new Map,t}var Fo,Bo=(t(Ho,Fo=ji),Object.defineProperty(Ho.prototype,"slots",{get:function(){return this._slots},set:function(t){this._slots=t,this._actions=new Array(t),this._arrange()},enumerable:!0,configurable:!0}),Object.defineProperty(Ho.prototype,"actions",{get:function(){return this._actions},enumerable:!0,configurable:!0}),Object.defineProperty(Ho.prototype,"isCompleted",{get:function(){return this._currentActionIdx===this._slots},enumerable:!0,configurable:!0}),Ho.prototype.initialize=function(){return Fo.prototype.initialize.call(this),this.children.add(new zn("action_indicator").initialize(),0,"action_indicator").visible=!1,this.children.add((new Vo).initialize(),0,"actionBar_cancel").setFrame(0,"b_cancel").setFrame(8,"b_cancel_disabled").setFrame(6,"b_cancel_pressed").isEnabled=!1,this.children.add((new Vo).initialize(),0,"actionBar_confirm").setFrame(0,"b_confirm").setFrame(8,"b_confirm_disabled").setFrame(6,"b_confirm_pressed").isEnabled=!1,this._arrange(),this},Ho.prototype.addAction=function(t){this._actions[this._currentActionIdx]=t,this._addActionToSlot(this._currentActionIdx,t),this._currentActionIdx++,this.children.getByName("actionBar_cancel").isEnabled=0<this._currentActionIdx,this.children.getByName("actionBar_confirm").isEnabled=this._currentActionIdx===this._slots},Ho.prototype.clear=function(){var t,e;this.children.getByName("actionBar_cancel").isEnabled=!1,this.children.getByName("actionBar_confirm").isEnabled=!1;for(var i=0;i<this._slots;i++)null===(t=this.children.getByName("action_"+i+"_bg"))||void 0===t||t.destroy(),null===(e=this.children.getByName("action_"+i+"_icon"))||void 0===e||e.destroy();this._currentActionIdx=0},Ho.prototype.startExecuting=function(){this.children.getByName("actionBar_cancel").isEnabled=!1,this.children.getByName("actionBar_confirm").isEnabled=!1},Ho.prototype.stopExecuting=function(){var t=this.children.getByName("action_indicator");t.run.stopAll(),t.run.sequence(function(t){return[t.fadeOut(.1),t.hide()]}),this.clear()},Ho.prototype.activateAction=function(n){return f(this,void 0,void 0,function(){var e,i,r;return T(this,function(t){switch(t.label){case 0:return(e=this.children.getByName("action_indicator")).transform.anchor.set(.5,1),e.visible=!0,e.run.stopAll(),e.opacity=1,i=this.children.getByName("slot_"+n),r=_t(i.transform.outerCenterX,i.transform.bottom-8),0!==n?[3,1]:(e.position.set(r),[3,3]);case 1:return[4,e.run.moveTo(.4,r).withEasing(xe).async()];case 2:t.sent(),t.label=3;case 3:return e.run.sequence(function(t){return[t.fadeOut(.6),t.fadeIn(.3)]}).repeatForever(),[2]}})})},Ho.prototype._addActionToSlot=function(t,e){var i=this.children.getByName("slot_"+this._currentActionIdx),r=this.children.add((new io).initialize(),0,"action_"+t+"_bg");r.setCornerSize(6),r.style=ho.Fill(In.White),r.opacity=.35,r.size.set(i.size).delta(-12,-12),r.transform.outerCenterX=i.transform.outerCenterX,r.transform.outerCenterY=i.transform.outerCenterY;var n=this.children.add(this._getActionIcon(e),0,"action_"+t+"_icon"),o=(r.size.height-12)/n.size.height;n.transform.scale.set(o,o),n.transform.outerCenterX=i.transform.outerCenterX,n.transform.outerCenterY=i.transform.outerCenterY},Ho.prototype._getActionIcon=function(t){var e=t;t.startsWith("dir_")&&(e="action_forward");var i=new zn(e).initialize();return i.transform.anchor.set(.5,.5),i.transform.rotation="dir_back"===t?180:"dir_up"===t?-90:"dir_upForward"===t?-45:0,i},Ho.prototype._arrange=function(){var t,e=this.children.getByName("actionBar_cancel"),i=this.children.getByName("actionBar_confirm");e.position.set(0,0);for(var r=e.transform.right+24,n=0,o=this._slots-1;n<=o;n++){null===(t=this.children.getByName("slot_"+n))||void 0===t||t.destroy();var s=this.children.add((new zn).initialize(),0,"slot_"+n);s.setFrame(0===n?"actionbar_left":n===o?"actionbar_right":"actionbar_body"),s.transform.outerCenterY=e.transform.outerCenterY,s.transform.left=r,r+=s.size.width,0!==n&&n!==o-1||(r-=2)}r+=24,i.position.set(r,0),this.size.set(i.transform.right,i.size.height)},Ho);function Ho(){var t=null!==Fo&&Fo.apply(this,arguments)||this;return t._slots=3,t._actions=new Array(t._slots),t._currentActionIdx=0,t}var $o,Wo=(t(Uo,$o=No),Object.defineProperty(Uo.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t,this.children.getByName("icon").setFrame("action_"+t)},enumerable:!0,configurable:!0}),Uo.prototype.initialize=function(){$o.prototype.initialize.call(this);var t=this.children.add(new zn("card").initialize(),0,"bg");this.size.set(t.size),this.children.add(new zn("card_disabled").initialize(),0,"bg_back").visible=!1;var e=this.children.add((new zn).initialize(),0,"icon");return e.transform.anchor.set(.5,.5),e.position.set(this.size.width/2,this.size.height/2),this.transform.anchor.set(.5,.5),this.action="attack",this},Uo.prototype.flip=function(){var e=this.children.getByName("bg"),i=this.children.getByName("bg_back"),r=this.children.getByName("icon");this.run.sequence(function(t){return[t.scaleTo(.3,_t(0,1)).withEasing(xe),t.hide().withTarget(r),t.hide().withTarget(e),t.show().withTarget(i),t.scaleTo(.3,_t(1,1)).withEasing(xe)]}),this.isEnabled=!1},Uo.prototype.unflip=function(){var e=this.children.getByName("bg"),i=this.children.getByName("bg_back"),r=this.children.getByName("icon");this.run.sequence(function(t){return[t.scaleTo(.3,_t(0,1)).withEasing(xe),t.hide().withTarget(i),t.show().withTarget(e),t.show().withTarget(r),t.scaleTo(.3,_t(1,1)).withEasing(xe)]}),this.isEnabled=!0},Uo.prototype._setPressed=function(t,e){var i=$o.prototype._setPressed.call(this,t,e);return i&&(this.run.stop("scale"),this.run.scaleTo(.4,t?_t(.92,.92):_t(1,1)).withEasing(we).withName("scale")),i},Uo);function Uo(){var t=null!==$o&&$o.apply(this,arguments)||this;return t._action="attack",t}var Go,qo=(t(Yo,Go=ji),Yo.prototype.initialize=function(){Go.prototype.initialize.call(this);var t=this.children.add(new zn("action_directions_bg").initialize());this.size.set(t.size);var e=this.children.add((new Ko).initialize(),0,"dir_forward");e.transform.anchor.set(.5,.5),e.transform.right=this.size.width-8,e.transform.outerCenterY=this.size.height/2;var i=this.children.add((new Ko).initialize(),0,"dir_back");i.transform.anchor.set(.5,.5),i.transform.rotation=180,i.transform.left=8,i.transform.outerCenterY=this.size.height/2;var r=this.children.add((new Ko).initialize(),0,"dir_up");r.transform.anchor.set(.5,.5),r.transform.rotation=-90,r.transform.outerCenterX=this.size.width/2,r.transform.top=this.size.height-8;var n=this.children.add((new Ko).initialize(),0,"dir_upForward");return n.transform.anchor.set(.5,.5),n.transform.rotation=-45,n.transform.outerCenterX=this.size.width/2+(this.size.width/2-n.size.width/2)*Math.cos(Math.PI/4),n.transform.outerCenterY=this.size.height/2+(this.size.height/2-n.size.height/2)*Math.sin(Math.PI/4),this},Yo.prototype.enable=function(){var e,t;try{for(var i=E(this.children.ofType(Ko)),r=i.next();!r.done;r=i.next())r.value.isEnabled=!0}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},Yo.prototype.disable=function(){var e,t;try{for(var i=E(this.children.ofType(Ko)),r=i.next();!r.done;r=i.next())r.value.isEnabled=!1}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},Yo);function Yo(){return null!==Go&&Go.apply(this,arguments)||this}var Xo,Ko=(t(Zo,Xo=No),Zo.prototype.initialize=function(){Xo.prototype.initialize.call(this),this.size.set(60,60);var t=this.children.add((new fo).initialize(),0,"bg");t.visible=!1,t.style=ho.Fill(In.White),t.opacity=.2,t.size.set(this.size);var e=this.children.add(new zn("action_forward").initialize(),0,"icon");return e.transform.anchor.set(.5,.5),e.position.set(2+this.size.width/2,this.size.height/2),this},Zo.prototype._setDisabled=function(t,e){var i=Xo.prototype._setDisabled.call(this,t,e);return i&&this.children.getByName("icon").setFrame(t?"action_forward_disabled":"action_forward"),i},Zo.prototype._setPressed=function(t,e){var i=Xo.prototype._setPressed.call(this,t,e);return i&&(this.children.getByName("bg").visible=t),i},Zo);function Zo(){return null!==Xo&&Xo.apply(this,arguments)||this}var Qo=(Jo.prototype.useCapture=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),this.captureInside=t,this.captureOutside=e,this},Jo.prototype.useTarget=function(t){return this._target=t,this},Jo.prototype.useEnterLeaveForTouch=function(t){return void 0===t&&(t=!0),this._touchTriggersEnterLeave=t,this},Jo.prototype.useDrag=function(t,e){return this._isDragEnabled=t,this._dragMinOffset=e||0,this},Jo.prototype.useDouble=function(t){return void 0===t&&(t=.3),this._chainTimeout=1e3*t,this},Object.defineProperty(Jo.prototype,"isRegistered",{get:function(){return this._isRegistered},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"isDragEnabled",{get:function(){return this._isDragEnabled},enumerable:!0,configurable:!0}),Jo.prototype.register=function(){this.owner.parent?(vn.instance.input.addTarget(this.owner),this._isRegistered=!0):console.warn("no parent")},Jo.prototype.unregister=function(){vn.instance.input.removeTarget(this.owner),this._isRegistered=!1},Jo.prototype.handle=function(t){if(t instanceof xr)switch(t.eventType){case 0:this.onPointerDown(t);break;case 1:this.onPointerMove(t);break;case 2:this.onPointerUp(t);break;case 3:this.onPointerCancel(t);break;case 4:this.onPointerEnter(t);break;case 5:this.onPointerLeave(t);break;case 6:this.onWheel(t)}},Jo.prototype.onPointerDown=function(t){var e=this.owner.parent;if(e){var i=this._target||e,r=this._getPointerState(t.pointerId),n=0<this._chainTimeout&&Date.now()-r.startDownTime<=this._chainTimeout;r.down(t.button,t.position,e.worldTransform,n),i.onPointerDown&&i.onPointerDown.call(i,r),this._isInsideHost(r.position)?i.onPointerDownInside?i.onPointerDownInside.call(i,r):this.onPointerDownInside(r):i.onPointerDownOutside?i.onPointerDownOutside.call(i,r):this.onPointerDownOutside(r),r.isCaptured&&t.stop()}},Jo.prototype.onPointerMove=function(t){var e=this.owner.parent;if(e){var i=this._getPointerState(t.pointerId);i.move(t.position,e.worldTransform);var r=this._target||e,n=this._isInsideHost(i.position);i.isInside!==n&&("touch"===t.pointerType&&!this._touchTriggersEnterLeave||(n?(i.enter(t.position,e.worldTransform),r.onPointerEnter&&r.onPointerEnter.call(r,i)):(i.leave(t.position,e.worldTransform),r.onPointerLeave&&r.onPointerLeave.call(r,i)))),i.isDown&&r.onPointerMove?r.onPointerMove.call(r,i):!i.isDown&&r.onPointerHover&&r.onPointerHover.call(r,i),i.isCaptured&&t.stop()}},Jo.prototype.onPointerUp=function(t){var e=this.owner.parent;if(e){var i=this._getPointerState(t.pointerId);if(i.isDown){var r=0<this._chainTimeout&&Date.now()-i.startDownTime<=this._chainTimeout;i.up(t.position,e.worldTransform,r);var n=this._target||e;n.onPointerUp&&n.onPointerUp.call(n,i),i.isCaptured&&t.stop()}}},Jo.prototype.onPointerCancel=function(t){var e=this.owner.parent;if(e){var i=this._getPointerState(t.pointerId);i.cancel();var r=this._target||e;r.onPointerCancel&&r.onPointerCancel.call(r,i),i.isCaptured&&t.stop()}},Jo.prototype.onPointerEnter=function(t){var e=this.owner.parent;if(e&&("touch"!==t.pointerType||this._touchTriggersEnterLeave)){var i=this._getPointerState(t.pointerId);if(e.worldTransform.toLocal(t.position,i.position),this._isInsideHost(i.position)){i.enter(t.position,e.worldTransform);var r=this._target||e;r.onPointerEnter&&r.onPointerEnter.call(r,i)}i.isCaptured&&t.stop()}},Jo.prototype.onPointerLeave=function(t){var e=this.owner.parent;if(e){var i=this._getPointerState(t.pointerId);if("touch"!==t.pointerType||this._touchTriggersEnterLeave){if(i.isInside){i.leave(t.position,e.worldTransform);var r=this._target||e;r.onPointerLeave&&r.onPointerLeave.call(r,i)}i.isCaptured&&t.stop(),i.cancel()}else i.cancel()}},Jo.prototype.onWheel=function(t){var e=this.owner.parent;if(e){var i=this._target||e;i&&i.onWheel&&i.onWheel.call(i,t.position)&&t.stop()}},Jo.prototype.onPointerDownInside=function(t){this.captureInside&&t.capture()},Jo.prototype.onPointerDownOutside=function(t){this.captureOutside&&t.capture()},Jo.prototype._isInsideHost=function(t){var e=this.owner.parent;return e&&(!(e instanceof ji)||e.isScreenVisible&&e.containsPoint(t))},Jo.prototype._getPointerState=function(t){return this._state?this._state.isCancelled&&this._state.recycle():this._state=new ts(t),this._state.renew(),this._state},Jo);function Jo(t){this.owner=t,this._isRegistered=!1,this._isDragEnabled=!1,this._dragMinOffset=0,this._target=void 0,this._touchTriggersEnterLeave=!1,this._state=void 0,this._chainTimeout=0,this._lastDownTime=0,this.inputType=_r,this.captureInside=!0,this.captureOutside=!1}var ts=(Object.defineProperty(es.prototype,"isCaptured",{get:function(){return this._isCaptured},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"isDown",{get:function(){return this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"isInside",{get:function(){return this._isInside},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"button",{get:function(){return this._button},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"pressDuration",{get:function(){return this.startDownTime<=0||this.endDownTime<=0?-1:(this.endDownTime-this.startDownTime)/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"pressDistance",{get:function(){var t=this.position.x-this.downPosition.x,e=this.position.y-this.downPosition.y;return Math.sqrt(t*t+e*e)},enumerable:!0,configurable:!0}),Object.defineProperty(es.prototype,"pressDistanceSquare",{get:function(){var t=this.position.x-this.downPosition.x,e=this.position.y-this.downPosition.y;return t*t+e*e},enumerable:!0,configurable:!0}),es.prototype.down=function(t,e,i,r){r?(this.previousDownTime=this.startDownTime,this.previousDownPosition.x=this.downPosition.x,this.previousDownPosition.y=this.downPosition.y,this.previousUpPosition.x=this.position.x,this.previousUpPosition.y=this.position.y,this.chain++):(this.previousDownTime=0,this.previousDownPosition.x=0,this.previousDownPosition.y=0,this.previousUpPosition.x=0,this.previousUpPosition.y=0,this.chain=1),this._isDown=!0,this._button=t,this.startDownTime=Date.now(),this.worldPosition.x=e.x,this.worldPosition.y=e.y,this.deltaPosition.x=0,this.deltaPosition.y=0;var n=this.downPosition;n.x=e.x,n.y=e.y,Ht.toLocal(i,n),this.position.x=n.x,this.position.y=n.y,this.downDeltaPosition.x=0,this.downDeltaPosition.y=0},es.prototype.move=function(t,e){this.deltaPosition.x=t.x-this.worldPosition.x,this.deltaPosition.y=t.y-this.worldPosition.y,this.worldPosition.x=t.x,this.worldPosition.y=t.y,this.position.x=t.x,this.position.y=t.y,Ht.toLocal(e,this.position),this.downDeltaPosition.x=this.position.x-this.downPosition.x,this.downDeltaPosition.y=this.position.y-this.downPosition.y},es.prototype.up=function(t,e,i){i||(this.chain=1),this._isDown=!1,this.endDownTime=Date.now(),this.deltaPosition.x=t.x-this.worldPosition.x,this.deltaPosition.y=t.y-this.worldPosition.y,this.worldPosition.x=t.x,this.worldPosition.y=t.y,this.position.x=t.x,this.position.y=t.y,Ht.toLocal(e,this.position)},es.prototype.enter=function(t,e){this.chain=0,this._isInside=!0,this.startHoverTime=Date.now(),this.deltaPosition.x=0,this.deltaPosition.y=0,this.worldPosition.x=t.x,this.worldPosition.y=t.y;var i=this.enterPosition;i.x=t.x,i.y=t.y,Ht.toLocal(e,i),this.position.x=i.x,this.position.y=i.y},es.prototype.leave=function(t,e){this.chain=0,this._isInside=!1,this.endHoverTime=Date.now(),this.deltaPosition.x=t.x-this.worldPosition.x,this.deltaPosition.y=t.y-this.worldPosition.y,this.worldPosition.x=t.x,this.worldPosition.y=t.y,this.position.x=t.x,this.position.y=t.y,Ht.toLocal(e,this.position)},es.prototype.cancel=function(){this._isCancelled=!0,this._isDown=!1,this._isInside=!1,this.startDownTime=0,this.startHoverTime=0,this.endDownTime=0,this.endHoverTime=0,this.downPosition.x=0,this.downPosition.y=0,this.deltaPosition.x=0,this.deltaPosition.y=0,this.downDeltaPosition.x=0,this.downDeltaPosition.y=0,this.enterPosition.x=0,this.enterPosition.y=0,this.position.x=0,this.position.y=0,this.worldPosition.x=0,this.worldPosition.y=0,this.chain=0,this.previousDownTime=0,this.previousDownPosition.x=0,this.previousDownPosition.y=0,this.previousUpPosition.x=0,this.previousUpPosition.y=0,this._button=-1},es.prototype.capture=function(){this._isCaptured=!0},es.prototype.renew=function(){this._isCaptured=!1},es.prototype.recycle=function(){this.cancel(),this._isCancelled=!1,this._isCaptured=!1},es);function es(t){this.pointerId=t,this._isCaptured=!1,this._isCancelled=!1,this._isInside=!1,this._isDown=!1,this._button=-1,this.startDownTime=0,this.startHoverTime=0,this.endDownTime=0,this.endHoverTime=0,this.downPosition=_t(),this.deltaPosition=_t(),this.downDeltaPosition=_t(),this.enterPosition=_t(),this.position=_t(),this.worldPosition=_t(),this.chain=0,this.previousDownTime=0,this.previousDownPosition=_t(),this.previousUpPosition=_t()}var is,rs=(t(ns,is=Ge),Object.defineProperty(ns.prototype,"isRegistered",{get:function(){var e,t;try{for(var i=E(this._handlers),r=i.next();!r.done;r=i.next())if(r.value.isRegistered)return!0}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return!1},enumerable:!0,configurable:!0}),ns.prototype.addInputHandler=function(t){if("string"==typeof t){if(t!==_r)throw new Error("unknown");t=new Qo(this)}return et(t.inputType,this._handlers.map(function(t){return t.inputType})),this._handlers.push(t),t},ns.prototype.getInputHandler=function(t){var e,i;try{for(var r=E(this._handlers),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.inputType===t)return o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ns.prototype.register=function(t){var e,i;try{for(var r=E(this._handlers),n=r.next();!n.done;n=r.next()){var o=n.value;t&&o.inputType!==t||o.register()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ns.prototype.unregister=function(t){var e,i;try{for(var r=E(this._handlers),n=r.next();!n.done;n=r.next()){var o=n.value;t&&o.inputType!==t||o.unregister()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ns.prototype.handle=function(t){var e,i;try{for(var r=E(this._handlers),n=r.next();!n.done;n=r.next()){var o=n.value;o.isRegistered&&o.inputType===t.inputType&&o.handle(t)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ns.prototype.destroy=function(){this.unregister(),is.prototype.destroy.call(this)},ns);function ns(){var t=null!==is&&is.apply(this,arguments)||this;return t._handlers=new Array,t}var os=(Object.defineProperty(ss.prototype,"count",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(ss.prototype,"all",{get:function(){return this._items},enumerable:!0,configurable:!0}),ss.prototype.ofType=function(e){var i,r,n,o,s,a;return T(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),i=E(this._items),r=i.next(),t.label=1;case 1:return r.done?[3,4]:(n=r.value)instanceof e?[4,n]:[3,3];case 2:t.sent(),t.label=3;case 3:return r=i.next(),[3,1];case 4:return[3,7];case 5:return o=t.sent(),s={error:o},[3,7];case 6:try{r&&!r.done&&(a=i.return)&&a.call(i)}finally{if(s)throw s.error}return[7];case 7:return[2]}})},ss.prototype.getAt=function(t){return this._items[t]},ss.prototype.getByName=function(t){var e,i;try{for(var r=E(this._items),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.name===t)return o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},ss.prototype.add=function(t,e){e&&(t.name=e);var i=0<=this._items.indexOf(t);i||(this._items.push(t),this.markDirty()),t.setMenu(this.owner),i||vn.instance.bus.trigger(this,this.EVENT.itemAdded,t)},ss.prototype.remove=function(t){if("string"==typeof t&&(t=this.getByName(t)),t){var e=this._items.indexOf(t);e<0||(this._items.splice(e,0),t.setMenu(void 0),this.markDirty(),vn.instance.bus.trigger(this,this.EVENT.itemRemoved,t))}},ss.prototype.indexOf=function(t){return this._items.indexOf(t)},ss.prototype.contains=function(t){return"string"==typeof t?!!this.getByName(t):0<=this._items.indexOf(t)},ss.prototype.markDirty=function(){this._dirty=1},ss.prototype.processDirty=function(){this._dirty&&(1<this._items.length&&this._items.sort(Ge.Comparer.deepHashLowToHigh),this._dirty=0)},ss.EVENT=h(ss,{itemAdded:"",itemRemoved:""}),ss);function ss(t){this.owner=t,this._items=new Array,this._dirty=0,this[Symbol.iterator]=this._items[Symbol.iterator].bind(this._items)}var as,hs=(t(cs,as=rs),Object.defineProperty(cs.prototype,"isDragEnabled",{get:function(){var t=this.getInputHandler(_r);return t&&t.isDragEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"activeGroup",{get:function(){return this._groupActive},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"activeItem",{get:function(){var e,t;try{for(var i=E(this.getCurrentItems()),r=i.next();!r.done;r=i.next()){var n=r.value;if(n.isActive)return n}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"activeItems",{get:function(){return this.getCurrentItems().filter(function(t){return t.isActive})},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"selectedItem",{get:function(){var e,t;try{for(var i=E(this.getCurrentItems()),r=i.next();!r.done;r=i.next()){var n=r.value;if(n.isSelected)return n}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"selectedItems",{get:function(){return this.getCurrentItems().filter(function(t){return t.isSelected})},enumerable:!0,configurable:!0}),Object.defineProperty(cs.prototype,"focusedItem",{get:function(){return this._focusedItem&&!this._focusedItem.isFocused&&(this._focusedItem=void 0),this._focusedItem},enumerable:!0,configurable:!0}),cs.prototype.initialize=function(){var i=this;return as.prototype.initialize.call(this),this.getInputHandler(_r)||this.addInputHandler(_r).useTarget(this),this.subscribe(this.children,this.children.EVENT.childAdded,function(t,e){e instanceof No&&i.items.add(e)}),this.subscribe(this.children,this.children.EVENT.childRemoved,function(t,e){e instanceof No&&(i.items.remove(e),i._groups&&Object.getOwnPropertyNames(i._groups).forEach(function(t){return i.removeItemFromGroup(t,e)}),e===i._focusedItem&&(i._focusedItem=void 0))}),this},cs.prototype.attach=function(t){Q(t instanceof ji);var e=as.prototype.attach.call(this,t);return this.autoRegister&&this.register(),e},cs.prototype.detach=function(){as.prototype.detach.call(this),this.unregister()},cs.prototype.destroy=function(){var e,t;as.prototype.destroy.call(this);try{for(var i=E(this.items.all),r=i.next();!r.done;r=i.next())r.value.setMenu(void 0)}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},cs.prototype.register=function(){as.prototype.register.call(this);var t=this._getDefaultFocusItem();t&&this.focus(t)},cs.prototype.unregister=function(){as.prototype.unregister.call(this)},cs.prototype.scanForMenuItems=function(t){if(t instanceof No&&this.addItem(t),!(t.children.count<1))for(var e=z(t.children);0<e.length;){var i=e.shift();i instanceof No&&this.addItem(i),e.push.apply(e,z(i.children))}},cs.prototype.addItem=function(){for(var e,t,i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];try{for(var n=E(i),o=n.next();!o.done;o=n.next()){var s=o.value;this.items.add(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},cs.prototype.addItemToGroup=function(t){for(var e,i,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=this._groups||(this._groups={}),s=o[t]||(o[t]=[]);try{for(var a=E(r),h=a.next();!h.done;h=a.next()){var c=h.value;if("string"==typeof c){var u=this.items.getByName(c);tt(u),s.push(u)}else Q(this.items.contains(c)),s.push(c)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},cs.prototype.removeItemFromGroup=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];this._groups&&this._groups[t]&&(this._groups[t]=this._groups[t].filter(function(e){return!i.find(function(t){return e===t||e.name===t})}))},cs.prototype.getCurrentItems=function(){return this._groupActive?this._groups&&this._groups[this._groupActive]||[]:this.items.all},cs.prototype.getCurrentItemByName=function(t){var e,i;try{for(var r=E(this.getCurrentItems()),n=r.next();!n.done;n=r.next()){var o=n.value;if(o.name===t)return o}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},cs.prototype.getGroupItems=function(t){return this._groups&&this._groups[t]||[]},cs.prototype.activateGroup=function(t){this._groupActive=t},cs.prototype.getItemByWorldPoint=function(t,e,i){if(!this.dontTriggerWhenOutside||!this.parent||this.parent.containsPoint(this.worldTransform.toLocal(t,this._tempPoint)))for(var r=this.getCurrentItems(),n=r.length-1;0<=n;n--){var o=r[n];if((e||o.isEnabled)&&(i||o.isScreenVisible)&&o.containsPoint(o.worldTransform.toLocal(t,this._tempPoint)))return o}},cs.prototype.resetPointer=function(){this._pointedItem=void 0},cs.prototype.resetDrag=function(){this._dragBeginPosition=void 0,this._isDragging=!1},cs.prototype.onPointerDown=function(t){if(this.parent&&this.parent.isScreenVisible){var e=this.getItemByWorldPoint(t.worldPosition);e&&(this.onItemPressed(e,t.worldPosition),t.capture())}},cs.prototype.onPointerDownInside=function(t){(this.captureInside||this.captureAll)&&t.capture()},cs.prototype.onPointerDownOutside=function(t){this.captureAll&&(t.capture(),this.trigger(this.EVENT.clickOutside,t.downPosition))},cs.prototype.onPointerMove=function(t){var e=this._pointedItem;if(e){if(this._isDragging)return this.onDragMove(e,t.downDeltaPosition.x,t.downDeltaPosition.y),void t.capture();if(this.isDragEnabled&&e.canDrag()&&(0===this._dragMinOffset||this._dragMinOffset<=t.pressDistance)&&this.onDragBegin(e,t.downDeltaPosition.x,t.downDeltaPosition.y))t.capture();else{var i=this.getItemByWorldPoint(t.worldPosition);this.dontTriggerWhenSlide&&16<t.pressDistanceSquare||i!==e?(this.pressUp(e),this._pointedItem=void 0):this.pressDown(e,t.worldPosition),t.capture()}}},cs.prototype.onPointerUp=function(t){var e=this._pointedItem,i=this.getItemByWorldPoint(t.worldPosition);if(e)return this.pressUp(e,t.worldPosition),this._isDragging?this._dragBeginPosition?this.onDragEnd(e,t.downDeltaPosition.x,t.downDeltaPosition.y):this.resetDrag():i===e&&(this.activate(e),2===t.chain&&this.trigger(this.EVENT.doubleClick,i)),this.resetPointer(),void t.capture();this._isDragging&&(this.resetDrag(),this.resetPointer(),t.capture())},cs.prototype.onPointerCancel=function(t){if(this._pointedItem)return this.pressUp(this._pointedItem),this.resetPointer(),t.capture(),void t.cancel();this._isDragging&&(this._dragBeginPosition&&this._pointedItem?this.onDragEnd(this._pointedItem,t.downDeltaPosition.x,t.downDeltaPosition.y):this.resetDrag(),this.resetPointer(),t.capture(),t.cancel())},cs.prototype.onPointerHover=function(t){if(this.parent&&this.parent.isScreenVisible){var e=this.getItemByWorldPoint(t.worldPosition);e?(e!==this._hoveredItem&&(this._hoveredItem&&(this._hoveredItem.isHover=!1),this._hoveredItem=e),e.set(5,!0,e.transform.convertToLocalPosition(_t(t.worldPosition))),t.capture()):this._hoveredItem?(this._hoveredItem.isHover=!1,this._hoveredItem=void 0,t.capture()):(this.captureAll||this.captureInside&&t.isInside)&&t.capture()}},cs.prototype.onDragBegin=function(t,e,i){return!this._isDragging&&(this._dragBeginPosition=t.position.clone(),t.canDrag()&&t.onDragBegin(e,i)?(this._isDragging=!0,this._lastActivation=0):this._dragBeginPosition=void 0,this._isDragging)},cs.prototype.onDragMove=function(t,e,i){this._dragBeginPosition&&(t.position.set(this._dragBeginPosition.x+e,this._dragBeginPosition.y+i),t.onDragMove&&t.onDragMove(e,i))},cs.prototype.onDragEnd=function(t,e,i){t.onDragEnd(e,i),this.resetDrag()},cs.prototype.onItemPressed=function(t,e){this._pointedItem=t,this.focus(t),this.pressDown(t,e)},cs.prototype.focus=function(t){t!==this._focusedItem&&(this._focusedItem&&(this._focusedItem.isFocused=!1),t&&!t.canReceiveFocus||(this._focusedItem=t),t&&t.canReceiveFocus&&(t.isFocused=!0))},cs.prototype.moveFocus=function(t){var e,i,r=this.getCurrentItems(),n=this._focusedItem;if(!n)return 0<r.length&&(this.focus(this._getDefaultFocusItem()),!0);var o,s,a=n.transform.getWorldBox(),h=Number.MAX_VALUE,c=Number.MAX_VALUE;o="left"===t?a.getPoint(5):"right"===t?a.getPoint(7):"up"===t?a.getPoint(6):"down"===t?a.getPoint(8):a.getPoint(4);var u=new Nt;try{for(var l=E(r),p=l.next();!p.done;p=l.next()){var d=p.value;if(d!==n&&d.isEnabled&&d.isScreenVisible&&d.canReceiveFocus){d.transform.getWorldBox(a),a.getPoint(4,u);var f=0;"left"===t||"right"===t?(f=o.y-u.y,u.y+=0<f?Math.min(f,a.height/2):Math.max(f,-a.height/2)):"down"!==t&&"up"!==t||(f=o.x-u.x,u.x+=0<f?Math.min(f,a.width/2):Math.max(f,-a.width/2));var y=u.x>o.x?u.x-o.x:o.x-u.x,v=u.y>o.y?u.y-o.y:o.y-u.y;if(("left"===t||"right"===t)&&.1<y||("down"===t||"up"===t)&&.1<v){var g=Math.atan2(y,v);"up"!==t&&"down"!==t||(g=Math.abs(Math.PI/2-g));var _=o.distance(u),m=_*Math.max(.05,2*g);(m<h||m===h&&_<c)&&(h=m,c=_,s=d)}}}}catch(t){e={error:t}}finally{try{p&&!p.done&&(i=l.return)&&i.call(l)}finally{if(e)throw e.error}}return!!s&&(this.focus(s),!0)},cs.prototype.pressDown=function(t,e){t.set(6,!0,e&&t.worldTransform.toLocal(e)),this.trigger(this.EVENT.pressedChanged,t)},cs.prototype.pressUp=function(t,e){t.set(6,!1,e&&t.worldTransform.toLocal(e)),this.trigger(this.EVENT.pressedChanged,t)},cs.prototype.activate=function(t){if(this.debounceActivationDelay&&Date.now()<=this._lastActivation+1e3*this.debounceActivationDelay)return!1;this._lastActivation=Date.now();var e=t.activate();return e&&this.trigger(this.EVENT.click,t),e},cs.prototype._getDefaultFocusItem=function(){var e,t;if(this._focusedItem)return this._focusedItem;if(this.defaultFocusItem)if("first"===this.defaultFocusItem)try{for(var i=E(this.getCurrentItems()),r=i.next();!r.done;r=i.next())if((a=r.value).isEnabled&&a.canReceiveFocus)return a}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else if("last"===this.defaultFocusItem)for(var n=0,o=this.getCurrentItems(),s=o.length;n<s;n++){var a;if((a=o[s-1-n]).isEnabled&&a.canReceiveFocus)return a}else if(this.defaultFocusItem instanceof No)return this.defaultFocusItem},cs.EVENT=h(cs,{click:"",doubleClick:"",pressedChanged:"",dragStarted:"",clickOutside:""}),cs);function cs(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=as.call(this)||this;return i.captureInside=t,i.captureAll=e,i.autoRegister=!0,i.dontTriggerWhenSlide=!1,i.dontTriggerWhenOutside=!0,i.defaultFocusItem="first",i.debounceActivationDelay=0,i._groups=void 0,i._groupActive=void 0,i._focusedItem=void 0,i._pointedItem=void 0,i._hoveredItem=void 0,i._tempPoint=_t(),i._lastActivation=0,i._isDragging=!1,i._dragBeginPosition=void 0,i._dragMinOffset=0,i.items=new os(i),i}var us,ls=(t(ps,us=ji),ps.prototype.initialize=function(){var n=this;return us.prototype.initialize.call(this),this.children.add((new zi).initialize()),this.subscribe(this.children,this.children.EVENT.childAdded,function(t,e,i){var r=n.menu;i&&n.autoAddMenuItems&&r&&r.scanForMenuItems(i)}),this},ps.prototype.addMenu=function(t){void 0===t&&(t=!0),this.autoAddMenuItems=t;var e=this.menu;return e||((e=(new hs).initialize()).autoRegister=!1,this.children.add(e,0,"menu")),t&&e.scanForMenuItems(this),e},ps.prototype.register=function(){},ps.prototype.unregister=function(){},ps.prototype.attach=function(t){us.prototype.attach.call(this,t),Q(t instanceof ji);var e=this.menu;return e&&e.register(),this},ps.prototype.queue=function(t){this.visible&&(this.clipContent&&t.push(this._beginMask),us.prototype.queue.call(this,t),this.clipContent&&t.push(this._endMask))},a([function(r,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=!1),n&&o)throw new Error("cant be both writable and recursive");return function(t,e,i){return{get:function(){return this.children.getByName(r,o)},set:n?function(t){var e=this.children.getByName(r);t!==e&&(e&&e.destroy(),this.children.add(t,void 0,r))}:void 0}}}("menu")],ps.prototype,"menu",void 0),a([_("menu")],ps.prototype,"isRegistered",void 0),a([_("menu")],ps.prototype,"register",null),a([_("menu")],ps.prototype,"unregister",null),ps);function ps(){var i=null!==us&&us.apply(this,arguments)||this;return i.autoAddMenuItems=!0,i.clipContent=!1,i._beginMask={draw:function(t){t.save();var e=i.worldTransform;t.setTransform(e.a,-e.b,-e.c,e.d,e.e,-e.f),t.beginPath(),t.rect(0,0,i.size.width,-i.size.height),t.clip()}},i._endMask={draw:function(t){t.restore()}},i}var ds,fs=(t(ys,ds=sr),ys.prototype.attach=function(t){ds.prototype.attach.call(this,t),this._checkResize(),this._loadMap();var e=this._actionBar=this.children.add((new Bo).initialize());e.transform.anchor.set(.5,0),e.position.set(this.size.width/2,260);var i=this.children.add((new Wo).initialize(),0,"action_attack");i.action="attack",i.transform.right=this.size.width-12,i.transform.bottom=12;var r=this.children.add((new Wo).initialize(),0,"action_defence");r.action="defence",r.transform.right=i.transform.left-12,r.transform.bottom=12;var n=this._directions=this.children.add((new qo).initialize(),0,"directions");n.transform.anchor.set(0,.5),n.position.set(24,i.transform.outerCenterY);var o=this._turnLabel=this.children.add(new zn("s_yourTurn").initialize(),0);o.visible=!1,o.transform.anchor.set(0,1),o.position.set(32,this.size.height-32);var s=this._menu=this.children.add((new hs).initialize());return s.scanForMenuItems(this),this.subscribe(s,s.EVENT.click,this._onMenuClick),this},ys.prototype.enter=function(){this.run.after(.4,this.startLevel)},ys.prototype.startLevel=function(){this._turnLabel.setFrame("s_yourTurn"),this._turnLabel.visible=!0,this._map.start()},ys.prototype._setActionsEnabled=function(t){this._actionsEnabled!==t&&((this._actionsEnabled=t)?(this._directions.enable(),this.children.getByName("action_attack").unflip(),this.children.getByName("action_defence").unflip()):(this._directions.disable(),this.children.getByName("action_attack").flip(),this.children.getByName("action_defence").flip()))},ys.prototype._executeActions=function(){return f(this,void 0,void 0,function(){var e=this;return T(this,function(t){switch(t.label){case 0:return this._menu.unregister(),this._actionBar.startExecuting(),[4,this._map.execute(this._actionBar.actions,function(t){e._actionBar.activateAction(t)})];case 1:return t.sent(),this._actionBar.stopExecuting(),this._map.isExit?[2]:(this._turnLabel.visible=!0,this._turnLabel.setFrame("s_enemyTurn"),[4,this.run.wait(.2)]);case 2:return t.sent(),[4,this._map.executeEnemy()];case 3:return t.sent(),this._turnLabel.visible=!0,this._turnLabel.setFrame("s_yourTurn"),this._setActionsEnabled(!0),this._menu.register(),[2]}})})},ys.prototype._checkResize=function(){if(!(1.5<=this.size.height/this.size.width)){var t=this.size.clone();this.size.set(t.height/1.4,t.height/.5/devicePixelRatio),this.position.x=(t.width-this.size.width)/2,this.transform.scale.set(.5*devicePixelRatio,.5*devicePixelRatio)}},ys.prototype._loadMap=function(){return f(this,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return(e=this.children.add((new ls).initialize(),-1)).size.set(this.size),e.clipContent=!0,(i=this._map=e.children.add((new Io).initialize())).transform.scale.set(3,3),[4,i.load("res/levels/level_1-1.json")];case 1:return t.sent(),i.position.y=(this.size.height-i.transform.outerHeight)/2+i.tileSize,this.children.add(new fo(0,0,this.size.width,this.size.height).initialize(),-2).style=ho.Fill(i.bgColor),this.subscribe(i,i.EVENT.heroExit,this._onExit),[2]}})})},ys.prototype._onMenuClick=function(t,e,i){switch(i.name){case"dir_forward":case"dir_back":case"dir_up":case"dir_upForward":case"action_attack":case"action_defence":this._actionBar.addAction(i.name);break;case"actionBar_cancel":this._actionBar.clear(),this._setActionsEnabled(!0);break;case"actionBar_confirm":return void this._executeActions()}this._actionBar.isCompleted&&this._setActionsEnabled(!1)},ys.prototype._onExit=function(t,e,i){return f(this,void 0,void 0,function(){return T(this,function(t){switch(t.label){case 0:return this._menu.unregister(),this._setActionsEnabled(!1),this._map.destroy(),[4,this._loadMap()];case 1:return t.sent(),this.run.after(.4,this.startLevel),[4,this.run.wait(.8).async()];case 2:return t.sent(),this._menu.register(),this._setActionsEnabled(!0),[2]}})})},ys);function ys(){var t=null!==ds&&ds.apply(this,arguments)||this;return t._map=void 0,t._actionBar=void 0,t._directions=void 0,t._turnLabel=void 0,t._menu=void 0,t._actionsEnabled=!0,t}setTimeout(function(){return f(void 0,void 0,void 0,function(){var e,i;return T(this,function(t){switch(t.label){case 0:return[4,(e=new vn).initialize()];case 1:return t.sent(),e.run(),[4,e.loader.load("res/atlas/ui.json","spriteAtlas")];case 2:return t.sent(),[4,e.loader.load("res/assets.json","spriteDefinition")];case 3:return t.sent(),i=e.container.create(fs).initialize(),e.director.navigate(i),[2]}})})},0)}();